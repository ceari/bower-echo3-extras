/*
 * @licence Echo Extras, version 3.0
 * Copyright (C) 2002-2009 NextApp, Inc.
 * License: MPL, GPL
 * http://echo.nextapp.com/site/echo3/
 */
Extras={uniqueId:0};Extras.Serial={PROPERTY_TYPE_PREFIX:"Extras.Serial."};Extras.Sync={};Extras.Sync.Animation=Core.extend({stepIndex:0,startTime:null,endTime:null,_listenerList:null,_runnable:null,$virtual:{runTime:0,sleepInterval:10},$abstract:{init:function(){},complete:function(a){},step:function(a){}},_doStep:function(){var a=new Date().getTime();if(a<this.endTime){if(this.stepIndex===0){this.init()}else{this.step((a-this.startTime)/this.runTime)}++this.stepIndex;Core.Web.Scheduler.add(this._runnable)}else{this.complete(false);if(this._completeMethod){this._completeMethod(false)}}},abort:function(){Core.Web.Scheduler.remove(this._runnable);this.complete(true);if(this._completeMethod){this._completeMethod(true)}},start:function(a){this._runnable=new Core.Web.Scheduler.MethodRunnable(Core.method(this,this._doStep),this.sleepInterval,false);this.startTime=new Date().getTime();this.endTime=this.startTime+this.runTime;this._completeMethod=a;Core.Web.Scheduler.add(this._runnable)}});Extras.Serial.ItemModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{parseIcon:function(a,b){var c=Core.Web.DOM.getChildElementByTagName(b,"icon");if(c){return Echo.Serial.ImageReference.toProperty(a,c)}return null},toProperty:function(a,b){var d=b.getAttribute("t");if(d.indexOf(Extras.Serial.PROPERTY_TYPE_PREFIX)===0){d=d.substring(Extras.Serial.PROPERTY_TYPE_PREFIX.length)}var c=Extras.Serial[d];if(c){return c.toProperty(a,b)}else{throw new Error("Unsupported model type: "+d)}}}});Extras.Serial.MenuModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(d,j){var a=j.getAttribute("id");var k=j.getAttribute("text");var h=Extras.Serial.ItemModel.parseIcon(d,j);var g=new Extras.MenuModel(a,k,h);var b=Core.Web.DOM.getChildElementsByTagName(j,"item");for(var f=0;f<b.length;f++){var e=b[f];var c=Extras.Serial.ItemModel.toProperty(d,e);g.addItem(c)}return g}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.MenuModel",this)}});Extras.Serial.OptionModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){var e=b.getAttribute("id");var d=b.getAttribute("text");var c=Extras.Serial.ItemModel.parseIcon(a,b);return new Extras.OptionModel(e,d,c)}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.OptionModel",this)}});Extras.Serial.RadioOptionModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){var e=b.getAttribute("id");var d=b.getAttribute("text");var c=Extras.Serial.ItemModel.parseIcon(a,b);return new Extras.RadioOptionModel(e,d,c)}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.RadioOptionModel",this)}});Extras.Serial.ToggleOptionModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){var e=b.getAttribute("id");var d=b.getAttribute("text");var c=Extras.Serial.ItemModel.parseIcon(a,b);return new Extras.ToggleOptionModel(e,d,c)}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.ToggleOptionModel",this)}});Extras.Serial.SeparatorModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){return new Extras.SeparatorModel()}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.SeparatorModel",this)}});Extras.Serial.MenuStateModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){var g=new Extras.MenuStateModel();var f=Core.Web.DOM.getChildElementsByTagName(b,"i");for(var e=0;e<f.length;e++){var c=f[e];var h=c.getAttribute("enabled");if(h!=null){g.setEnabled(c.getAttribute("id"),h=="true")}var d=c.getAttribute("selected");if(d!=null){g.setSelected(c.getAttribute("id"),d=="true")}}return g}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.MenuStateModel",this)}});Extras.AccordionPane=Core.extend(Echo.Component,{$static:{DEFAULT_ANIMATION_TIME:350},$load:function(){Echo.ComponentFactory.registerType("Extras.AccordionPane",this)},componentType:"Extras.AccordionPane",pane:true,$construct:function(a){Echo.Component.call(this,a);this.addListener("property",Core.method(this,this._tabChangeListener))},doTabSelect:function(a){var b=this.application.getComponentByRenderId(a);if(!b||b.parent!=this){throw new Error("doTabSelect(): Invalid tab: "+a)}this.set("activeTabId",a);this.fireEvent({type:"tabSelect",source:this,tab:b,data:a})},_tabChangeListener:function(b){var a;switch(b.propertyName){case"activeTabId":if(this.application){for(a=0;a<this.children.length;++a){if(this.children[a].renderId==b.newValue){if(this.get("activeTabIndex")!=a){this.set("activeTabIndex",a)}return}}}break;case"activeTabIndex":a=parseInt(b.newValue,10);if(this.application&&this.children[a]&&this.get("activeTabId")!=this.children[a].renderId){this.set("activeTabId",this.children[a].renderId)}break}}});Extras.BorderPane=Core.extend(Echo.Component,{$static:{DEFAULT_BORDER:{color:"#00007f",contentInsets:20,borderInsets:3}},$load:function(){Echo.ComponentFactory.registerType("Extras.BorderPane",this)},componentType:"Extras.BorderPane",pane:true});Extras.CalendarSelect=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.CalendarSelect",this)},componentType:"Extras.CalendarSelect",doAction:function(){this.fireEvent({type:"action",source:this,actionCommand:this.get("actionCommand")})}});Extras.ColorSelect=Core.extend(Echo.Component,{$static:{DEFAULT_VALUE_WIDTH:"12em",DEFAULT_SATURATION_HEIGHT:"12em",DEFAULT_HUE_WIDTH:"2em"},$load:function(){Echo.ComponentFactory.registerType("Extras.ColorSelect",this)},componentType:"Extras.ColorSelect"});Extras.DataGrid=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.DataGrid",this)},componentType:"Extras.DataGrid",pane:true});Extras.DataGrid.Model=Core.extend({$abstract:{get:function(a,b){},getColumnCount:function(){},getRowCount:function(){}},$virtual:{prefetch:null}});Extras.DragSource=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.DragSource",this)},componentType:"Extras.DragSource",doDrop:function(b,a){this.fireEvent({type:"drop",source:this,dropTarget:b,specificTarget:a,data:a})}});Extras.FlowViewer=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.FlowViewer",this)},componentType:"Extras.FlowViewer",pane:true,doAction:function(a){this.fireEvent({type:"action",source:this,index:a})}});Extras.Group=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.Group",this)},componentType:"Extras.Group"});Extras.ListViewer=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.ListViewer",this)},componentType:"Extras.ListViewer",pane:true,doAction:function(a){this.fireEvent({type:"action",source:this,index:a})}});Extras.MenuComponent=Core.extend(Echo.Component,{$abstract:true,modalSupport:true,focusable:true,doAction:function(a){var b=a.getItemPositionPath().join(".");if(a instanceof Extras.ToggleOptionModel){this._toggleItem(a)}this.fireEvent({type:"action",source:this,data:b,modelId:a.modelId})},_toggleItem:function(c){var a=this.get("model");var e=this.get("stateModel");if(c.groupId){var d=a.findItemGroup(c.groupId);for(var b=0;b<d.length;++b){e.setSelected(d[b].modelId,false)}}if(e){e.setSelected(c.modelId,!e.isSelected(c.modelId))}}});Extras.ContextMenu=Core.extend(Extras.MenuComponent,{$static:{ACTIVATION_MODE_CLICK:1,ACTIVATION_MODE_CONTEXT_CLICK:2},$load:function(){Echo.ComponentFactory.registerType("Extras.ContextMenu",this)},componentType:"Extras.ContextMenu"});Extras.DropDownMenu=Core.extend(Extras.MenuComponent,{$load:function(){Echo.ComponentFactory.registerType("Extras.DropDownMenu",this)},componentType:"Extras.DropDownMenu"});Extras.MenuBarPane=Core.extend(Extras.MenuComponent,{$load:function(){Echo.ComponentFactory.registerType("Extras.MenuBarPane",this)},componentType:"Extras.MenuBarPane"});Extras.ItemModel=Core.extend({$abstract:true,modelId:null,parent:null});Extras.MenuModel=Core.extend(Extras.ItemModel,{text:null,icon:null,items:null,$construct:function(e,d,c,a){this.modelId=e;this.id=Extras.uniqueId++;this.parent=null;this.text=d;this.icon=c;if(a){for(var b=0;b<a.length;++b){a[b].parent=this}}this.items=a?a:[]},addItem:function(a){this.items.push(a);a.parent=this},findItem:function(c){var a;for(a=0;a<this.items.length;++a){if(this.items[a].id==c){return this.items[a]}}for(a=0;a<this.items.length;++a){if(this.items[a] instanceof Extras.MenuModel){var b=this.items[a].findItem(c);if(b){return b}}}return null},findItemGroup:function(c){var d=[];for(var b=0;b<this.items.length;++b){if(this.items[b] instanceof Extras.MenuModel){var e=this.items[b].findItemGroup(c);for(var a=0;a<e.length;++a){d.push(e[a])}}else{if(this.items[b].groupId==c){d.push(this.items[b])}}}return d},getItemModelFromPositions:function(b){var c=this;for(var a=0;a<b.length;++a){c=c.items[parseInt(b[a],10)]}return c},indexOfItem:function(b){for(var a=0;a<this.items.length;++a){if(this.items[a]==b){return a}}return -1},toString:function(){return'MenuModel "'+this.text+'" Items:'+this.items.length}});Extras.OptionModel=Core.extend(Extras.ItemModel,{text:null,icon:null,$construct:function(c,b,a){this.modelId=c;this.id=Extras.uniqueId++;this.parent=null;this.text=b;this.icon=a},getItemPositionPath:function(){var b=[];var a=this;while(a.parent!=null){b.unshift(a.parent.indexOfItem(a));a=a.parent}return b},toString:function(){return'OptionModel "'+this.text+'"'}});Extras.ToggleOptionModel=Core.extend(Extras.OptionModel,{$construct:function(b,a){Extras.OptionModel.call(this,b,a,null)}});Extras.RadioOptionModel=Core.extend(Extras.ToggleOptionModel,{groupId:null,$construct:function(c,b,a){Extras.ToggleOptionModel.call(this,c,b);this.groupId=a}});Extras.SeparatorModel=Core.extend(Extras.ItemModel,{});Extras.MenuStateModel=Core.extend({_disabledItems:null,_selectedItems:null,$construct:function(){this._disabledItems=[];this._selectedItems=[]},isEnabled:function(b){if(b){for(var a=0;a<this._disabledItems.length;a++){if(this._disabledItems[a]==b){return false}}}return true},isSelected:function(b){if(b){for(var a=0;a<this._selectedItems.length;a++){if(this._selectedItems[a]==b){return true}}}return false},setEnabled:function(b,a){if(a){Core.Arrays.remove(this._disabledItems,b)}else{if(Core.Arrays.indexOf(this._disabledItems,b)==-1){this._disabledItems.push(b)}}},setSelected:function(b,a){if(a){if(Core.Arrays.indexOf(this._selectedItems,b)==-1){this._selectedItems.push(b)}}else{Core.Arrays.remove(this._selectedItems,b)}}});Extras.Reorder=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.Reorder",this)},componentType:"Extras.Reorder",getOrder:function(){var b;var c=this.get("order")||[];var d=[];var a=[];for(b=0;b<c.length;++b){if(c[b]>=this.children.length){continue}if(d[c[b]]){continue}d[c[b]]=true;a.push(c[b])}for(b=0;b<this.children.length;++b){if(!d[b]){a.push(b)}}return a},reorder:function(a,c){var d,e=this.getOrder(),b;b=e.slice();b.splice(a,1);b.splice(c,0,e[a]);this.set("order",b)}});Extras.Reorder.Handle=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.Reorder.Handle",this)},componentType:"Extras.Reorder.Handle"});Extras.RichTextArea=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.RichTextArea",this)},componentType:"Extras.RichTextArea",focusable:true,doAction:function(){this.fireEvent({source:this,type:"action"})},execCommand:function(a,b){this.fireEvent({type:"execCommand",source:this,commandName:a,value:b})},insertHtml:function(a){this.execCommand("insertHtml",a)}});Extras.RichTextInput=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.RichTextInput",this)},componentType:"Extras.RichTextInput",focusable:true,doAction:function(){this.fireEvent({source:this,type:"action"})},doCursorStyleChange:function(a){this.fireEvent({source:this,type:"cursorStyleChange",style:a})},execCommand:function(a,b){this.fireEvent({type:"execCommand",source:this,commandName:a,value:b})},insertHtml:function(a){this.execCommand("insertHtml",a)}});Extras.TabPane=Core.extend(Echo.Component,{$static:{BORDER_TYPE_NONE:0,BORDER_TYPE_ADJACENT_TO_TABS:1,BORDER_TYPE_PARALLEL_TO_TABS:2,BORDER_TYPE_SURROUND:3,TAB_POSITION_TOP:0,TAB_POSITION_BOTTOM:1},$load:function(){Echo.ComponentFactory.registerType("Extras.TabPane",this)},componentType:"Extras.TabPane",pane:true,focusable:true,$construct:function(a){Echo.Component.call(this,a);this.addListener("property",Core.method(this,this._tabChangeListener))},getFocusOrder:function(){return this.get("activeTabIndex")!=null?[this.get("activeTabIndex")]:[0]},doTabClose:function(a){var b=this.application.getComponentByRenderId(a);if(!b||b.parent!=this){throw new Error("doTabClose(): Invalid tab: "+a)}this.fireEvent({type:"tabClose",source:this,tab:b,data:a})},doTabSelect:function(b,a){var c=this.application.getComponentByRenderId(b);if(!c||c.parent!=this){throw new Error("doTabSelect(): Invalid tab: "+b)}this.set("activeTabId",b);this.fireEvent({type:"tabSelect",source:this,tab:c,data:b});if(a){this.application.setFocusedComponent(this)}else{if(this.application.getFocusedComponent()!=this){var d=this.application.focusManager.find(c,false);if(d!=null){this.application.setFocusedComponent(d)}}}},_tabChangeListener:function(b){var a;switch(b.propertyName){case"activeTabId":if(this.application){for(a=0;a<this.children.length;++a){if(this.children[a].renderId==b.newValue){if(this.get("activeTabIndex")!=a){this.set("activeTabIndex",a)}return}}}break;case"activeTabIndex":a=parseInt(b.newValue,10);if(this.application&&this.children[a]&&this.get("activeTabId")!=this.children[a].renderId){this.set("activeTabId",this.children[a].renderId)}break}}});Extras.ToolTipContainer=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.ToolTipContainer",this)},componentType:"Extras.ToolTipContainer"});Extras.TransitionPane=Core.extend(Echo.Component,{$static:{DEFAULT_DURATION:350,DEFAULT_TYPE:0,TYPE_IMMEDIATE_REPLACE:0,TYPE_CAMERA_PAN_LEFT:1,TYPE_CAMERA_PAN_RIGHT:2,TYPE_CAMERA_PAN_UP:3,TYPE_CAMERA_PAN_DOWN:4,TYPE_BLIND_BLACK_IN:5,TYPE_BLIND_BLACK_OUT:6,TYPE_FADE_TO_BLACK:7,TYPE_FADE_TO_WHITE:8,TYPE_FADE:9},$load:function(){Echo.ComponentFactory.registerType("Extras.TransitionPane",this)},componentType:"Extras.TransitionPane",pane:true});Extras.Viewer={};Extras.Viewer.Model=Core.extend({$abstract:{fetch:function(b,a){},get:function(a){},size:function(){}},$construct:function(){this._listeners=new Core.ListenerList()},addUpdateListener:function(a){this._listeners.addListener("update",a)},refresh:function(){this._listeners.fireEvent({source:this,type:"update",refresh:true})},removeUpdateListener:function(a){this._listeners.removeListener("update",a)},update:function(b,a){this._listeners.fireEvent({source:this,type:"update",startIndex:b,endIndex:a==null?b+1:a})}});Extras.Viewer.NullModel=Core.extend(Extras.Viewer.Model,{fetch:function(b,a){},get:function(a){return null},size:function(){return 0}});Extras.Viewer.CachingModel=Core.extend(Extras.Viewer.Model,{_cache:null,_count:null,$construct:function(){Extras.Viewer.Model.call(this);this._cache={}},$abstract:{fetchImpl:function(b,a){}},$virtual:{emptyFetch:20,overFetch:10},cacheStore:function(f,d,a,c,e){for(var b=0;b<a.length;++b){this._cache[f+b]=a[b]}if(e||this._count!==c){this._count=c;this.refresh()}else{this.update(f,d)}},fetch:function(e,d){e=Math.max(e-this.overFetch,0);d=Math.min(d+this.overFetch,this.size());if(d===0){this.fetchImpl(0,this.emptyFetch)}else{var c=null,b=null;for(var a=e;a<d;++a){if(!this._cache[a]){if(c===null){c=a}b=a}}if(c!==null){this.fetchImpl(c,b+1)}}},get:function(a){return this._cache[a]},size:function(){return this._count||0}});Extras.Sync.AccordionPane=Core.extend(Echo.Render.ComponentSync,{$static:{_supportedPartialProperties:{activeTabId:true,activeTabIndex:true},_DEFAULTS:{tabBackground:"#cfcfcf",tabBorder:"1px outset #cfcfcf",tabForeground:"#000000",tabInsets:"2px 5px",tabContentInsets:0}},$load:function(){Echo.Render.registerPeer("Extras.AccordionPane",this)},_animationTime:0,div:null,_activeTabId:null,_newImagesLoaded:null,_pendingRenderDisplay:false,rotation:null,tabs:null,resetOverflowForAnimation:false,_tabSelectListenerRef:null,imageMonitorRef:null,$construct:function(){this.tabs=[];this.resetOverflowForAnimation=Core.Web.Env.ENGINE_GECKO||Core.Web.Env.ENGINE_MSHTML;this._tabSelectListenerRef=Core.method(this,this._tabSelectListener);this.imageMonitorRef=Core.method(this,this._imageMonitor)},_getTabById:function(a){for(var b=0;b<this.tabs.length;++b){var c=this.tabs[b];if(c.childComponent.renderId==a){return c}}return null},getTabHeight:function(c,d){if(d==null||d<c){throw new Error("Invalid indices: begin="+c+",end="+d)}else{var b=0;for(var a=c;a<d;++a){b+=this.tabs[a].tabDiv.offsetHeight}return b}},_imageMonitor:function(){if(this._newImagesLoaded){return}this._newImagesLoaded=true;Core.Web.Scheduler.run(Core.method(this,function(){if(this.client&&!this._pendingRenderDisplay){this.redrawTabs(false)}this._newImagesLoaded=false}))},_processRollover:function(a){return !this.rotation},redrawTabs:function(a){if(this.rotation){this.rotation.abort()}if(this._activeTabId==null||this._getTabById(this._activeTabId)==null){if(this.tabs.length>0){this._activeTabId=this.tabs[0].childComponent.renderId}else{this._activeTabId=null}}var b=false;for(var c=0;c<this.tabs.length;++c){if(b){this.tabs[c].tabDiv.style.top="";this.tabs[c].tabDiv.style.bottom=this.getTabHeight(c+1,this.tabs.length)+"px"}else{this.tabs[c].tabDiv.style.bottom="";this.tabs[c].tabDiv.style.top=this.getTabHeight(0,c)+"px"}this.tabs[c].containerDiv.style.height="";if(this._activeTabId==this.tabs[c].childComponent.renderId){b=true;this.tabs[c].containerDiv.style.display="block";this.tabs[c].containerDiv.style.top=this.getTabHeight(0,c+1)+"px";this.tabs[c].containerDiv.style.bottom=this.getTabHeight(c+1,this.tabs.length)+"px";this.tabs[c].contentDiv.style.top=0;this.tabs[c].contentDiv.style.bottom=0;this.tabs[c].contentDiv.style.height="";Core.Web.VirtualPosition.redraw(this.tabs[c].contentDiv)}else{this.tabs[c].containerDiv.style.display="none"}}if(a){Echo.Render.notifyResize(this.component);this.renderDisplayTabs()}},renderAdd:function(g,a){this.component.addListener("tabSelect",this._tabSelectListenerRef);this._animationTime=this.component.render("animationTime",Extras.AccordionPane.DEFAULT_ANIMATION_TIME);this._activeTabId=this.component.get("activeTabId");this.div=document.createElement("div");this.div.id=this.component.renderId;this.div.style.cssText="position:absolute;width:100%;height:100%;";Echo.Sync.renderComponentDefaults(this.component,this.div);var e=Core.method(this,this._processRollover);Core.Web.Event.add(this.div,"mouseover",e,true);Core.Web.Event.add(this.div,"mouseout",e,true);var b=this.component.getComponentCount();for(var c=0;c<b;++c){var f=this.component.getComponent(c);var d=new Extras.Sync.AccordionPane.Tab(f,this);this.tabs.push(d);d.render(g);this.div.appendChild(d.tabDiv);this.div.appendChild(d.containerDiv)}a.appendChild(this.div);this._pendingRenderDisplay=true},renderDisplay:function(){this._pendingRenderDisplay=false;if(!this.rotation){this.redrawTabs(false)}this.renderDisplayTabs()},renderDisplayTabs:function(){for(var a=0;a<this.tabs.length;++a){this.tabs[a].renderDisplay()}},renderDispose:function(b){Core.Web.Event.removeAll(this.div);this.component.removeListener("tabSelect",this._tabSelectListenerRef);if(this.rotation){this.rotation.abort()}this._activeTabId=null;for(var a=0;a<this.tabs.length;a++){this.tabs[a].dispose()}this.tabs=[];this.div=null},renderUpdate:function(d){var b;if(d.hasUpdatedLayoutDataChildren()||d.hasAddedChildren()||d.hasRemovedChildren()){b=true}else{if(d.isUpdatedPropertySetIn(Extras.Sync.AccordionPane._supportedPartialProperties)&&d.getUpdatedProperty("activeTabId")){this._selectTab(d.getUpdatedProperty("activeTabId").newValue);b=false}else{b=true}}if(b){var a=this.div;var c=a.parentNode;Echo.Render.renderComponentDispose(d,d.parent);c.removeChild(a);this.renderAdd(d,c)}return b},_rotateTabs:function(d,a){var b=this._getTabById(d);if(b==null){this.redrawTabs(true);return}if(this.rotation){this.rotation.abort();this.redrawTabs(true)}else{var c=this._getTabById(a);this.rotation=new Extras.Sync.AccordionPane.Rotation(this,b,c);this.rotation.runTime=this._animationTime;this.rotation.start()}},_selectTab:function(a){if(a==this._activeTabId){return}var b=this._activeTabId;this._activeTabId=a;if(b!=null&&this._animationTime>0){this._rotateTabs(b,a)}else{this.redrawTabs(true)}},_tabSelectListener:function(a){this._selectTab(a.tab.renderId)}});Extras.Sync.AccordionPane.Tab=Core.extend({tabDiv:null,_parent:null,containerDiv:null,contentDiv:null,childComponent:null,$construct:function(a,b){this.childComponent=a;this._parent=b},_addEventListeners:function(){Core.Web.Event.add(this.tabDiv,"click",Core.method(this,this._processClick),false);if(this._parent.component.render("tabRolloverEnabled",true)){Core.Web.Event.add(this.tabDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseenter":"mouseover",Core.method(this,this._processEnter),false);Core.Web.Event.add(this.tabDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseleave":"mouseout",Core.method(this,this._processExit),false)}Core.Web.Event.Selection.disable(this.tabDiv)},dispose:function(){Core.Web.Event.removeAll(this.tabDiv);this._parent=null;this.childComponent=null;this.tabDiv=null;this.containerDiv=null},getContentInsets:function(){if(this.childComponent.pane){return 0}else{var a=this._parent.component.render("defaultContentInsets");return a?a:Extras.Sync.AccordionPane._DEFAULTS.tabContentInsets}},_processClick:function(a){if(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component)){return}this._parent.component.doTabSelect(this.childComponent.renderId)},_processEnter:function(a){if(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component)){return}this._renderState(true)},_processExit:function(a){if(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component)){return}this._renderState(false)},render:function(c){var b=this.childComponent.render("layoutData")||{};this.tabDiv=document.createElement("div");this.tabDiv.id=this._parent.component.renderId+"_tab_"+this.childComponent.renderId;this.tabDiv.style.cssText="cursor:pointer;position:absolute;left:0;right:0;overflow:hidden;";Echo.Sync.Insets.render(this._parent.component.render("tabInsets",Extras.Sync.AccordionPane._DEFAULTS.tabInsets),this.tabDiv,"padding");if(b.icon){var a=document.createElement("img");Echo.Sync.ImageReference.renderImg(b.icon,a);a.style.paddingRight="3px";this.tabDiv.appendChild(a);Core.Web.Image.monitor(this.tabDiv,this._parent.imageMonitorRef)}this.tabDiv.appendChild(document.createTextNode(b.title?b.title:"\u00a0"));this.containerDiv=document.createElement("div");this.containerDiv.style.cssText="display:none;position:absolute;left:0;right:0;overflow:hidden;";this.contentDiv=document.createElement("div");this.contentDiv.style.cssText="position:absolute;left:0;right:0;overflow:auto;";Echo.Sync.Insets.render(this.getContentInsets(),this.contentDiv,"padding");Echo.Render.renderComponentAdd(c,this.childComponent,this.contentDiv);this.containerDiv.appendChild(this.contentDiv);this._renderState(false);this._addEventListeners()},_renderState:function(j){var g=this.tabDiv,c=this._parent.component.render("tabBorder",Extras.Sync.AccordionPane._DEFAULTS.tabBorder),i,d,a=this._parent.component.render("tabBackground",Extras.Sync.AccordionPane._DEFAULTS.tabBackground);if(j){var b=this._parent.component.render("tabRolloverBackground");if(!b){b=Echo.Sync.Color.adjust(a,20,20,20)}Echo.Sync.Color.render(b,g,"backgroundColor");var h=this._parent.component.render("tabRolloverBackgroundImage");if(h){g.style.backgroundImage="";g.style.backgroundPosition="";g.style.backgroundRepeat="";Echo.Sync.FillImage.render(h,g,null)}var f=this._parent.component.render("tabRolloverForeground");if(f){Echo.Sync.Color.render(f,g,"color")}Echo.Sync.Font.render(this._parent.component.render("tabRolloverFont"),g);var e=this._parent.component.render("tabRolloverBorder");if(!e){e=c;if(Echo.Sync.Border.isMultisided(e)){i=Echo.Sync.Border.parse(e.top);d=Echo.Sync.Border.parse(e.bottom);e={top:Echo.Sync.Border.compose(i.size,i.style,Echo.Sync.Color.adjust(i.color,20,20,20)),bottom:Echo.Sync.Border.compose(d.size,d.style,Echo.Sync.Color.adjust(d.color,20,20,20))}}else{i=Echo.Sync.Border.parse(e);e=Echo.Sync.Border.compose(i.size,i.style,Echo.Sync.Color.adjust(i.color,20,20,20))}}}else{Echo.Sync.Color.render(a,g,"backgroundColor");Echo.Sync.Color.render(this._parent.component.render("tabForeground",Extras.Sync.AccordionPane._DEFAULTS.tabForeground),g,"color");Echo.Sync.Font.renderClear(this._parent.component.render("tabFont"),g);g.style.backgroundImage="";g.style.backgroundPosition="";g.style.backgroundRepeat="";Echo.Sync.FillImage.render(this._parent.component.render("tabBackgroundImage"),g)}if(Echo.Sync.Border.isMultisided(c)){Echo.Sync.Border.render(c.top,g,"borderTop");Echo.Sync.Border.render(c.bottom,g,"borderBottom")}else{Echo.Sync.Border.render(c,g,"borderTop");Echo.Sync.Border.render(c,g,"borderBottom")}},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this.tabDiv);Core.Web.VirtualPosition.redraw(this.containerDiv);Core.Web.VirtualPosition.redraw(this.contentDiv)}});Extras.Sync.AccordionPane.Rotation=Core.extend(Extras.Sync.Animation,{_parent:null,_oldTab:null,_newTab:null,_oldTabIndex:null,_newTabIndex:null,_directionDown:null,_rotatingTabCount:null,_regionHeight:null,_numberOfTabsAbove:null,_numberOfTabsBelow:null,_startPosition:null,_animationDistance:null,$construct:function(a,b,c){this._parent=a;this._oldTab=b;this._newTab=c;this._regionHeight=this._parent.div.offsetHeight;this._oldTabIndex=Core.Arrays.indexOf(this._parent.tabs,this._oldTab);this._newTabIndex=Core.Arrays.indexOf(this._parent.tabs,this._newTab);this._rotatingTabCount=Math.abs(this._newTabIndex-this._oldTabIndex);this._directionDown=this._newTabIndex<this._oldTabIndex;if(this._directionDown){this._numberOfTabsAbove=this._newTabIndex+1;this._numberOfTabsBelow=this._parent.tabs.length-1-this._newTabIndex;this._startPosition=this._parent.getTabHeight(0,this._newTabIndex+1);this._animationDistance=this._regionHeight-this._parent.getTabHeight(this._newTabIndex+1,this._parent.tabs.length)-this._startPosition}else{this._numberOfTabsAbove=this._newTabIndex;this._numberOfTabsBelow=this._parent.tabs.length-1-this._newTabIndex;this._startPosition=this._parent.getTabHeight(this._newTabIndex+1,this._parent.tabs.length);this._animationDistance=this._regionHeight-this._parent.getTabHeight(0,this._newTabIndex+1)-this._startPosition}},complete:function(){this._parent.rotation=null;var a=this._parent;if(this._parent.resetOverflowForAnimation){this._oldTab.contentDiv.style.overflow="auto";this._newTab.contentDiv.style.overflow="auto"}var b=this._parent.component.renderId;this._parent=null;this._oldTab=null;this._newTab=null;a.redrawTabs(true)},init:function(){this._newTab.containerDiv.style.height="";if(this._directionDown){this._oldTab.containerDiv.style.bottom="";this._newTab.containerDiv.style.top=this._parent.getTabHeight(0,this._newTabIndex+1)+"px"}else{this._newTab.containerDiv.style.top="";this._newTab.containerDiv.style.bottom=this._parent.getTabHeight(this._newTabIndex+1,this._parent.tabs.length)+"px"}this._newTab.containerDiv.style.display="block";var e=this._parent.div.offsetHeight-this._parent.getTabHeight(0,this._parent.tabs.length);var c=Echo.Sync.Insets.toPixels(this._oldTab.getContentInsets());var b=Echo.Sync.Insets.toPixels(this._newTab.getContentInsets());var d=e-c.top-c.bottom;var a=e-b.top-b.bottom;d=d>0?d:0;a=a>0?a:0;if(this._parent.resetOverflowForAnimation){this._oldTab.contentDiv.style.overflow="hidden";this._newTab.contentDiv.style.overflow="hidden"}this._oldTab.contentDiv.style.bottom="";this._newTab.contentDiv.style.bottom="";this._oldTab.contentDiv.style.height=d+"px";this._newTab.contentDiv.style.height=a+"px"},step:function(b){var d,c,f,e=Math.round(b*this._animationDistance);if(this._directionDown){for(d=this._oldTabIndex;d>this._newTabIndex;--d){this._parent.tabs[d].tabDiv.style.top=(e+this._startPosition+this._parent.getTabHeight(this._newTabIndex+1,d))+"px"}f=e;if(f<0){f=0}this._newTab.containerDiv.style.height=f+"px";var a=e+this._startPosition+this._parent.getTabHeight(this._newTabIndex+1,this._oldTabIndex+1);this._oldTab.containerDiv.style.top=a+"px";c=this._regionHeight-this._parent.getTabHeight(this._newTabIndex,this._oldTabIndex);if(c<0){c=0}this._oldTab.containerDiv.style.height=c+"px"}else{for(d=this._oldTabIndex+1;d<=this._newTabIndex;++d){this._parent.tabs[d].tabDiv.style.bottom=(e+this._startPosition+this._parent.getTabHeight(d+1,this._newTabIndex+1))+"px"}c=this._regionHeight-e-this._parent.getTabHeight(this._oldTabIndex,this._newTabIndex);if(c<0){c=0}this._oldTab.containerDiv.style.height=c+"px";f=e;if(f<0){f=0}this._newTab.containerDiv.style.height=f+"px"}}});Extras.Sync.BorderPane=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.BorderPane",this)},_div:null,_content:null,renderAdd:function(e,b){this._div=Echo.Sync.FillImageBorder.renderContainer(this.component.render("border",Extras.BorderPane.DEFAULT_BORDER),{absolute:true,content:true});this._div.id=this.component.renderId;this._div.style.top=this._div.style.right=this._div.style.bottom=this._div.style.left=0;this._content=Echo.Sync.FillImageBorder.getContainerContent(this._div);Echo.Sync.renderComponentDefaults(this.component,this._content);Echo.Sync.FillImage.render(this.component.render("backgroundImage"),this._content);var c=this.component.getComponentCount();if(c==1){var d=this.component.getComponent(0);var a=d.pane?null:this.component.render("insets");if(a){Echo.Sync.Insets.render(a,this._content,"padding")}Echo.Render.renderComponentAdd(e,d,this._content)}else{if(c>1){throw new Error("Too many children: "+c)}}b.appendChild(this._div)},renderDisplay:function(){Echo.Sync.FillImageBorder.renderContainerDisplay(this._div);Core.Web.VirtualPosition.redraw(this._content);Core.Web.VirtualPosition.redraw(this._div)},renderDispose:function(a){this._content=null;this._div=null},renderUpdate:function(c){var a=this._div;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b);return true}});Extras.Sync.CalendarSelect=Core.extend(Echo.Render.ComponentSync,{$static:{DEFAULTS:{border:"1px outset #cfcfcf",background:"#cfcfcf",foreground:"#000000",font:{size:"10pt"},dateForeground:"#000000",dateBackground:"#dfdfdf",dateBorder:{top:"1px solid #efefef",left:"1px solid #efefef",right:"1px solid #bfbfbf",bottom:"1px solid #bfbfbf"},selectedDateForeground:"#ffffff",selectedDateBackground:"#2f2f6f",adjacentMonthDateForeground:"#8f8f8f"},MINIMUM_YEAR:1582,MAXIMUM_YEAR:9999,_DAYS_IN_MONTH:[31,null,31,30,31,30,31,31,30,31,30,31],resource:new Core.ResourceBundle({"DayOfWeek.0":"Sunday","DayOfWeek.1":"Monday","DayOfWeek.2":"Tuesday","DayOfWeek.3":"Wednesday","DayOfWeek.4":"Thursday","DayOfWeek.5":"Friday","DayOfWeek.6":"Saturday","Month.0":"January","Month.1":"February","Month.2":"March","Month.3":"April","Month.4":"May","Month.5":"June","Month.6":"July","Month.7":"August","Month.8":"September","Month.9":"October","Month.10":"November","Month.11":"December",FirstDayOfWeek:0}),Animation:Core.extend(Extras.Sync.Animation,{_container:null,_containerBounds:null,_oldContent:null,_newContent:null,_vertical:null,_forward:null,_travel:null,_overlap:null,_oldColor:null,_newColor:null,_adjust:null,runTime:500,$construct:function(c,g,b,d,f,a,h,e){this._container=c;this._oldContent=g;this._newContent=b;this._vertical=d;this._forward=f;this._overlap=a||0;this._oldColor=h;this._newColor=e},init:function(){this._containerBounds=new Core.Web.Measure.Bounds(this._container);this._travel=(this._vertical?this._containerBounds.height:this._containerBounds.width)-this._overlap;this._adjust=this._vertical?(this._forward?"top":"bottom"):(this._forward?"left":"right");this._newContent.style[this._adjust]=this._travel+"px";this._container.appendChild(this._newContent)},step:function(b){var a=Math.round(this._travel*(1-b));this._oldContent.style.color=Echo.Sync.Color.blend(this._oldColor,this._newColor,2*b);this._oldContent.style[this._adjust]=(a-this._travel)+"px";this._newContent.style[this._adjust]=a+"px"},complete:function(a){this._newContent.style.left=this._newContent.style.top=this._newContent.style.right=this._newContent.style.bottom="";if(this._oldContent.parentNode){this._oldContent.parentNode.removeChild(this._oldContent)}}}),MonthData:Core.extend({firstDayOfMonth:null,daysInMonth:null,daysInPreviousMonth:null,year:null,month:null,weekCount:null,firstCellPosition:null,$construct:function(c,d,a){this.year=c;this.month=d;var b=new Date(c,d,1);this.firstDayOfMonth=b.getDay();this.daysInMonth=Extras.Sync.CalendarSelect.getDaysInMonth(c,d);this.daysInPreviousMonth=d===0?Extras.Sync.CalendarSelect.getDaysInMonth(c-1,11):this._daysInPreviousMonth=Extras.Sync.CalendarSelect.getDaysInMonth(c,d-1);this.firstCellPosition=(7+this.firstDayOfMonth-a)%7;this.nextMonthWeek=Math.floor((this.firstCellPosition+this.daysInMonth)/7);this.weekCount=Math.ceil((this.firstCellPosition+this.daysInMonth)/7)},getCellDate:function(b){var a;if(b<this.firstCellPosition){a=this.month===0?{month:11,year:this.year-1}:{month:this.month-1,year:this.year};a.day=this.daysInPreviousMonth-this.firstCellPosition+b+1}else{if(b>=(this.firstCellPosition+this.daysInMonth)){a=this.month===11?{month:0,year:this.year+1}:{month:this.month+1,year:this.year};a.day=b-this.firstCellPosition-this.daysInMonth+1}else{a={month:this.month,year:this.year,day:b-this.firstCellPosition+1}}}return a},getCellIndex:function(a){return a+this.firstCellPosition-1},isCellAdjacent:function(a){return a<this.firstCellPosition||a>=(this.firstDayOfMonth+this.daysInMonth)}}),getDaysInMonth:function(a,b){if(b==1){if(a%400===0){return 29}else{if(a%100===0){return 28}else{if(a%4===0){return 29}else{return 28}}}}else{return this._DAYS_IN_MONTH[b]}}},$load:function(){Echo.Render.registerPeer("Extras.CalendarSelect",this)},_div:null,_monthYearInput:null,_monthSelect:null,_yearField:null,_dateRolloverBackground:null,_dateRolloverBackgroundImage:null,_dateRolloverBorder:null,_dateRolloverForeground:null,_dateSelectedBackground:null,_dateSelectedBackgroundImage:null,_dateSelectedBorder:null,_dateSelectedForeground:null,_rolloverCellIndex:null,_displayedMonth:null,_displayedYear:null,_firstDayOfWeek:null,_date:null,_msg:null,_icons:null,_animateUpdate:function(b,d,c){if(this._animation){this._animation.abort()}var e=this._createDayContainer();var a=c?(c*this._cellHeight+(c-1)*this._vCellSpacing):0;this._animation=new Extras.Sync.CalendarSelect.Animation(this._scrollContainer,this._dayContainerDiv,e,b,d,a,this._dateForeground,this._dateAdjacentForeground);this._animation.start(Core.method(this,function(f){this._dayContainerDiv=e;this._animation=null}))},_createDayContainer:function(){var a=document.createElement("div");a.style.cssText="position:absolute;";a.style.width=this._rowWidth+"px";a.style.height=(this._ySize*this._cellHeight+(this._ySize-1)*this._vCellSpacing)+"px";for(var c=0;c<this._ySize;++c){var b=this._createWeek(c);b.style.top=(c*(this._cellHeight+this._vCellSpacing))+"px";a.appendChild(b)}return a},_createMonthYearInput:function(){var c,e,a,b=this.component.isRenderEnabled(),d=document.createElement("span");this._monthSelect=document.createElement("select");for(c=0;c<12;++c){e=document.createElement("option");e.appendChild(document.createTextNode(this._msg["Month."+c]));this._monthSelect.appendChild(e)}if(!b){this._monthSelect.disabled=true}d.appendChild(this._monthSelect);d.appendChild(document.createTextNode(" "));this._yearDecSpan=document.createElement("span");this._yearDecSpan.style.cursor="pointer";a=document.createElement("img");a.src=this._icons.decrement?this._icons.decrement:this.client.getResourceUrl("Extras","image/calendar/Decrement.gif");a.alt="-";this._yearDecSpan.appendChild(a);d.appendChild(this._yearDecSpan);this._yearField=document.createElement("input");this._yearField.type="text";this._yearField.style.textAlign="center";this._yearField.maxLength=4;this._yearField.size=5;if(!b){this._yearField.readOnly=true}d.appendChild(this._yearField);this._yearIncSpan=document.createElement("span");this._yearIncSpan.style.cursor="pointer";a=document.createElement("img");a.src=this._icons.increment?this._icons.increment:this.client.getResourceUrl("Extras","image/calendar/Increment.gif");a.alt="+";this._yearIncSpan.appendChild(a);d.appendChild(this._yearIncSpan);return d},_createWeek:function(b){var c=1-this._monthData.firstCellPosition+(7*b);var e=document.createElement("div");e.style.cssText="position:absolute;overflow:hidden;cursor:pointer;";e.style.width=this._rowWidth+"px";e.style.height=this._cellHeight+"px";for(var a=0;a<this._xSize;++a,++c){var d=document.createElement("div");d._cellIndex=7*b+a;d.style.cssText="position:absolute;text-align:right;";d.style.left=(a*(this._cellWidth+this._hCellSpacing))+"px";d.style.width=this._renderedCellWidth+"px";d.style.height=this._renderedCellHeight+"px";Echo.Sync.Border.render(this._dateBorder,d);d.style.padding="2px 4px";d.style.overflow="hidden";var f;if(c<1){d.style.color=this._dateAdjacentForeground;f=this._monthData.daysInPreviousMonth+c}else{if(c>this._monthData.daysInMonth){d.style.color=this._dateAdjacentForeground;f=c-this._monthData.daysInMonth}else{if(this._date.day==c){Echo.Sync.Color.render(this._dateSelectedBackground,d,"backgroundColor");Echo.Sync.Color.render(this._dateSelectedForeground,d,"color");Echo.Sync.FillImage.render(this._dateSelectedBackgroundImage,d);Echo.Sync.Border.render(this._dateSelectedBorder,d)}f=c}}d.appendChild(document.createTextNode(f));e.appendChild(d)}return e},_getCell:function(a){return this._dayContainerDiv.childNodes[Math.floor(a/7)].childNodes[a%7]},_loadRenderData:function(){this._font=this.component.render("font",Extras.Sync.CalendarSelect.DEFAULTS.font);this._dateBackground=this.component.render("dateBackground",Extras.Sync.CalendarSelect.DEFAULTS.dateBackground);this._dateBorder=this.component.render("dateBorder",Extras.Sync.CalendarSelect.DEFAULTS.dateBorder);this._dateBackgroundImage=this.component.render("dateBackgroundImage");this._dateForeground=this.component.render("dateForeground",Extras.Sync.CalendarSelect.DEFAULTS.dateForeground);this._dateSelectedBackground=this.component.render("selectedDateBackground",Extras.Sync.CalendarSelect.DEFAULTS.selectedDateBackground);this._dateSelectedBackgroundImage=this.component.render("selectedDateBackgroundImage");this._dateSelectedBorder=this.component.render("selectedDateBorder");this._dateSelectedForeground=this.component.render("selectedDateForeground",Extras.Sync.CalendarSelect.DEFAULTS.selectedDateForeground);this._dateRolloverBackground=this.component.render("rolloverDateBackground");this._dateRolloverBackgroundImage=this.component.render("rolloverDateBackgroundImage");this._dateRolloverBorder=this.component.render("rolloverDateBorder");this._dateRolloverForeground=this.component.render("rolloverDateForeground");if(!this._dateRolloverBackground){this._dateRolloverBackground=Echo.Sync.Color.adjust(this._dateBackground,32,32,32)}this._dateAdjacentForeground=this.component.render("adjacentMonthDateForeground",Extras.Sync.CalendarSelect.DEFAULTS.adjacentMonthDateForeground);this._dateAdjacentBackground=this.component.render("adjacentMonthDateBackground");var a=document.createElement("span");a.appendChild(document.createTextNode("96"));Echo.Sync.Font.render(this._font,a);var b=new Core.Web.Measure.Bounds(a);this._padding={top:2,bottom:2,left:4,right:4};this._borderSize={top:1,bottom:1,left:1,right:1};this._cellWidth=b.width+this._padding.left+this._padding.right+this._borderSize.left+this._borderSize.right;if(this._cellWidth*7<this._monthYearWidth){this._cellWidth=Math.ceil(this._monthYearWidth/7)}this._cellHeight=b.height+this._padding.top+this._padding.bottom+this._borderSize.top+this._borderSize.bottom;this._hCellSpacing=0;this._vCellSpacing=0;this._headerHeight=b.height;this._headerMargin=0;this._xSize=7;this._ySize=6;this._rowWidth=this._xSize*this._cellWidth+(this._xSize-1)*this._hCellSpacing;this._calendarHeight=this._ySize*this._cellHeight+(this._ySize-1)*this._vCellSpacing+this._headerHeight+this._headerMargin;this._renderedCellWidth=this._cellWidth-this._borderSize.left-this._borderSize.right-this._padding.left-this._padding.right;this._renderedCellHeight=this._cellHeight-this._borderSize.top-this._borderSize.bottom-this._padding.top-this._padding.bottom},_processDateRolloverEnter:function(a){if(!this.client||!this.client.verifyInput(this.component)||a.target._cellIndex==null||this._animation){return}if(this._rolloverCellIndex!=null){this._setCellStyle(this._rolloverCellIndex,false)}this._rolloverCellIndex=a.target._cellIndex;this._setCellStyle(this._rolloverCellIndex,true)},_processDateRolloverExit:function(a){if(this._rolloverCellIndex){this._setCellStyle(this._rolloverCellIndex,false);this._rolloverCellIndex=null}},_processDateSelect:function(a){if(!this.client||!this.client.verifyInput(this.component)||a.target._cellIndex==null||this._animation){return}this._setDate(this._monthData.getCellDate(a.target._cellIndex))},_processMonthSelect:function(a){if(!this.client||!this.client.verifyInput(this.component)){this._monthSelect.selectedIndex=this._date.month;return}this._setDate({year:this._date.year,month:this._monthSelect.selectedIndex,day:this._date.day})},_processYearChange:function(b){var a=parseInt(this._yearField.value,10);if(!this.client||!this.client.verifyInput(this.component)||isNaN(a)){this._yearField.value=this._date.year;return}this._setDate({year:a,month:this._date.month,day:this._date.day})},_processYearKeyUp:function(a){if(a.keyCode==13){this._processYearChange(a)}},_processYearDecrement:function(a){if(!this.client||!this.client.verifyInput(this.component)){return}this._setDate({year:this._date.year-1,month:this._date.month,day:this._date.day})},_processYearIncrement:function(a){if(!this.client||!this.client.verifyInput(this.component)){return}this._setDate({year:this._date.year+1,month:this._date.month,day:this._date.day})},_rangeCheck:function(a){if(a.year<Extras.Sync.CalendarSelect.MINIMUM_YEAR){a.year=Extras.Sync.CalendarSelect.MINIMUM_YEAR}else{if(a.year>Extras.Sync.CalendarSelect.MAXIMUM_YEAR){a.year=Extras.Sync.CalendarSelect.MAXIMUM_YEAR}}},renderAdd:function(g,q){g=null;this._msg=Extras.Sync.CalendarSelect.resource.get(this.component.getRenderLocale());this._icons={};var k,h,c,n,o,d,b,e,r,l=this.component.isRenderEnabled(),p=parseInt(this.component.render("dayOfWeekNameAbbreviationLength",2),10),a=this.component.get("date");this._firstDayOfWeek=parseInt(this.component.render("firstDayOfWeek",this._msg.FirstDayOfWeek),10)||0;if(!a){a=new Date()}this._date={year:a.getFullYear(),month:a.getMonth(),day:a.getDate()};this._monthData=new Extras.Sync.CalendarSelect.MonthData(this._date.year,this._date.month,this._firstDayOfWeek);this._monthYearInput=this._createMonthYearInput();this._monthYearWidth=new Core.Web.Measure.Bounds(this._monthYearInput).width+10;this._loadRenderData();this._div=document.createElement("div");this._div.id=this.component.renderId;this._div.style.cssText="text-align:left;width:"+(this._cellWidth*this._xSize)+"px;";Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this._div);Echo.Sync.Font.render(this._font,this._div);Echo.Sync.Color.render(this.component.render("foreground",Extras.Sync.CalendarSelect.DEFAULTS.foreground),this._div,"color");Echo.Sync.Color.render(this.component.render("background",Extras.Sync.CalendarSelect.DEFAULTS.background),this._div,"backgroundColor");Echo.Sync.FillImage.render(this.component.render("backgroundImage"),this._div);Echo.Sync.Border.render(this.component.render("border",Extras.Sync.CalendarSelect.DEFAULTS.border),this._div);Echo.Sync.Font.render(this.component.render("font"),this._div);e=document.createElement("div");e.align="center";e.style.cssText="padding:2px 5px;white-space:nowrap;overflow:hidden;";e.appendChild(this._monthYearInput);this._div.appendChild(e);this._calendarDiv=document.createElement("div");this._calendarDiv.style.cssText="position:relative;";this._calendarDiv.style.width=this._rowWidth+"px";this._calendarDiv.style.height=this._calendarHeight+"px";this._div.appendChild(this._calendarDiv);this._currentRowDivs=[];var m=document.createElement("div");m.style.cssText="position:absolute;";m.style.width=(this._cellWidth*7)+"px";m.style.height=this._headerHeight+"px";Echo.Sync.Color.render(this.component.render("headerForeground",Extras.Sync.CalendarSelect.DEFAULTS.foreground),m,"color");Echo.Sync.Color.render(this.component.render("headerBackground",Extras.Sync.CalendarSelect.DEFAULTS.background),m,"backgroundColor");Echo.Sync.FillImage.render(this.component.render("headerBackgroundImage"),m);this._calendarDiv.appendChild(m);for(o=0;o<this._xSize;++o){d=document.createElement("div");d.style.cssText="position:absolute;text-align:center;";d.style.left=(o*(this._cellWidth+this._hCellSpacing))+"px";d.style.width=this._cellWidth+"px";d.style.height=this._headerHeight+"px";d.style.overflow="hidden";b=this._msg["DayOfWeek."+((this._firstDayOfWeek+o)%7)];if(p>0){b=b.substring(0,p)}d.appendChild(document.createTextNode(b));m.appendChild(d)}this._scrollContainer=document.createElement("div");this._scrollContainer.style.cssText="position:absolute;overflow:hidden;";this._scrollContainer.style.top=(this._headerHeight+this._headerMargin)+"px";this._scrollContainer.style.height=(this._ySize*this._cellHeight+(this._ySize-1)*this._vCellSpacing)+"px";this._scrollContainer.style.width=this._rowWidth+"px";Echo.Sync.Color.render(this._dateForeground,this._scrollContainer,"color");Echo.Sync.Color.render(this._dateBackground,this._scrollContainer,"backgroundColor");Echo.Sync.FillImage.render(this._dateBackgroundImage,this._scrollContainer);this._calendarDiv.appendChild(this._scrollContainer);this._dayContainerDiv=this._createDayContainer();this._scrollContainer.appendChild(this._dayContainerDiv);q.appendChild(this._div);Core.Web.Event.add(this._monthSelect,"change",Core.method(this,this._processMonthSelect),false);Core.Web.Event.add(this._yearField,"change",Core.method(this,this._processYearChange),false);Core.Web.Event.add(this._yearField,"keyup",Core.method(this,this._processYearKeyUp),false);Core.Web.Event.add(this._yearDecSpan,"click",Core.method(this,this._processYearDecrement),false);Core.Web.Event.add(this._yearIncSpan,"click",Core.method(this,this._processYearIncrement),false);Core.Web.Event.add(this._calendarDiv,"click",Core.method(this,this._processDateSelect),false);Core.Web.Event.add(this._calendarDiv,"mouseover",Core.method(this,this._processDateRolloverEnter),false);Core.Web.Event.add(this._calendarDiv,"mouseout",Core.method(this,this._processDateRolloverExit),false);this._updateMonthYearSelection();if(this._numMonitorRegistrations===undefined){this._numMonitorRegistrations=0}var f=true;if((Core.Web.Env.BROWSER_INTERNET_EXPLORER&&(Core.Web.Env.BROWSER_VERSION_MAJOR>=9))){if(this._numMonitorRegistrations>1){this._numMonitorRegistrations=0;f=false}}if(f){this._numMonitorRegistrations++;Core.Web.Image.monitor(this._div,Core.method(this,function(){this._renderSizeUpdate()}))}},renderDispose:function(a){a=null;Core.Web.Event.removeAll(this._monthSelect);Core.Web.Event.removeAll(this._yearField);Core.Web.Event.removeAll(this._yearDecSpan);Core.Web.Event.removeAll(this._yearIncSpan);Core.Web.Event.removeAll(this._calendarDiv);this._div=null;this._monthSelect=null;this._yearField=null;this._yearDecSpan=null;this._yearIncSpan=null;this._dayContainerDiv=null;this._scrollContainer=null;this._calendarDiv=null;this._monthYearInput=null},_renderSizeUpdate:function(){var c=new Core.Web.Measure.Bounds(this._monthYearInput).width+10;if(this._monthYearWidth===c){return}var a=this._div;var b=a.parentNode;this.renderDispose(null);b.removeChild(a);this.renderAdd(null,b)},renderUpdate:function(d){if(d&&d.isUpdatedPropertySetIn({date:true})){var a=this.component.get("date")||new Date();if(this._date.month==a.getMonth()&&this._date.day==a.getDate()&&this._date.year==a.getFullYear()){return false}}if(this._animation){this._animation.abort()}var b=this._div;var c=b.parentNode;Echo.Render.renderComponentDispose(d,d.parent);c.removeChild(b);this.renderAdd(d,c);return false},_setCellStyle:function(c,e,d){var b=this._monthData.getCellDate(c);var a=this._getCell(c);if(!d&&b.day==this._date.day&&b.month==this._date.month&&b.year==this._date.year){Echo.Sync.Color.renderClear(this._dateSelectedBackground,a,"backgroundColor");Echo.Sync.Color.renderClear(this._dateSelectedForeground,a,"color");Echo.Sync.FillImage.render(this._dateSelectedBackgroundImage,a);Echo.Sync.Border.render(this._dateSelectedBorder,a)}else{if(!d&&e){Echo.Sync.Color.renderClear(this._dateRolloverBackground,a,"backgroundColor");Echo.Sync.Color.renderClear(this._dateRolloverForeground,a,"color");Echo.Sync.FillImage.render(this._dateRolloverBackgroundImage,a);Echo.Sync.Border.render(this._dateRolloverBorder,a)}else{if(this._monthData.isCellAdjacent(c)){Echo.Sync.Color.renderClear(this._dateAdjacentBackground,a,"backgroundColor");Echo.Sync.Color.renderClear(this._dateAdjacentForeground,a,"color")}else{Echo.Sync.Border.renderClear(this._dateBorder,a);a.style.backgroundImage="";a.style.backgroundColor="";a.style.color=""}}}},_setDate:function(d){var c=this._date,f=this._monthData.getCellIndex(this._date.day),e,b;this._setCellStyle(f,false,true);this._rangeCheck(d);this._date=d;this._monthData=new Extras.Sync.CalendarSelect.MonthData(d.year,d.month,this._firstDayOfWeek);if(d.year==c.year){if(d.month==c.month){e=this._monthData.getCellIndex(this._date.day);this._setCellStyle(e,false)}else{if(c.month-d.month==1){b=this._monthData.nextMonthWeek==4?2:1}else{if(c.month-d.month==-1){var a=new Extras.Sync.CalendarSelect.MonthData(c.year,c.month,this._firstDayOfWeek);b=a.nextMonthWeek==4?2:1}else{b=0}}this._animateUpdate(true,c.month<d.month,b)}}else{this._animateUpdate(false,c.year<d.year)}this._updateMonthYearSelection();this._storeValue();this.component.doAction()},_storeValue:function(){this.component.set("date",new Date(this._date.year,this._date.month,this._date.day))},_updateMonthYearSelection:function(){if(parseInt(this._yearField.value,10)!==this._date.year){this._yearField.value=this._date.year}if(this._monthSelect.selectedIndex!=this._date.month){this._monthSelect.selectedIndex=this._date.month}}});Extras.Sync.ColorSelect=Core.extend(Echo.Render.ComponentSync,{$static:{RGB:Core.extend({$static:{_fromHsv:function(j,u,n){var a,k,m;if(u===0){a=k=m=n}else{j/=60;var e=Math.floor(j);var l=j-e;var d=n*(1-u);var c=n*(1-u*l);var o=n*(1-u*(1-l));switch(e){case 0:a=n;k=o;m=d;break;case 1:a=c;k=n;m=d;break;case 2:a=d;k=n;m=o;break;case 3:a=d;k=c;m=n;break;case 4:a=o;k=d;m=n;break;default:a=n;k=d;m=c;break}}return new Extras.Sync.ColorSelect.RGB(Math.round(a*255),Math.round(k*255),Math.round(m*255))}},r:null,g:null,b:null,$construct:function(d,c,a){this.r=this._clean(d);this.g=this._clean(c);this.b=this._clean(a)},_clean:function(a){a=a?parseInt(a,10):0;if(a<0){return 0}else{if(a>255){return 255}else{return a}}},toHexTriplet:function(){var b=this.r.toString(16);if(b.length==1){b="0"+b}var c=this.g.toString(16);if(c.length==1){c="0"+c}var a=this.b.toString(16);if(a.length==1){a="0"+a}return"#"+b+c+a},toString:function(){return this.toHexTriplet()}})},$load:function(){Echo.Render.registerPeer("Extras.ColorSelect",this)},_h:0,_s:0,_v:0,_processHMouseMoveRef:null,_processHMouseUpRef:null,_processSVMouseMoveRef:null,_processSVMouseUpRef:null,_cursorBorderLight:"1px solid #ffffff",_cursorBorderDark:"1px solid #cfcfcf",_cursorBorderShadow:"1px solid #000000",_lineOpacity:0.8,_shadowOpacity:0.3,_svXOffset:7,_svYOffset:7,_barRadius:2,_boxRadius:2,$construct:function(){this._processHMouseMoveRef=Core.method(this,this._processHMouseMove);this._processHMouseUpRef=Core.method(this,this._processHMouseUp);this._processSVMouseMoveRef=Core.method(this,this._processSVMouseMove);this._processSVMouseUpRef=Core.method(this,this._processSVMouseUp)},_processHMouseDown:function(a){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return}Core.Web.Event.add(this._hListenerDiv,"mousemove",this._processHMouseMoveRef,false);Core.Web.Event.add(this._hListenerDiv,"mouseup",this._processHMouseUpRef,false);this._processHUpdate(a)},_processHMouseMove:function(a){this._processHUpdate(a)},_processHMouseUp:function(a){Core.Web.Event.remove(this._hListenerDiv,"mousemove",this._processHMouseMoveRef,false);Core.Web.Event.remove(this._hListenerDiv,"mouseup",this._processHMouseUpRef,false);this._storeColor()},_processHUpdate:function(a){var b=Core.Web.DOM.getEventOffset(a);this._h=(this._svHeight-(b.y-7))*360/this._svHeight;this._updateDisplayedColor();Core.Web.DOM.preventEventDefault(a)},_processSVMouseDown:function(a){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return}Core.Web.Event.add(this._svListenerDiv,"mousemove",this._processSVMouseMoveRef,false);Core.Web.Event.add(this._svListenerDiv,"mouseup",this._processSVMouseUpRef,false);this._processSVUpdate(a)},_processSVMouseMove:function(a){this._processSVUpdate(a)},_processSVMouseUp:function(a){Core.Web.Event.remove(this._svListenerDiv,"mousemove",this._processSVMouseMoveRef,false);Core.Web.Event.remove(this._svListenerDiv,"mouseup",this._processSVMouseUpRef,false);this._storeColor()},_processSVUpdate:function(a){var b=Core.Web.DOM.getEventOffset(a);this._v=(b.x-this._svXOffset)/this._svWidth;this._s=1-((b.y-this._svYOffset)/this._svHeight);this._updateDisplayedColor();Core.Web.DOM.preventEventDefault(a)},renderAdd:function(h,b){this._svWidth=Echo.Sync.Extent.toPixels(this.component.render("valueWidth",Extras.ColorSelect.DEFAULT_VALUE_WIDTH),true);this._svHeight=Echo.Sync.Extent.toPixels(this.component.render("saturationHeight",Extras.ColorSelect.DEFAULT_SATURATION_HEIGHT),false);this._hWidth=Echo.Sync.Extent.toPixels(this.component.render("hueWidth",Extras.ColorSelect.DEFAULT_HUE_WIDTH),true);var g=Core.Web.Measure.extentToPixels("1em",false);var f=this.client.getResourceUrl("Extras","image/colorselect/ColorSelectSVGradient.png");var d=this.client.getResourceUrl("Extras","image/colorselect/ColorSelectHGradient.png");this._div=document.createElement("div");this._div.id=this.component.renderId;this._div.style.cssText="position:relative;left:0;top:0;overflow:hidden;";this._div.style.width=(this._svWidth+this._hWidth+29)+"px";this._div.style.height=(this._svHeight+18+g)+"px";this._svDiv=document.createElement("div");this._svDiv.style.cssText="position:absolute;background-color:#ff0000;overflow:hidden;";this._svDiv.style.left=this._svXOffset+"px";this._svDiv.style.top=this._svYOffset+"px";this._svDiv.style.width=this._svWidth+"px";this._svDiv.style.height=this._svHeight+"px";this._div.appendChild(this._svDiv);if(f){if(Core.Web.Env.PROPRIETARY_IE_PNG_ALPHA_FILTER_REQUIRED){this._svDiv.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+f+"', sizingMethod='scale');"}else{var a=document.createElement("img");a.src=f;a.style.width=this._svWidth+"px";a.style.height=this._svHeight+"px";this._svDiv.appendChild(a)}}this._svCursorDiv=this._createSVCursor();this._svDiv.appendChild(this._svCursorDiv);var c=document.createElement("div");c.style.cssText="position:absolute;top:7px;overflow:hidden;";c.style.left=(this._svWidth+22)+"px";c.style.width=this._hWidth+"px";c.style.height=this._svHeight+"px";this._div.appendChild(c);if(d){var e=document.createElement("img");e.src=d;e.style.cssText="position:absolute;left:0;top:0;";e.style.width=this._hWidth+"px";e.style.height=this._svHeight+"px";c.appendChild(e)}this._hCursorDiv=this._createHCursor();c.appendChild(this._hCursorDiv);this._colorDiv=document.createElement("div");this._colorDiv.style.cssText="position:absolute;left:7px;color:#ffffff;background-color:#000000;text-align:center;vertical-align:middle;overflow:hidden;border:1px #000000 outset;font-family:monospace;text-align:center;";this._colorDiv.style.height=g+"px";this._colorDiv.style.top=(this._svHeight+16)+"px";this._colorDiv.style.width=(this._svWidth+this._hWidth+13)+"px";if(this.component.render("displayValue")){this._colorDiv.appendChild(document.createTextNode("#000000"))}this._div.appendChild(this._colorDiv);this._svListenerDiv=document.createElement("div");this._svListenerDiv.style.cssText="position:absolute;z-index:1;left:0;top:0;cursor:crosshair;";this._svListenerDiv.style.width=(this._svWidth+14)+"px";this._svListenerDiv.style.height=(this._svHeight+14)+"px";this._svListenerDiv.style.backgroundImage="url("+this.client.getResourceUrl("Echo","resource/Transparent.gif")+")";this._div.appendChild(this._svListenerDiv);this._hListenerDiv=document.createElement("div");this._hListenerDiv.style.cssText="position:absolute;z-index:1;top:0;cursor:crosshair;";this._hListenerDiv.style.left=(this._svWidth+15)+"px";this._hListenerDiv.style.width=(this._hWidth+14)+"px";this._hListenerDiv.style.height=(this._svHeight+16)+"px";this._hListenerDiv.style.backgroundImage="url("+this.client.getResourceUrl("Echo","resource/Transparent.gif")+")";this._div.appendChild(this._hListenerDiv);b.appendChild(this._div);Core.Web.Event.add(this._svListenerDiv,"mousedown",Core.method(this,this._processSVMouseDown),false);Core.Web.Event.add(this._hListenerDiv,"mousedown",Core.method(this,this._processHMouseDown),false);this._setColor(this.component.get("color"))},_createHCursor:function(){var a=document.createElement("div");a.style.cssText="position:absolute;";var b;b=document.createElement("div");b.style.cssText="position:absolute;font-size:1px;line-height:0;top:1px;";b.style.opacity=this._shadowOpacity;b.style.width=this._hWidth+"px";b.style.height=(this._barRadius*2-1)+"px";b.style.borderTop=this._cursorBorderShadow;b.style.borderBottom=this._cursorBorderShadow;a.appendChild(b);b=document.createElement("div");b.style.cssText="position:absolute;font-size:1px;line-height:0;";b.style.opacity=this._lineOpacity;b.style.width=this._hWidth+"px";b.style.height=(this._barRadius*2-1)+"px";b.style.borderTop=this._cursorBorderLight;b.style.borderBottom=this._cursorBorderDark;a.appendChild(b);return a},_createSVCursor:function(){var d=document.createElement("div");d.style.cssText="position:absolute;";d.style.width=(this._svWidth*2-1)+"px";d.style.height=(this._svHeight*2-1)+"px";var a,b,c;a=b=this._cursorBorderShadow;c=this._shadowOpacity;d.appendChild(this._createSVCursorLine(1,1,true,true,a,b,c));d.appendChild(this._createSVCursorLine(1,1,false,true,a,b,c));d.appendChild(this._createSVCursorLine(1,1,true,false,a,b,c));d.appendChild(this._createSVCursorLine(1,1,false,false,a,b,c));a=this._cursorBorderLight;b=this._cursorBorderDark;c=this._lineOpacity;d.appendChild(this._createSVCursorLine(0,0,true,true,a,b,c));d.appendChild(this._createSVCursorLine(0,0,false,true,a,b,c));d.appendChild(this._createSVCursorLine(0,0,true,false,a,b,c));d.appendChild(this._createSVCursorLine(0,0,false,false,a,b,c));return d},_createSVCursorLine:function(a,h,g,d,c,f,e){var b=document.createElement("div");b.style.cssText="position:absolute;line-height:0;font-size:1px;";b.style.opacity=e;b.style[d?"borderLeft":"borderTop"]=c;b.style[d?"borderRight":"borderBottom"]=f;if(d){b.style.left=(a+this._svWidth-this._barRadius)+"px";b.style.height=(this._svHeight-this._boxRadius)+"px";b.style.width=(this._barRadius*2-1)+"px";if(!g){b.style.top=(1+h+this._svHeight+this._boxRadius)+"px"}}else{b.style.top=(h+this._svHeight-this._barRadius)+"px";b.style.width=(this._svWidth-this._boxRadius)+"px";b.style.height=(this._barRadius*2-1)+"px";if(!g){b.style.left=(1+a+this._svWidth+this._boxRadius)+"px"}}return b},renderDispose:function(a){Core.Web.Event.removeAll(this._svListenerDiv);Core.Web.Event.removeAll(this._hListenerDiv);this._div=null;this._svDiv=null;this._svListenerDiv=null;this._hListenerDiv=null;this._svCursorDiv=null;this._hCursorDiv=null;this._colorDiv=null},renderUpdate:function(c){var b=this._div;var a=b.parentNode;Echo.Render.renderComponentDispose(c,c.parent);a.removeChild(b);this.renderAdd(c,a);return false},_setColor:function(d){var h,f,c;if(d){d=d.substring(1);h=Math.floor(parseInt(d,16)/65536)/255;f=(Math.floor(parseInt(d,16)/256)%256)/255;c=(parseInt(d,16)%256)/255}else{h=f=c=0}var e=Math.min(h,f,c);var a=Math.max(h,f,c);this._v=a;var i=a-e;if(a===0||i===0){this._s=0}else{this._s=i/a;if(h==a){this._h=60*((f-c)/i)}else{if(f==a){this._h=60*(2+(c-h)/i)}else{this._h=60*(4+(h-f)/i)}}if(this._h<0){this._h+=360}}this._updateDisplayedColor()},_storeColor:function(){var a=Extras.Sync.ColorSelect.RGB._fromHsv(this._h,this._s,this._v);var b=a.toHexTriplet();this.component.set("color",b)},_updateDisplayedColor:function(){var f;if(this.component.isRenderEnabled()){f=Extras.Sync.ColorSelect.RGB._fromHsv(this._h,1,1)}else{f=Extras.Sync.ColorSelect.RGB._fromHsv(this._h,0.3,0.7)}this._svDiv.style.backgroundColor=f.toHexTriplet();var a=Extras.Sync.ColorSelect.RGB._fromHsv(this._h,this._s,this._v);var e=a.toHexTriplet();this._colorDiv.style.backgroundColor=e;this._colorDiv.style.borderColor=e;this._colorDiv.style.color=this._v<0.67?"#ffffff":"#000000";if(this.component.render("displayValue")){this._colorDiv.childNodes[0].nodeValue=e}var d=Math.floor((1-this._s)*this._svHeight);if(d<0){d=0}else{if(d>this._svHeight){d=this._svHeight}}var b=Math.floor(this._v*this._svWidth);if(b<0){b=0}else{if(b>this._svWidth){b=this._svWidth}}this._svCursorDiv.style.top=(d-this._svHeight)+"px";this._svCursorDiv.style.left=(b-this._svWidth)+"px";var c=Math.floor((360-this._h)/360*this._svHeight);if(c<0){c=0}else{if(c>this._svHeight){c=this._svHeight}}this._hCursorDiv.style.top=c-this._barRadius+"px"}});Extras.Sync.DataGrid=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.DataGrid",this)},$static:{LEFT:{h:-1,v:0},RIGHT:{h:1,v:0},UP:{h:0,v:-1},DOWN:{h:0,v:1},REGION_LOCATIONS:{topLeft:{h:-1,v:-1},top:{h:0,v:-1},topRight:{h:1,v:-1},left:{h:-1,v:0},center:{h:0,v:0},right:{h:1,v:0},bottomLeft:{h:-1,v:1},bottom:{h:0,v:1},bottomRight:{h:1,v:1}},intersect:function(b,a,d,c){return(d<=b&&b<=c)||(b<=d&&d<=a)},ScrollPosition:Core.extend({xIndex:null,yIndex:null,xScroll:0,yScroll:0,load:function(a){this.setIndex(a.get("columnIndex"),a.get("rowIndex"));this.setScroll(a.get("columnScroll"),a.get("rowScroll"))},setIndex:function(a,b){if(a!=null){this.xIndex=a;this.xScroll=null}if(b!=null){this.yIndex=b;this.yScroll=null}},setScroll:function(a,b){if(a!=null){this.xScroll=a;this.xIndex=null}if(b!=null){this.yScroll=b;this.yIndex=null}},store:function(a){a.set("columnScroll",this.xScroll,true);a.set("rowScroll",this.yScroll,true);a.set("columnIndex",this.xIndex,true);a.set("rowIndex",this.yIndex,true)}}),CellRenderer:Core.extend({$abstract:{render:function(a,c,b,d){}},$virtual:{dispose:null}}),RenderContext:Core.extend({_states:null,dataGrid:null,$construct:function(a){this.dataGrid=a;this._states={}},dispose:function(){for(var a in this._states){}},getState:function(a,b){return this._states[a+","+b]},setState:function(a,c,b){this._states[a+","+c]=b}}),Tile:Core.extend({dataGrid:null,displayed:false,div:null,_table:null,region:null,edge:null,cellIndex:null,tileIndex:null,positionPx:null,_renderContext:null,$construct:function(a,c,b,d){this.dataGrid=a;this._renderContext=new Extras.Sync.DataGrid.RenderContext(a);this.containerElement=c.element;this.tileIndex={column:b,row:d};this.region=c;this.edge={left:this.tileIndex.column===0,top:this.tileIndex.row===0};this.cellIndex={};switch(this.region.location.h){case -1:this.cellIndex.left=this.tileIndex.column*this.dataGrid.tileSize.columns;this.cellIndex.right=this.cellIndex.left+this.dataGrid.tileSize.columns-1;if(this.cellIndex.right>=this.dataGrid.fixedCells.left){this.cellIndex.right=this.dataGrid.fixedCells.left-1;this.edge.right=true}break;case 0:this.cellIndex.left=this.tileIndex.column*this.dataGrid.tileSize.columns+this.dataGrid.fixedCells.left;this.cellIndex.right=this.cellIndex.left+this.dataGrid.tileSize.columns-1;if(this.cellIndex.right>=this.dataGrid.size.columns-this.dataGrid.fixedCells.right-1){this.cellIndex.right=this.dataGrid.size.columns-this.dataGrid.fixedCells.right-1;this.edge.right=true}break;case 1:this.cellIndex.left=this.dataGrid.size.columns-this.dataGrid.fixedCells.right+(this.tileIndex.column*this.dataGrid.tileSize.columns);this.cellIndex.right=this.cellIndex.left+this.dataGrid.tileSize.columns-1;if(this.cellIndex.right>=this.dataGrid.size.columns-1){this.cellIndex.right=this.dataGrid.size.columns-1;this.edge.right=true}break}switch(this.region.location.v){case -1:this.cellIndex.top=this.tileIndex.row*this.dataGrid.tileSize.rows;this.cellIndex.bottom=this.cellIndex.top+this.dataGrid.tileSize.rows-1;if(this.cellIndex.bottom>=this.dataGrid.fixedCells.top){this.cellIndex.bottom=this.dataGrid.fixedCells.top-1;this.edge.bottom=true}break;case 0:this.cellIndex.top=this.tileIndex.row*this.dataGrid.tileSize.rows+this.dataGrid.fixedCells.top;this.cellIndex.bottom=this.cellIndex.top+this.dataGrid.tileSize.rows-1;if(this.cellIndex.bottom>=this.dataGrid.size.rows-this.dataGrid.fixedCells.bottom-1){this.cellIndex.bottom=this.dataGrid.size.rows-this.dataGrid.fixedCells.bottom-1;this.edge.bottom=true}break;case 1:this.cellIndex.top=this.dataGrid.size.rows-this.dataGrid.fixedCells.bottom+(this.tileIndex.row*this.dataGrid.tileSize.rows);this.cellIndex.bottom=this.cellIndex.top+this.dataGrid.tileSize.rows-1;if(this.cellIndex.bottom>=this.dataGrid.size.rows-1){this.cellIndex.bottom=this.dataGrid.size.rows-1;this.edge.bottom=true}break}},adjustPositionPx:function(b,a){if(this.div){if(a){this.positionPx.left+=b;this.div.style.left=this.positionPx.left+"px"}else{this.positionPx.top+=b;this.div.style.top=this.positionPx.top+"px"}}if(!this.isOnScreen()){this.remove()}},create:function(){if(this.div){return}var e,h,g,c;var b=[];this.positionPx={};this.positionPx.width=0;for(c=this.cellIndex.left;c<=this.cellIndex.right;++c){this.positionPx.width+=b[c]=this.dataGrid._getColumnWidth(c)}this.div=document.createElement("div");this.div.style.cssText="position:absolute;";this._table=this.dataGrid.getPrototypeTable().cloneNode(true);this._table.style.width=this.positionPx.width+"px";this.div.appendChild(this._table);for(g=this.cellIndex.top;g<=this.cellIndex.bottom;++g){e=document.createElement("tr");for(c=this.cellIndex.left;c<=this.cellIndex.right;++c){h=document.createElement("td");h.style.cssText="padding:0;overflow:hidden;";Echo.Sync.Border.render(this.dataGrid._cellBorder,h);if(g===this.cellIndex.top){h.style.width=(b[c]-this.dataGrid._cellBorderWidthPx)+"px"}var d=this.dataGrid._model.get(c,g);if(d==null){d="\u00a0"}var a=d.toString().split("\n");for(var f=0;f<a.length;++f){if(f>0){h.appendChild(document.createElement("br"))}h.appendChild(document.createTextNode(a[f]))}e.appendChild(h)}this._table.firstChild.appendChild(e)}this.div.style.width=this.positionPx.width+"px";this.dataGrid.measureDiv.appendChild(this.div);this.positionPx.height=this.div.offsetHeight||100;this.positionPx.rowHeights=[];e=this._table.firstChild.firstChild;while(e){this.positionPx.rowHeights.push(e.offsetHeight);e=e.nextSibling}this.dataGrid.measureDiv.removeChild(this.div)},display:function(d,c,b,a){if(this.displayed){return}this.create();if(b!=null){d=b-this.positionPx.width}if(a!=null){c=a-this.positionPx.height}this.div.style.top=c+"px";this.div.style.left=d+"px";this.positionPx.top=c;this.positionPx.left=d;this.containerElement.appendChild(this.div);this.displayed=true},dispose:function(){this._renderContext.dispose();this.div=this._table=null},isEdgeBottom:function(){return this.edge.bottom||(this.positionPx.top<this.region.bounds.height&&this.positionPx.top+this.positionPx.height>=this.region.bounds.height)},isEdgeLeft:function(){return this.edge.left||this.tileIndex.column===0||(this.positionPx.left<=0&&this.positionPx.left+this.positionPx.width>0)},isEdgeRight:function(){return this.edge.right||(this.positionPx.left<this.region.bounds.width&&this.positionPx.left+this.positionPx.width>=this.region.bounds.width)},isEdgeTop:function(){return this.edge.top||this.tileIndex.row===0||(this.positionPx.top<=0&&this.positionPx.top+this.positionPx.height>0)},isOnScreen:function(){if(!this.displayed){return false}return Extras.Sync.DataGrid.intersect(this.positionPx.left,this.positionPx.left+this.positionPx.width,0,this.region.bounds.width)&&Extras.Sync.DataGrid.intersect(this.positionPx.top,this.positionPx.top+this.positionPx.height,0,this.region.bounds.height)},remove:function(){if(this.displayed){this.div.parentNode.removeChild(this.div);this.displayed=false}},setRowHeight:function(c,a){var d=this.positionPx.rowHeights[c];var b=this._table.firstChild;b.childNodes[c].style.height=a+"px";this.positionPx.rowHeights[c]=a;this.positionPx.height+=a-d},toString:function(){return"Tile ("+this.tileIndex.column+","+this.tileIndex.row+")"}}),Region:Core.extend({dataGrid:null,_tiles:null,size:null,bounds:null,name:null,location:null,$construct:function(a,b){var d,c;this.dataGrid=a;this.name=b;this._tiles={};this.location=Extras.Sync.DataGrid.REGION_LOCATIONS[b];this.element=document.createElement("div");this.element.style.cssText="position:absolute;overflow:hidden;";if(this.location.h!==0||this.location.v!==0){this.element.style.backgroundColor="#dfffdf"}switch(this.location.v){case -1:this.element.style.top=0;d=this.dataGrid.fixedCells.top;break;case 0:d=this.dataGrid.scrollSize.rows;break;case 1:this.element.style.bottom=0;d=this.dataGrid.fixedCells.bottom;break}switch(this.location.h){case -1:this.element.style.left=0;c=this.dataGrid.fixedCells.left;break;case 0:c=this.dataGrid.scrollSize.columns;break;case 1:this.element.style.right=0;c=this.dataGrid.fixedCells.right;break}this.size={columns:c,rows:d};this.tileCount={columns:Math.ceil(c/this.dataGrid.tileSize.columns),rows:Math.ceil(d/this.dataGrid.tileSize.rows)}},adjustPositionPx:function(b,a){if((this.location.h&&a)||(this.location.v&&!a)){return}var g,h,d;for(h in this._tiles){g=this._tiles[h];for(var c in g){d=g[c];d.adjustPositionPx(b,a)}}this.fill(false);this.fill(true);var e=false,f=false;for(h in this._tiles){if(h===0){e=true}if(e&&f){break}}},clear:function(){for(var d in this._tiles){var c=this._tiles[d];for(var a in c){var b=c[a];b.remove();b.dispose()}}this._tiles={}},positionTileAdjacent:function(c,g,f){var e,b,d,a;switch(f.h){case -1:b=c.positionPx.left;break;case 1:e=c.positionPx.left+c.positionPx.width;break;default:e=c.positionPx.left}switch(f.v){case -1:a=c.positionPx.top;break;case 1:d=c.positionPx.top+c.positionPx.height;break;default:d=c.positionPx.top}g.display(e,d,b,a)},fill:function(b){var a=this._findVerticalEdgeTile(b),c;while(!a.isEdgeLeft()){c=this.getTile(a.tileIndex.column-1,a.tileIndex.row);this.positionTileAdjacent(a,c,Extras.Sync.DataGrid.LEFT);a=c}var d=a;if(d==null){alert("FIXME...can't find left edge tile, scenario not handled yet.")}else{do{a=d;while(a.isOnScreen()&&!a.isEdgeRight()){c=this.getTile(a.tileIndex.column+1,a.tileIndex.row);this.positionTileAdjacent(a,c,Extras.Sync.DataGrid.RIGHT);a=c}this.synchronizeHeights(d);c=this.getTile(d.tileIndex.column,d.tileIndex.row+(b?-1:1));if(c==null){break}this.positionTileAdjacent(d,c,b?Extras.Sync.DataGrid.UP:Extras.Sync.DataGrid.DOWN);d=c}while(d.isOnScreen())}},_findVerticalEdgeTile:function(a){var e,d,b=null,f;for(f in this._tiles){if(b==null||(a?(f>b):(f<b))){e=this._tiles[f];for(var c in e){if(e[c].isOnScreen()){d=e[c];b=f;break}}}}return d},getTile:function(a,d){if(a<0||d<0||a>this.size.columns/this.dataGrid.tileSize.columns||d>this.size.rows/this.dataGrid.tileSize.rows){return null}var c=this._tiles[d];if(!c){c={};this._tiles[d]=c}var b=c[a];if(!b){b=new Extras.Sync.DataGrid.Tile(this.dataGrid,this,a,d);c[a]=b}return b},getBorderTilesX:function(){if(this.location.h!==0||this.location.v!==0){throw new Error("Cannot invoke getPositionV on tile other than center.")}var d,a;for(var f in this._tiles){var e=this._tiles[f];for(var b in e){var c=e[b];if(c.displayed&&c.isOnScreen()){if(c.positionPx.left<=0){d=c}if(c.positionPx.left+c.positionPx.width>this.bounds.width){a=c}break}}if(d&&a){break}}return{left:d,right:a}},getBorderTilesY:function(){if(this.location.h!==0||this.location.v!==0){throw new Error("Cannot invoke getPositionV on tile other than center.")}var a,i,b=null,g=null;for(var e in this._tiles){var h=this._tiles[e];for(var d in h){var c=h[d];if(c.displayed&&c.isOnScreen()){if(b==null||c.positionPx.top<b){b=c.positionPx.top;if(b<=0){a=c}}var f=this.bounds.height-(c.positionPx.top+c.positionPx.height);if(g==null||f<g){g=f;if(g<=0){i=c}}break}}if(a&&i){break}}return{top:a,bottom:i,topPx:b,bottomPx:g}},renderTiles:function(){var i,d,c,b,h=0,e=0,g,a=0,f=0;this.clear();if(this.location.h===0){if(this.dataGrid.scrollPosition.xScroll!=null){i=this.dataGrid.scrollPosition.xScroll/100;c=this.dataGrid.scrollSize.columns*i}else{c=this.dataGrid.scrollPosition.xIndex||0}e=Math.floor(c/this.dataGrid.tileSize.columns)}if(this.location.v===0){if(this.dataGrid.scrollPosition.yScroll!=null){d=this.dataGrid.scrollPosition.yScroll/100;b=this.dataGrid.scrollSize.rows*d}else{b=this.dataGrid.scrollPosition.yIndex||0}h=Math.floor(b/this.dataGrid.tileSize.rows)}g=this.getTile(e,h);g.create();if(this.location.h===0){if(this.dataGrid.scrollPosition.xScroll!=null){a=i*(this.bounds.width-g.positionPx.width)}}if(this.location.v===0){if(this.dataGrid.scrollPosition.yScroll!=null){f=d*(this.bounds.height-g.positionPx.height)}}g.display(a,f);this.fill(false);this.fill(true)},notifySeparatorUpdate:function(){var a=this.dataGrid.separatorPx;this.bounds={};switch(this.location.h){case -1:this.element.style.width=a.left+"px";this.bounds.width=a.left;break;case 0:this.element.style.left=a.left+"px";this.element.style.right=a.right+"px";this.bounds.width=this.dataGrid.scrollContainer.bounds.width-a.left-a.right;break;case 1:this.element.style.width=a.right+"px";this.bounds.width=a.right;break}switch(this.location.v){case -1:this.element.style.height=a.top+"px";this.bounds.height=a.top;break;case 0:this.element.style.top=a.top+"px";this.element.style.bottom=a.bottom+"px";this.bounds.height=this.dataGrid.scrollContainer.bounds.height-a.top-a.bottom;break;case 1:this.element.style.height=a.bottom+"px";this.bounds.height=a.bottom;break}},synchronizeHeights:function(g){var d=g,a=[g],c,e,f,b;while(d.isOnScreen()&&!d.isEdgeRight()){d=this.getTile(d.tileIndex.column+1,d.tileIndex.row);a.push(d)}d=null;for(f=0;f<g.positionPx.rowHeights.length;++f){c=g.positionPx.rowHeights[f];e=false;for(b=1;b<a.length;++b){if(a[b].positionPx.rowHeights[f]!=c){e=true;if(a[b].positionPx.rowHeights[f]>c){c=a[b].positionPx.rowHeights[f]}}}if(e){for(b=0;b<a.length;++b){a[b].setRowHeight(f,c)}Core.Debug.consoleWrite("adjust")}else{Core.Debug.consoleWrite("no adjust")}}}})},tileSize:{columns:5,rows:3},_fullRenderRequired:null,_div:null,measureDiv:null,scrollPosition:null,visibleRange:null,overscroll:null,regions:null,_model:null,separatorPx:null,size:null,scrollSize:null,_cellBorderWidthPx:null,_cellBorderHeightPx:null,fixedCells:null,scrollContainer:null,$construct:function(){this._div=null;this.visibleRange={};this.overscroll={};this.scrollPosition=new Extras.Sync.DataGrid.ScrollPosition()},adjustPositionPx:function(b,a){if(a){if(Math.abs(b)>this.regions.center.bounds.width/2){b=this.regions.center.bounds.width/2*(b<0?-1:1)}}else{if(Math.abs(b)>this.regions.center.bounds.height/2){b=this.regions.center.bounds.height/2*(b<0?-1:1)}}this._adjustRegionPositionPx(b,a);if(a){this._updateScrollContainerX();this.scrollPosition.setIndex(this.visibleRange.left,null);this.scrollPosition.store(this.component)}else{if(this.overscroll.top&&this.overscroll.top>0){this._adjustRegionPositionPx(0-this.overscroll.top,a)}else{if(this.overscroll.bottom&&this.overscroll.bottom>0){this._adjustRegionPositionPx(this.overscroll.bottom,a);if(this.overscroll.top&&this.overscroll.top>0){this._adjustRegionPositionPx(0-this.overscroll.top,a)}}}this._updateScrollContainerY();this.scrollPosition.setIndex(null,this.visibleRange.top);this.scrollPosition.store(this.component)}},_adjustRegionPositionPx:function(c,a){for(var b in this.regions){this.regions[b].adjustPositionPx(c,a)}if(a){this.updateVisibleRangeX()}else{this.updateVisibleRangeY()}},_createRegions:function(){this.regions={};if(this.fixedCells.top){if(this.fixedCells.left){this.regions.topLeft=new Extras.Sync.DataGrid.Region(this,"topLeft")}this.regions.top=new Extras.Sync.DataGrid.Region(this,"top");if(this.fixedCells.right){this.regions.topRight=new Extras.Sync.DataGrid.Region(this,"topRight")}}if(this.fixedCells.bottom){if(this.fixedCells.left){this.regions.bottomLeft=new Extras.Sync.DataGrid.Region(this,"bottomLeft")}this.regions.bottom=new Extras.Sync.DataGrid.Region(this,"bottom");if(this.fixedCells.right){this.regions.bottomRight=new Extras.Sync.DataGrid.Region(this,"bottomRight")}}if(this.fixedCells.left){this.regions.left=new Extras.Sync.DataGrid.Region(this,"left")}this.regions.center=new Extras.Sync.DataGrid.Region(this,"center");if(this.fixedCells.right){this.regions.right=new Extras.Sync.DataGrid.Region(this,"right")}for(var a in this.regions){this.scrollContainer.contentElement.appendChild(this.regions[a].element)}this._updateSeparators()},_getColumnWidth:function(a){return 80},getPrototypeTable:function(){if(!this._prototypeTable){this._prototypeTable=document.createElement("table");this._prototypeTable.cellPadding=this._prototypeTable.cellSpacing=0;this._prototypeTable.style.cssText="table-layout:fixed;padding:0;border:0px none;";var a=document.createElement("tbody");this._prototypeTable.appendChild(a)}return this._prototypeTable},_getRowHeight:function(a){return 19},_loadProperties:function(){this._cellBorder=this.component.render("cellBorder");this._cellBorderHeightPx=Echo.Sync.Border.getPixelSize(this._cellBorder,"top")+Echo.Sync.Border.getPixelSize(this._cellBorder,"bottom");this._cellBorderWidthPx=Echo.Sync.Border.getPixelSize(this._cellBorder,"left")+Echo.Sync.Border.getPixelSize(this._cellBorder,"right");this._model=this.component.get("model");this.scrollPosition.load(this.component);this.fixedCells={left:parseInt(this.component.render("fixedColumnsLeft",0),10),top:parseInt(this.component.render("fixedRowsTop",0),10),right:parseInt(this.component.render("fixedColumnsRight",0),10),bottom:parseInt(this.component.render("fixedRowsBottom",0),10)}},_processScroll:function(b){if(b.incremental){if(b.verticalIncrement){this._scrollIncremental(b.verticalIncrement,false)}else{if(b.horizontalIncrement){this._scrollIncremental(b.horizontalIncrement,true)}}}else{this.scrollPosition.setScroll(b.horizontal==null?null:b.horizontal,b.vertical==null?null:b.vertical);this.scrollPosition.store(this.component);for(var a in this.regions){if((b.horizontal&&this.regions[a].location.h===0)||(b.vertical&&this.regions[a].location.v===0)){this.regions[a].renderTiles()}}this.scrollContainer.setPosition(this.scrollPosition.xScroll,this.scrollPosition.yScroll)}},renderAdd:function(b,a){this._div=document.createElement("div");this._div.style.cssText="position:absolute;top:0;left:0;right:0;bottom:0;";this._div.id=this.component.renderId;this.measureDiv=document.createElement("div");this.measureDiv.style.cssText="position:absolute;top:0;width:1600px;height:1200px;left:-1600px;overflow:hidden;";this._div.appendChild(this.measureDiv);this.scrollContainer=new Extras.Sync.DataGrid.ScrollContainer();this.scrollContainer.configure(10,10);this.scrollContainer.onScroll=Core.method(this,this._processScroll);this._div.appendChild(this.scrollContainer.rootElement);this._loadProperties();this._fullRenderRequired=true;a.appendChild(this._div)},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this._div);this.scrollContainer.renderDisplay();if(this._fullRenderRequired){if(this._model==null){this.size={columns:0,rows:0};this.scrollSize={columns:0,rows:0}}else{this.size={columns:this._model.getColumnCount(),rows:this._model.getRowCount()};this.scrollSize={columns:this.size.columns-this.fixedCells.left-this.fixedCells.right,rows:this.size.rows-this.fixedCells.top-this.fixedCells.bottom}}this._createRegions();if(this._model){this.renderRegionTiles()}this._fullRenderRequired=false}this._updateSeparators()},renderDispose:function(a){this._cachedTileRows={};this._prototypeTable=null;this.regions=null;this._div=null;this.measureDiv=null},renderUpdate:function(c){var a=this._div;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b);return true},_scrollIncremental:function(c,a){var b=Math.round((a?this.scrollContainer.bounds.width:this.scrollContainer.bounds.height)*c/10);this.adjustPositionPx(0-b,a)},renderRegionTiles:function(){for(var a in this.regions){this.regions[a].renderTiles()}this.scrollContainer.setPosition(this.scrollPosition.xScroll,this.scrollPosition.yScroll)},_updateScrollContainerX:function(){var a=0;if(this.visibleRange.left!=null&&this.visibleRange.right!=null){a=100*(this.visibleRange.left+this.visibleRange.right)/2/this.size.columns}else{if(this.visibleRange.left!=null){a=100*this.visibleRange.left/this.size.columns}}this.scrollContainer.setPosition(a,null)},_updateScrollContainerY:function(){var a=0;if(this.visibleRange.top!=null&&this.visibleRange.bottom!=null){a=100*(this.visibleRange.top+this.visibleRange.bottom)/2/this.size.rows}else{if(this.visibleRange.top!=null){a=100*this.visibleRange.top/this.size.rows}}this.scrollContainer.setPosition(null,a)},_updateSeparators:function(){var b,a;this.separatorPx={left:0,top:0,right:0,bottom:0};if(this.fixedCells.top){for(b=0;b<this.fixedCells.top;++b){this.separatorPx.top+=this._getRowHeight(b)}}if(this.fixedCells.bottom){for(b=0;b<this.fixedCells.bottom;++b){this.separatorPx.bottom+=this._getRowHeight(this.size.rows-b-1)}}if(this.fixedCells.left){for(b=0;b<this.fixedCells.left;++b){this.separatorPx.left+=this._getColumnWidth(b)}}if(this.fixedCells.right){for(b=0;b<this.fixedCells.right;++b){this.separatorPx.right+=this._getColumnWidth(this.size.columns-b-1)}}for(a in this.regions){this.regions[a].notifySeparatorUpdate()}},updateVisibleRangeX:function(){var b=this.regions.center.getBorderTilesX(),a;if(b.left){a=b.left.cellIndex.right-b.left.cellIndex.left+1;this.visibleRange.left=b.left.cellIndex.left+a*(0-b.left.positionPx.left)/b.left.positionPx.width}else{this.visibleRange.left=null}if(b.right){a=b.right.cellIndex.right-b.right.cellIndex.left+1;this.visibleRange.right=1+b.right.cellIndex.right-a*(b.right.positionPx.left+b.right.positionPx.width-this.regions.center.bounds.width)/b.right.positionPx.width}else{this.visibleRange.right=null}},updateVisibleRangeY:function(){var b=this.regions.center.getBorderTilesY(),a;if(b.top){a=b.top.cellIndex.bottom-b.top.cellIndex.top+1;this.visibleRange.top=b.top.cellIndex.top+a*(0-b.top.positionPx.top)/b.top.positionPx.height;this.overscroll.top=null}else{this.visibleRange.top=null;this.overscroll.top=b.topPx}if(b.bottom){a=b.bottom.cellIndex.bottom-b.bottom.cellIndex.top+1;this.visibleRange.bottom=1+b.bottom.cellIndex.bottom-a*(b.bottom.positionPx.top+b.bottom.positionPx.height-this.regions.center.bounds.height)/b.bottom.positionPx.height;this.overscroll.bottom=null}else{this.visibleRange.bottom=null;this.overscroll.bottom=b.bottomPx}}});Extras.Sync.DataGrid.ScrollContainer=Core.extend({_hScrollAccumulator:0,_vScrollAccumulator:0,bounds:null,rootElement:null,contentElement:null,_lastScrollSetTime:0,size:5,scrollX:0,scrollY:0,onScroll:null,$construct:function(a,b){this.rootElement=document.createElement("div");this.rootElement.style.cssText="position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;";this._vScrollContainer=document.createElement("div");this._vScrollContainer.style.cssText="position:absolute;top:0;bottom:0;right:0;overflow:scroll;";this._vScrollContainer.style.width=(1+Core.Web.Measure.SCROLL_WIDTH)+"px";this._vScrollContent=document.createElement("div");this._vScrollContent.style.cssText="width:1px;height:"+(this.size*100)+"%;";this._vScrollContainer.appendChild(this._vScrollContent);this.rootElement.appendChild(this._vScrollContainer);this._hScrollContainer=document.createElement("div");this._hScrollContainer.style.cssText="position:absolute;bottom:0;left:0;right:0;overflow:scroll;";this._hScrollContainer.style.height=(1+Core.Web.Measure.SCROLL_HEIGHT)+"px";this._hScrollContent=document.createElement("div");this._hScrollContent.style.cssText="height:1px;width:"+(this.size*100)+"%;";this._hScrollContainer.appendChild(this._hScrollContent);this.rootElement.appendChild(this._hScrollContainer);this.contentElement=document.createElement("div");this.contentElement.style.cssText="position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;background:white;";this.rootElement.appendChild(this.contentElement);Core.Web.Event.add(this._vScrollContainer,"scroll",Core.method(this,this._processScrollV),true);Core.Web.Event.add(this._hScrollContainer,"scroll",Core.method(this,this._processScrollH),true);Core.Web.Event.add(this.rootElement,Core.Web.Env.BROWSER_MOZILLA?"DOMMouseScroll":"mousewheel",Core.method(this,this._processWheel),true)},_accumulatedScroll:function(){if(this._vScrollAccumulator||this._hScrollAccumulator){var a=this._vScrollAccumulator;this._vScrollAccumulator=0;var b=this._hScrollAccumulator;this._hScrollAccumulator=0;if(this.onScroll){this.onScroll({source:this,type:"scroll",incremental:true,horizontalIncrement:b,verticalIncrement:a})}}},configure:function(a,b){if(a>1){this._vScrollContainer.style.bottom=this.contentElement.style.bottom=Core.Web.Measure.SCROLL_HEIGHT+"px"}else{this._vScrollContainer.style.bottom=this.contentElement.style.bottom=0}if(b>1){this._hScrollContainer.style.right=this.contentElement.style.right=Core.Web.Measure.SCROLL_WIDTH+"px"}else{this._hScrollContainer.style.right=this.contentElement.style.right=0}},dispose:function(){Core.Web.Event.removeAll(this._hScrollContainer);Core.Web.Event.removeAll(this._vScrollContainer);Core.Web.Event.removeAll(this.rootElement);this.rootElement=null;this.contentElement=null},_isUserScroll:function(){return(new Date().getTime()-this._lastScrollSetTime)>400},_processScrollH:function(a){if(!this._isUserScroll()){return}this.scrollX=100*this._hScrollContainer.scrollLeft/((this.size-1)*this.bounds.width);if(this.onScroll){this.onScroll({source:this,type:"scroll",incremental:false,horizontal:this.scrollX})}},_processScrollV:function(a){if(!this._isUserScroll()){return}this.scrollY=100*this._vScrollContainer.scrollTop/((this.size-1)*this.bounds.height);if(this.onScroll){this.onScroll({source:this,type:"scroll",incremental:false,vertical:this.scrollY})}},_processWheel:function(b){var a;if(b.wheelDelta){a=b.wheelDelta/-120}else{if(b.detail){a=b.detail/3}else{return}}if(b.shiftKey){this._hScrollAccumulator+=a}else{this._vScrollAccumulator+=a}Core.Web.Scheduler.run(Core.method(this,this._accumulatedScroll),10);Core.Web.DOM.preventEventDefault(b);return true},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this.rootElement);Core.Web.VirtualPosition.redraw(this.contentElement);Core.Web.VirtualPosition.redraw(this._hScrollContainer);Core.Web.VirtualPosition.redraw(this._vScrollContainer);this.bounds=new Core.Web.Measure.Bounds(this.contentElement);this._scrollHeight=new Core.Web.Measure.Bounds(this._hScrollContent).height;this._scrollWidth=new Core.Web.Measure.Bounds(this._vScrollContent).width},setPosition:function(b,a){this._lastScrollSetTime=new Date().getTime();if(b!=null){this.scrollX=b;this._hScrollContainer.scrollLeft=this.scrollX/100*((this.size-1)*this.bounds.width)}if(a!=null){this.scrollY=a;this._vScrollContainer.scrollTop=this.scrollY/100*((this.size-1)*this.bounds.height)}}});Extras.Sync.DragSource=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.DragSource",this)},_dragDiv:null,_div:null,_overlayDiv:null,_processMouseMoveRef:null,_processMouseUpRef:null,$construct:function(){this._processMouseMoveRef=Core.method(this,this._processMouseMove);this._processMouseUpRef=Core.method(this,this._processMouseUp)},_dragPreStart:function(a){this._dragStop();Core.Web.Event.add(document.body,"mousemove",this._processMouseMoveRef,true);Core.Web.Event.add(document.body,"mouseup",this._processMouseUpRef,true)},_dragMoveStart:function(a){this._overlayDiv=document.createElement("div");this._overlayDiv.style.cssText="position:absolute;z-index:30000;width:100%;height:100%;cursor:pointer;";Echo.Sync.FillImage.render(this.client.getResourceUrl("Echo","resource/Transparent.gif"),this._overlayDiv);this._dragDiv=this._div.cloneNode(true);this._dragDiv.style.position="absolute";this._setDragOpacity(0.75);this._overlayDiv.appendChild(this._dragDiv);document.body.appendChild(this._overlayDiv)},_dragDrop:function(f){var c,a=null,h,d,g,b=this._findElement(this.client.domainElement,f.clientX,f.clientY);while(!a&&b&&b!=this.client.domainElement){if(b.id){a=this.client.application.getComponentByRenderId(b.id)}b=b.parentNode}if(!a){return}g=this.component.get("dropTargetIds");if(!g){g=[]}d=a;while(d&&!h){for(c=0;c<g.length;++c){if(g[c]==d.renderId){h=d;break}}d=d.parent}if(!h){return}this.component.doDrop(h.renderId,a.renderId)},_dragStop:function(){Core.Web.Event.remove(document.body,"mousemove",this._processMouseMoveRef,true);Core.Web.Event.remove(document.body,"mouseup",this._processMouseUpRef,true);if(this._overlayDiv){document.body.removeChild(this._overlayDiv);this._overlayDiv=null}this._dragDiv=null},_dragUpdate:function(a){this._dragDiv.style.top=a.clientY+"px";this._dragDiv.style.left=a.clientX+"px"},_findElement:function(b,a,h){if(b.style.display=="none"){return null}if(b.style.visibility=="hidden"){return null}if(b.nodeName&&b.nodeName.toLowerCase()=="colgroup"){return null}var g=false;if(!(b.nodeName&&b.nodeName.toLowerCase()=="tr")){var e=new Core.Web.Measure.Bounds(b);if(this._isBoundsDefined(e)){if(this._isInBounds(e,a,h)){g=true}else{return null}}}var f=null;for(var d=0;d<b.childNodes.length;++d){if(b.childNodes[d].nodeType!=1){continue}var c=this._findElement(b.childNodes[d],a,h);if(c){if(f==null){f=[]}f.push(c)}}if(f!=null){if(f.length==1){return f[0]}else{return this._findHighestCandidate(b,f)}}return g?b:null},_findHighestCandidate:function(m,h){var b=[];var c;for(c=0;c<h.length;++c){b[c]=[];var g=h[c];do{if(g.style.zIndex){b[c].unshift(g.style.zIndex)}g=g.parentNode}while(g!=m)}var d=0;var e;do{e=false;var k=0;var a=[];for(c=0;c<b.length;++c){if(d<b[c].length){var l=b[c][d];if(l&&l>0&&l>=k){if(l==k){a.push(c)}else{a=[];a.push(c);k=l}}e=true}}if(a.length==1){return h[a[0]]}else{if(a.length>0){var j=[];for(var f=0;f<a.length;++f){j[f]=h[a[f]]}h=j}}++d}while(e);return h[h.length-1]},_isBoundsDefined:function(a){return a.width!==0&&a.height!==0},_isInBounds:function(b,a,c){return a>=b.left&&c>=b.top&&a<=b.left+b.width&&c<=b.top+b.height},_processMouseDown:function(a){Core.Web.DOM.preventEventDefault(a);if(!this.client||!this.client.verifyInput(this.component)){return}this._dragPreStart(a)},_processMouseMove:function(a){Core.Web.DOM.preventEventDefault(a);if(!this._dragDiv){this._dragMoveStart()}this._dragUpdate(a)},_processMouseUp:function(b){var a=!!this._dragDiv;if(a){Core.Web.DOM.preventEventDefault(b)}this._dragStop();if(a){this._dragDrop(b)}},renderAdd:function(b,a){this._div=document.createElement("div");this._div.id=this.component.renderId;this._div.style.cssText="cursor:pointer;";if(this.component.children.length>0){Echo.Render.renderComponentAdd(b,this.component.children[0],this._div)}Core.Web.Event.add(this._div,"mousedown",Core.method(this,this._processMouseDown),true);a.appendChild(this._div)},renderDispose:function(a){this._dragStop();Core.Web.Event.removeAll(this._div);this._dragDiv=null;this._div=null},renderUpdate:function(c){var a=this._div;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b)},_setDragOpacity:function(a){if(Core.Web.Env.NOT_SUPPORTED_CSS_OPACITY){if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){this._dragDiv.style.filter="alpha(opacity="+(a*100)+")"}}else{this._dragDiv.style.opacity=a}}});Extras.Sync.FlowViewer=Core.extend(Echo.Render.ComponentSync,{$static:{DOUBLE_CLICK_TIME:500},$load:function(){Echo.Render.registerPeer("Extras.FlowViewer",this)},_position:0,_renderedPosition:0,_columnsRendered:false,$construct:function(){this._updateListenerRef=Core.method(this,this._updateListener)},_clearContent:function(){this._columnsRendered=false;while(this._flowDiv.firstChild){this._flowDiv.removeChild(this._flowDiv.firstChild)}},_createProtoCell:function(){this._protoCell=document.createElement("div");this._protoCell.style.cssText="overflow:hidden;";this._protoCell.style.height=this._cellSize.height+"px";this._protoCell.style.width=this._cellSize.width+"px"},_getIndexFromNode:function(f){var a,g;var c;var e;var d;c=f;while(c&&c.parentNode!==this._flowDiv){c=c.parentNode}if(!c){return -1}d=c;a=0;c=d.parentNode.firstChild;while(c){if(c==d){break}++a;c=c.nextSibling}if(!c){return -1}e=d.firstChild;while(f&&f.parentNode!==e){f=f.parentNode}if(!f){return -1}c=e.firstChild;g=0;while(c){if(c===f){var b=(g+this._renderedStartRow)*this._columnCount+a;return b<this._model.size()?b:-1}c=c.nextSibling;++g}return -1},_processClick:function(h,g){if(!this.client||!this.client.verifyInput(this.component)){return}var c=this._getIndexFromNode(h.target);if(c===-1){return}var f=new Date().getTime();if(!g&&this._lastClickIndex==c&&f-this._lastClickTime<Extras.Sync.FlowViewer.DOUBLE_CLICK_TIME){this._processDoubleClick(h);return}this._lastClickIndex=c;this._lastClickTime=new Date().getTime();if(h.ctrlKey||h.metaKey||h.altKey){var d=this.component.get("selection")||{};if(!g&&d[c]){delete d[c]}else{d[c]=true}this.component.set("selection",null,true);this.component.set("selection",d,true);this._setHighlight(c,true)}else{var b=this.component.get("selection")||{};d={};d[c]=true;this.component.set("selection",d,true);for(var a in b){if(a!==c){this._setHighlight(a,false)}}this._setHighlight(c,true)}},_processContextMenu:function(a){this._processClick(a,true);return true},_processDoubleClick:function(b){if(!this.client||!this.client.verifyInput(this.component)){return}var a=this._getIndexFromNode(b.target);if(a!==-1){this.component.doAction(a)}},_processScroll:function(a){this._setPosition(a.row)},renderAdd:function(c,a){this._columnsRendered=false;this._model=this.component.get("model")||new Extras.Viewer.NullModel();this._model.addUpdateListener(this._updateListenerRef);this._renderer=this.component.get("renderer")||new Extras.Sync.FlowViewer.NullRenderer();var b=this._renderer.getCellSize();this._cellSize={width:b.width||100,height:b.height||100};this._createProtoCell();this._div=document.createElement("div");this._div.style.cssText="position:absolute;left:0;top:0;right:0;bottom:0;";this._scrollContainer=new Extras.Sync.Viewer.ScrollContainer(this.client,this.component,this._model.size(),this._cellSize.height);this._scrollContainer.onScroll=Core.method(this,this._processScroll);this._div.appendChild(this._scrollContainer.rootElement);this._flowDiv=document.createElement("div");this._flowDiv.style.cssText="position:absolute;left:0;top:0;bottom:0;right:0;cursor:pointer;";Echo.Sync.Color.renderFB(this.component,this._flowDiv);Echo.Sync.FillImage.render(this.component.render("backgroundImage"),this._flowDiv);this._scrollContainer.contentElement.appendChild(this._flowDiv);a.appendChild(this._div);Core.Web.Event.add(this._div,"contextmenu",Core.method(this,this._processContextMenu),false);Core.Web.Event.add(this._div,"mouseup",Core.method(this,this._processClick),false);Core.Web.Event.Selection.disable(this._div)},_renderCellsFull:function(){var g,d,a,b,h,c,f,j=this._model.size();var i=this.component.get("selection")||{};this._renderedPosition=this._position;this._renderedStartRow=Math.floor(this._position);this._renderedEndRow=Math.min(this._rowCount,Math.ceil(1+this._renderedStartRow+this._flowBounds.height/this._cellSize.height));var e=0-Math.floor((this._position-Math.floor(this._position))*this._cellSize.height);a=document.createElement("div");for(d=this._renderedStartRow;d<this._renderedEndRow;++d){b=this._protoCell.cloneNode(false);a.appendChild(b)}h=[];for(g=0;g<this._columnDivs.length;++g){f=a.cloneNode(true);h.push(f.firstChild);this._columnDivs[g].appendChild(f);this._columnDivs[g].style.top=e+"px"}this._model.fetch(this._renderedStartRow*this._columnCount,this._renderedEndRow*this._columnCount);for(d=this._renderedStartRow;d<this._renderedEndRow;++d){for(g=0;g<this._columnCount;++g){c=d*this._columnCount+g;if(c<j){this._renderer.render(this.component,this._model.get(c),c,h[g],{selected:i[c]})}h[g]=h[g].nextSibling}}},_renderCellsIncremental:function(d){var l=Math.floor(this._position);var e=Math.min(this._rowCount,Math.ceil(l+this._flowBounds.height/this._cellSize.height+1));var i=0-Math.floor((this._position-Math.floor(this._position))*this._cellSize.height);var a,k,b,c,h,g,f;var m=this._model.size();var j=this.component.get("selection")||{};this._renderedPosition=this._position;this._model.fetch(l*this._columnCount,e*this._columnCount);for(h=0;h<this._columnDivs.length;++h){this._columnDivs[h].style.top=i+"px";Core.Web.VirtualPosition.redraw(this._columnDivs[h])}if(d){a=this._renderedEndRow-e;k=this._renderedStartRow-l;for(g=0;g<a;++g){for(h=0;h<this._columnDivs.length;++h){b=this._columnDivs[h].firstChild;if(b.lastChild){b.removeChild(b.lastChild)}}}for(g=this._renderedStartRow-1;g>=l;--g){for(h=0;h<this._columnDivs.length;++h){f=g*this._columnCount+h;b=this._columnDivs[h].firstChild;c=this._protoCell.cloneNode(false);b.insertBefore(c,b.firstChild);if(f<m){this._renderer.render(this.component,this._model.get(f),f,c,{selected:j[f]})}}}}else{a=l-this._renderedStartRow;k=e-this._renderedEndRow;for(g=0;g<a;++g){for(h=0;h<this._columnDivs.length;++h){b=this._columnDivs[h].firstChild;if(b.firstChild){b.removeChild(b.firstChild)}}}for(g=this._renderedEndRow;g<e;++g){for(h=0;h<this._columnDivs.length;++h){f=g*this._columnCount+h;b=this._columnDivs[h].firstChild;c=this._protoCell.cloneNode(false);b.appendChild(c);if(f<m){this._renderer.render(this.component,this._model.get(f),f,c,{selected:j[f]})}}}}this._renderedStartRow=l;this._renderedEndRow=e},_renderCellsUpdate:function(){if(this._position===this._renderedPosition){return}var a=Math.abs(this._renderedPosition-this._position)<(0.75*this._flowBounds.height/this._cellSize.height);if(a){this._renderCellsIncremental(this._position<this._renderedPosition)}else{this._clearContent();this._renderColumns();this._renderCellsFull()}},_renderColumns:function(){if(this._columnsRendered){return}this._columnDivs=[];var a=Math.max(0,Math.floor((this._flowBounds.width-this._columnCount*this._cellSize.width)/2));for(var b=0;b<this._columnCount;++b){this._columnDivs[b]=document.createElement("div");this._columnDivs[b].style.cssText="position:absolute;top:0;bottom:0;overflow:hidden;";this._columnDivs[b].style.width=this._cellSize.width+"px";this._columnDivs[b].style.left=a+"px";this._flowDiv.appendChild(this._columnDivs[b]);a+=this._cellSize.width;Core.Web.VirtualPosition.redraw(this._columnDivs[b])}this._columnsRendered=true},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this._div);Core.Web.VirtualPosition.redraw(this._flowDiv);var c=this._bounds||{};var d=new Core.Web.Measure.Bounds(this._div);this._bounds=d;var b=this._model.size();this._columnCount=Math.max(1,Math.floor((d.width-Core.Web.Measure.SCROLL_WIDTH)/this._cellSize.width));this._rowCount=Math.ceil(b/this._columnCount);var a=b*this._cellSize.height;this._scrollContainer.setActive(this._bounds.height<a);this._scrollContainer.setRows(this._rowCount);this._flowBounds=new Core.Web.Measure.Bounds(this._flowDiv);this._scrollContainer.renderDisplay();if(d.width!=c.width||d.height!=c.height){this._clearContent();this._renderColumns();this._renderCellsFull()}},renderDispose:function(a){this._bounds=null;Core.Web.Event.removeAll(this._div);this._scrollContainer.dispose();this._model.removeUpdateListener(this._updateListenerRef);this._scrollContainer=null;this._flowDiv=null;this._div=null},renderUpdate:function(c){var a=this._div;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b);return true},_setHighlight:function(b,f){if(b<this._renderedStartRow*this._columnCount||b>=this._renderedEndRow*this._columnCount){return}var e,a,g,d;var c=this.component.get("selection")||{};g=Math.floor(b/this._columnCount);a=b%this._columnCount;e=this._columnDivs[a].firstChild;d=e.childNodes[g-this._renderedStartRow];while(d.firstChild){d.removeChild(d.firstChild)}this._renderer.render(this.component,this._model.get(b),b,d,{selected:c[b]})},_setPosition:function(a){this._position=a;this._renderCellsUpdate()},_updateListener:function(f){if(f.refresh){Echo.Render.renderComponentDisplay(this.component);this._clearContent();this._renderColumns();this._renderCellsFull();return}var a=Math.max(this._renderedStartRow*this._columnCount,f.startIndex),h=Math.min(this._renderedEndRow*this._columnCount,f.endIndex),b,d,g,j,k,c;if(h<a){return}var l=this.component.get("selection")||{};for(d=a;d<h;++d){g=Math.floor(d/this._columnCount);j=d%this._columnCount;b=this._columnDivs[j].firstChild;c=b.childNodes[g-this._renderedStartRow];while(c.firstChild){c.removeChild(c.firstChild)}this._renderer.render(this.component,this._model.get(d),d,c,{selected:l[d]})}}});Extras.Sync.FlowViewer.Renderer=Core.extend({$abstract:{getCellSize:function(){},render:function(d,b,c,a){},dispose:function(d,b,c,a){}}});Extras.Sync.FlowViewer.NullRenderer=Core.extend(Extras.Sync.FlowViewer.Renderer,{getCellSize:function(){return{width:100,height:100}},render:function(d,b,c,a){a.appendChild(document.createTextNode((b||"\u00a0").toString()))},dispose:function(d,b,c,a){}});Extras.Sync.Group=Core.extend(Echo.Render.ComponentSync,{$static:{DEFAULTS:{borderImages:["image/group/TopLeft.png","image/group/Top.png","image/group/TopRight.png","image/group/Left.png","image/group/Right.png","image/group/BottomLeft.png","image/group/Bottom.png","image/group/BottomRight.png"],borderInsets:"10px",titleInsets:"0px 2px"}},$load:function(){Echo.Render.registerPeer("Extras.Group",this)},_div:null,_borderImages:null,_getBorderImage:function(b,c,a,e){var d=this._borderImages?this._borderImages[b]:this.client.getResourceUrl("Extras",Extras.Sync.Group.DEFAULTS.borderImages[b]);return d?{url:d,repeat:c,x:a,y:e}:null},renderAdd:function(b,a){this._borderImages=this.component.render("borderImage");this._div=document.createElement("div");this._div.id=this.component.renderId;if(Core.Web.Env.QUIRK_IE_HAS_LAYOUT){this._div.style.cssText="zoom:1;"}Echo.Sync.Color.render(this.component.render("foreground"),this._div,"color");Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this._div);this._renderBorder(b);a.appendChild(this._div)},_renderBorder:function(h){var n=this.component.render("borderInsets",Extras.Sync.Group.DEFAULTS.borderInsets);var b=Echo.Sync.Insets.toPixels(n);var e=0;var j=document.createElement("div");j.style.width="100%";Echo.Sync.FillImage.render(this._getBorderImage(2,"no-repeat","100%","100%"),j,e);var p=document.createElement("div");p.style.paddingRight=b.right+"px";p.style.paddingLeft=b.left+"px";Echo.Sync.FillImage.render(this._getBorderImage(0,"no-repeat",0,"100%"),p,e);j.appendChild(p);var v=this.component.render("title");if(v){var l=document.createElement("table");l.style.padding="0px";l.style.borderCollapse="collapse";l.style.width="100%";var q=document.createElement("tbody");l.appendChild(q);var c=document.createElement("tr");q.appendChild(c);var m=this.component.render("titlePosition");if(m){var o=document.createElement("td");if(Echo.Sync.Extent.isPercent(m)){o.style.width=m.toString()}var i=document.createElement("img");i.src=this.client.getResourceUrl("Echo","resource/Transparent.gif");if(Echo.Sync.Extent.isPercent(m)){i.style.width=m.toString()}i.style.height="1px";o.appendChild(i);Echo.Sync.FillImage.render(this._getBorderImage(1,"repeat-x",0,"100%"),o,e);c.appendChild(o)}var f=document.createElement("td");f.style.whiteSpace="nowrap";Echo.Sync.Font.render(this.component.render("titleFont"),f);Echo.Sync.Insets.render(this.component.render("titleInsets",Extras.Sync.Group.DEFAULTS.titleInsets),f,"padding");var k=this.component.render("titleBackgroundImage");if(k){Echo.Sync.FillImage.render({url:k,repeat:"repeat-x",x:0,y:"100%"},f,e)}f.appendChild(document.createTextNode(v));c.appendChild(f);var u=document.createElement("td");if(m&&Echo.Sync.Extent.isPercent(m)){u.style.width=(100-parseInt(m,10))+"%"}else{u.style.width="100%"}u.style.height=b.top+"px";Echo.Sync.FillImage.render(this._getBorderImage(1,"repeat-x",0,"100%"),u,e);c.appendChild(u);p.appendChild(l)}else{var d=document.createElement("div");d.style.width="100%";d.style.height=b.top+"px";d.style.fontSize="1px";Echo.Sync.FillImage.render(this._getBorderImage(1,"repeat-x",0,"100%"),d,e);p.appendChild(d)}this._div.appendChild(j);var a=document.createElement("div");a.style.width="100%";Echo.Sync.FillImage.render(this._getBorderImage(4,"repeat-y","100%",0),a,e);var t=document.createElement("div");t.style.paddingRight=b.right+"px";t.style.paddingLeft=b.left+"px";Echo.Sync.FillImage.render(this._getBorderImage(3,"repeat-y",0,0),t,e);this._renderContent(h,t);a.appendChild(t);this._div.appendChild(a);var r=document.createElement("div");r.style.width="100%";r.style.height=b.bottom+"px";r.style.fontSize="1px";Echo.Sync.FillImage.render(this._getBorderImage(7,"no-repeat","100%","100%"),r,e);var s=document.createElement("div");s.style.paddingRight=b.right+"px";s.style.paddingLeft=b.left+"px";Echo.Sync.FillImage.render(this._getBorderImage(5,"no-repeat",0,"100%"),s,e);r.appendChild(s);var g=document.createElement("div");g.style.width="100%";g.style.height=b.bottom+"px";g.style.fontSize="1px";Echo.Sync.FillImage.render(this._getBorderImage(6,"repeat-x",0,"100%"),g,e);s.appendChild(g);this._div.appendChild(r)},_renderContent:function(f,a){var e=document.createElement("div");Echo.Sync.FillImage.render(this.component.render("backgroundImage"),e);Echo.Sync.Color.render(this.component.render("background"),e,"backgroundColor");Echo.Sync.Font.render(this.component.render("font"),e);Echo.Sync.Insets.render(this.component.render("insets"),e,"padding");var b=this.component.getComponentCount();for(var c=0;c<b;c++){var d=this.component.getComponent(c);Echo.Render.renderComponentAdd(f,d,e)}a.appendChild(e)},renderDispose:function(a){this._borderImages=null;this._div=null},renderUpdate:function(c){var a=this._div;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b);return true}});Extras.Sync.ListViewer=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.ListViewer",this)},_columnsRendered:false,_cellHeight:null,_borderHeight:0,_columnWidthPx:null,_columnDivs:null,_protoCell:null,_div:null,_listDiv:null,_renderedStartIndex:null,_renderedEndIndex:null,_renderedPosition:0,_position:0,$construct:function(){this._updateListenerRef=Core.method(this,this._updateListener)},_calculateCellHeight:function(){var d=document.createElement("div");d.appendChild(document.createTextNode("Test Height"));this._cellInnerHeight=new Core.Web.Measure.Bounds(d).height;var c=this.component.render("border");var a=Echo.Sync.Insets.toPixels(this.component.render("insets"));this._borderHeight=Echo.Sync.Border.getPixelSize(c,"top")+Echo.Sync.Border.getPixelSize(c,"bottom");var b=Echo.Sync.Insets.toPixels(this.component.render("headerInsets"));this._cellHeight=this._cellInnerHeight+this._borderHeight+a.top+a.bottom;this._headerCellHeight=this._columnNames?this._cellInnerHeight+b.top+b.bottom:0},_calculateColumnWidths:function(){var b=0,c=this._listBounds.width;this._columnWidthPx=[];var a=0;var d=this.component.render("columnWidth",["100%"]);for(b=0;b<d.length;++b){if(Echo.Sync.Extent.isPercent(d[b])){a+=parseInt(d[b],10)}else{this._columnWidthPx[b]=Echo.Sync.Extent.toPixels(d[b]);c-=this._columnWidthPx[b]}}var e=c;for(b=0;b<d.length;++b){if(Echo.Sync.Extent.isPercent(d[b])){this._columnWidthPx[b]=Math.floor(e*parseInt(d[b],10)/100);c-=this._columnWidthPx[b]}}this._columnWidthPx[this._columnWidthPx.length-1]+=c},_clearContent:function(){this._columnsRendered=false;while(this._listDiv.firstChild){this._listDiv.removeChild(this._listDiv.firstChild)}if(this._columnNames){while(this._headerDiv.firstChild){this._headerDiv.removeChild(this._headerDiv.firstChild)}}},_createProtoCell:function(){this._protoCell=document.createElement("div");this._protoCell.style.cssText="overflow:hidden;white-space:nowrap;";Echo.Sync.Insets.render(this.component.render("insets"),this._protoCell,"padding");this._protoCell.style.height=(this._cellInnerHeight)+"px";Echo.Sync.Border.render(this.component.render("border"),this._protoCell)},_getCellDiv:function(b,c){if(c<this._renderedStartIndex||c>=this._renderedEndIndex){return null}var a=this._columnDivs[b].firstChild;return a.childNodes[c-this._renderedStartIndex]},_getIndexFromNode:function(d){var a,e;var b;var c;b=d;while(b&&b.parentNode!==this._listDiv){b=b.parentNode}if(!b){return -1}c=b.firstChild;while(d&&d.parentNode!==c){d=d.parentNode}if(!d){return -1}b=c.firstChild;e=0;while(b){if(b===d){return e+this._renderedStartIndex}b=b.nextSibling;++e}return -1},_processRolloverEnter:function(b){if(!this.client||!this.client.verifyInput(this.component)){return}var a=this._getIndexFromNode(b.target);this._setHighlight(a,true)},_processRolloverExit:function(b){var a=this._getIndexFromNode(b.target);this._setHighlight(a,false)},_processClick:function(g,f){if(!this.client||!this.client.verifyInput(this.component)){return}var c=this._getIndexFromNode(g.target);if(c===-1){return}if(g.ctrlKey||g.metaKey||g.altKey){var d=this.component.get("selection")||{};if(!f&&d[c]){delete d[c]}else{d[c]=true}this.component.set("selection",null,true);this.component.set("selection",d,true);this._setHighlight(c,true)}else{var b=this.component.get("selection")||{};d={};d[c]=true;this.component.set("selection",d,true);for(var a in b){if(a!==c){this._setHighlight(a,false)}}this._setHighlight(c,true)}},_processContextMenu:function(a){this._processClick(a,true);return true},_processDoubleClick:function(a){if(!this.client||!this.client.verifyInput(this.component)){return}var b=this._getIndexFromNode(a.target);if(b!==-1){this.component.doAction(b)}},_processScroll:function(a){this._setPosition(a.row)},renderAdd:function(b,a){this._columnsRendered=false;this._columnNames=this.component.render("columnName");this._model=this.component.get("model")||new Extras.Viewer.NullModel();this._model.addUpdateListener(this._updateListenerRef);this._renderer=this.component.get("renderer")||new Extras.Sync.ListViewer.ColumnRenderer();this._calculateCellHeight();this._div=document.createElement("div");this._div.style.cssText="position:absolute;left:0;top:0;right:0;bottom:0;";if(this._columnNames){this._headerDiv=document.createElement("div");this._headerDiv.style.cssText="position:absolute;left:0;top:0;right:0;overflow:hidden;";this._headerDiv.style.height=this._headerCellHeight+"px";Echo.Sync.Color.render(this.component.render("headerBackground"),this._headerDiv,"backgroundColor");Echo.Sync.Color.render(this.component.render("headerForeground"),this._headerDiv,"color");this._div.appendChild(this._headerDiv)}this._containerDiv=document.createElement("div");this._containerDiv.style.cssText="position:absolute;left:0;right:0;bottom:0;";this._containerDiv.style.top=this._headerCellHeight+"px";this._div.appendChild(this._containerDiv);this._scrollContainer=new Extras.Sync.Viewer.ScrollContainer(this.client,this.component,this._model.size(),this._cellHeight);this._scrollContainer.onScroll=Core.method(this,this._processScroll);this._containerDiv.appendChild(this._scrollContainer.rootElement);this._listDiv=document.createElement("div");this._listDiv.style.cssText="position:absolute;left:0;top:0;bottom:0;right:0;cursor:pointer;";Echo.Sync.Color.renderFB(this.component,this._listDiv);Echo.Sync.FillImage.render(this.component.render("backgroundImage"),this._listDiv);this._scrollContainer.contentElement.appendChild(this._listDiv);a.appendChild(this._div);this._createProtoCell();Core.Web.Event.add(this._div,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(this._div,"contextmenu",Core.method(this,this._processContextMenu),false);Core.Web.Event.add(this._div,"dblclick",Core.method(this,this._processDoubleClick),false);if(this.component.render("rolloverEnabled")){Core.Web.Event.add(this._div,"mouseover",Core.method(this,this._processRolloverEnter),false);Core.Web.Event.add(this._div,"mouseout",Core.method(this,this._processRolloverExit),false)}Core.Web.Event.Selection.disable(this._div)},_renderHighlight:function(f,h,j){var g=this.component.get("selection")||{};var b=g[h];var d=b?"selection":"rollover";var a,e;if(j||b){a=this.component.render(d+"Background");e=this.component.render(d+"Foreground")}for(var c=0;c<f.length;++c){Echo.Sync.Color.renderClear(a,f[c],"backgroundColor");Echo.Sync.Color.renderClear(e,f[c],"color")}},_renderColumns:function(){if(this._columnsRendered){return}this._calculateColumnWidths();this._headerColumnDivs=[];this._columnDivs=[];var a=0;for(var b=0;b<this._columnWidthPx.length;++b){var c=Math.max(0,this._columnWidthPx[b]);if(this._columnNames&&this._columnNames[b]){this._headerColumnDivs[b]=document.createElement("div");this._headerColumnDivs[b].style.cssText="position:absolute;top:0;overflow:hidden;";this._headerColumnDivs[b].style.width=c+"px";this._headerColumnDivs[b].style.left=a+"px";Echo.Sync.Insets.render(this.component.render("headerInsets"),this._headerColumnDivs[b],"padding");this._headerColumnDivs[b].appendChild(document.createTextNode(this._columnNames[b]));this._headerDiv.appendChild(this._headerColumnDivs[b])}this._columnDivs[b]=document.createElement("div");this._columnDivs[b].style.cssText="position:absolute;top:0;bottom:0;overflow:hidden;";this._columnDivs[b].style.width=c+"px";this._columnDivs[b].style.left=a+"px";this._listDiv.appendChild(this._columnDivs[b]);a+=c;Core.Web.VirtualPosition.redraw(this._columnDivs[b])}this._columnsRendered=true},renderDispose:function(a){Core.Web.Event.removeAll(this._div);this._model.removeUpdateListener(this._updateListenerRef);this._scrollContainer.dispose();this._bounds=null;this._listBounds=null;this._div=null;this._listDiv=null;this._columnDivs=null;this._protoCell=null;this._scrollContainer=null},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this._div);Core.Web.VirtualPosition.redraw(this._headerDiv);Core.Web.VirtualPosition.redraw(this._containerDiv);Core.Web.VirtualPosition.redraw(this._listDiv);var b=this._bounds||{};var c=new Core.Web.Measure.Bounds(this._containerDiv);this._bounds=c;var a=this._model.size()*this._cellHeight;this._scrollContainer.setActive(this._bounds.height<a);this._listBounds=new Core.Web.Measure.Bounds(this._listDiv);this._scrollContainer.renderDisplay();if(c.width!=b.width||c.height!=b.height){this._clearContent();this._renderColumns();this._renderRowsFull()}},_renderRowsFull:function(){var b,g,h,c,f,a,i=this.component.get("selection")||{},d=this._model.size();this._renderedPosition=this._position;this._renderedStartIndex=Math.floor(this._position);this._renderedEndIndex=Math.min(d,Math.ceil(this._renderedStartIndex+this._listBounds.height/this._cellHeight));a=document.createElement("div");for(c=this._renderedStartIndex;c<this._renderedEndIndex;++c){b=this._protoCell.cloneNode(false);a.appendChild(b)}var e=0-Math.floor((this._position-Math.floor(this._position))*this._cellHeight);this._model.fetch(this._renderedStartIndex,this._renderedEndIndex);g=[];for(h=0;h<this._columnDivs.length;++h){f=a.cloneNode(true);g.push(f.firstChild);this._columnDivs[h].appendChild(f);this._columnDivs[h].style.top=e+"px"}for(c=this._renderedStartIndex;c<this._renderedEndIndex&&c<d;++c){this._renderer.render(this.component,this._model.get(c),c,g);if(i[c]){this._renderHighlight(g,c,false)}for(h=0;h<this._columnDivs.length;++h){g[h]=g[h].nextSibling}}},_renderRowsIncremental:function(c){var l=Math.floor(this._position);var e=Math.min(this._model.size(),Math.ceil(l+this._listBounds.height/this._cellHeight+1));var a,j,b,i,d,h,f,k=this.component.get("selection")||{};var g=0-Math.floor((this._position-Math.floor(this._position))*this._cellHeight);this._renderedPosition=this._position;this._model.fetch(l,e);for(h=0;h<this._columnDivs.length;++h){this._columnDivs[h].style.top=g+"px"}if(c){i=this._renderedEndIndex-e;d=this._renderedStartIndex-l;for(f=0;f<i;++f){for(h=0;h<this._columnDivs.length;++h){a=this._columnDivs[h].firstChild;a.removeChild(a.lastChild)}}for(f=this._renderedStartIndex-1;f>=l;--f){j=[];for(h=0;h<this._columnDivs.length;++h){a=this._columnDivs[h].firstChild;b=this._protoCell.cloneNode(false);a.insertBefore(b,a.firstChild);j.push(b)}this._renderer.render(this.component,this._model.get(f),f,j);if(k[f]){this._renderHighlight(j,f,false)}}}else{i=l-this._renderedStartIndex;d=e-this._renderedEndIndex;for(f=0;f<i;++f){for(h=0;h<this._columnDivs.length;++h){a=this._columnDivs[h].firstChild;a.removeChild(a.firstChild)}}for(f=this._renderedEndIndex;f<e;++f){j=[];for(h=0;h<this._columnDivs.length;++h){a=this._columnDivs[h].firstChild;b=this._protoCell.cloneNode(false);a.appendChild(b);j.push(b)}this._renderer.render(this.component,this._model.get(f),f,j);if(k[f]){this._renderHighlight(j,f,false)}}}this._renderedStartIndex=l;this._renderedEndIndex=e},_renderRowsUpdate:function(){if(this._position===this._renderedPosition){return}var a=Math.abs(this._renderedPosition-this._position)<(0.75*this._listBounds.height/this._cellHeight);if(a){this._renderRowsIncremental(this._position<this._renderedPosition)}else{this._clearContent();this._renderColumns();this._renderRowsFull()}},renderUpdate:function(c){var a=this._div;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b);return true},_setPosition:function(a){this._position=a;this._renderRowsUpdate()},_setHighlight:function(b,e){var a=[];for(var d=0;d<this._columnDivs.length;++d){var c=this._getCellDiv(d,b);if(!c){return}a.push(c)}this._renderHighlight(a,b,e)},_updateListener:function(d){if(d.refresh){Echo.Render.renderComponentDisplay(this.component);this._scrollContainer.setRows(this._model.size());this._clearContent();this._renderColumns();this._renderRowsFull();return}var a=Math.max(this._renderedStartIndex,d.startIndex),g=Math.min(this._renderedEndIndex,d.endIndex),b,f,h,i,c,j=this.component.get("selection")||{};if(g<=a){return}i=[];for(h=0;h<this._columnDivs.length;++h){b=this._columnDivs[h].firstChild;c=b.childNodes[a-this._renderedStartIndex];i.push(c)}for(f=a;f<g;++f){for(h=0;h<this._columnDivs.length;++h){while(i[h].firstChild){i[h].removeChild(i[h].firstChild)}}this._renderer.render(this.component,this._model.get(f),f,i);if(j[f]){this._renderHighlight(i,f,false)}for(h=0;h<this._columnDivs.length;++h){i[h]=i[h].nextSibling}}}});Extras.Sync.ListViewer.Renderer=Core.extend({$abstract:{render:function(d,b,c,a){},dispose:function(d,b,c,a){}}});Extras.Sync.ListViewer.ColumnRenderer=Core.extend(Extras.Sync.ListViewer.Renderer,{$virtual:{renderColumn:function(d,b,c,a,e,f){a.appendChild(document.createTextNode(e.toString()))}},columnPropertyNames:null,render:function(d,b,c,a){var f,e;if(!b){return}for(e=0;e<a.length;++e){if(this.columnPropertyNames){f=b[this.columnPropertyNames[e]||e]}else{if(b instanceof Array){f=b[e]}else{if(e===0){f=b}else{f=null}}}if(f!=null){this.renderColumn(d,b,c,a[e],f,e)}}},dispose:function(d,b,c,a){}});Extras.Sync.Menu=Core.extend(Echo.Render.ComponentSync,{$static:{DEFAULTS:{foreground:"#000000",background:"#cfcfcf",disabledForeground:"#7f7f7f",selectionForeground:"#ffffff",selectionBackground:"#3f3f3f",border:"1px outset #cfcfcf"}},menuModel:null,stateModel:null,element:null,active:false,_openMenuPath:null,_maskDeployed:false,_processMaskClickRef:null,_overlay:null,$construct:function(){this._processMaskClickRef=Core.method(this,this._processMaskClick);this._openMenuPath=[]},$abstract:{getSubMenuPosition:function(a){},renderMain:function(a){}},$virtual:{activate:function(){if(this.active){return false}this.component.set("modal",true);this.active=true;this.addMask();this.client.application.setFocusedComponent(this.component);Core.Web.DOM.focusElement(this.element);return true},activateItem:function(a){if(this.stateModel&&!this.stateModel.isEnabled(a.modelId)){return}if(a instanceof Extras.OptionModel){this.deactivate();this.processAction(a)}else{if(a instanceof Extras.MenuModel){this._openMenu(a)}}},processAction:function(a){this.component.doAction(a)}},addMenu:function(a){this._openMenuPath.push(a)},addMask:function(){if(this.maskDeployed){return}this.maskDeployed=true;this._overlayAdd(new Core.Web.Measure.Bounds(this.element));Core.Web.Event.add(document.body,"click",this._processMaskClickRef,false);Core.Web.Event.add(document.body,"contextmenu",this._processMaskClickRef,false)},clientKeyDown:function(a){if(a.keyCode==27){this.deactivate();return false}return true},closeAll:function(){while(this._openMenuPath.length>0){var a=this._openMenuPath.pop();a.close()}},closeDescendants:function(a){while(a!=this._openMenuPath[this._openMenuPath.length-1]){var b=this._openMenuPath.pop();b.close()}},deactivate:function(){this.component.set("modal",false);if(!this.active){return}this.active=false;this.closeAll();this.removeMask()},isOpen:function(b){for(var a=0;a<this._openMenuPath.length;++a){if(this._openMenuPath[a].menuModel==b){return true}}return false},_overlayAdd:function(e){this._overlayRemove();var b=e.top+e.height,d=e.left+e.width,a=new Core.Web.Measure.Bounds(document.body);this._overlay={};if(e.top>0){this._overlay.top=document.createElement("div");this._overlay.top.style.cssText="position:absolute;z-index:30000;top:0;left:0;width:100%;height:"+e.top+"px;";document.body.appendChild(this._overlay.top)}if(b<a.height){this._overlay.bottom=document.createElement("div");this._overlay.bottom.style.cssText="position:absolute;z-index:30000;bottom:0;left:0;width:100%;top:"+b+"px;";document.body.appendChild(this._overlay.bottom)}if(e.left>0){this._overlay.left=document.createElement("div");this._overlay.left.style.cssText="position:absolute;z-index:30000;left:0;width:"+e.left+"px;top:"+e.top+"px;height:"+e.height+"px;";document.body.appendChild(this._overlay.left)}if(d<a.width){this._overlay.right=document.createElement("div");this._overlay.right.style.cssText="position:absolute;z-index:30000;right:0;left:"+d+"px;top:"+e.top+"px;height:"+e.height+"px;";document.body.appendChild(this._overlay.right)}for(var c in this._overlay){Echo.Sync.FillImage.render(this.client.getResourceUrl("Echo","resource/Transparent.gif"),this._overlay[c]);Core.Web.VirtualPosition.redraw(this._overlay[c])}this.client.forceRedraw()},_overlayRemove:function(){if(!this._overlay){return}for(var a in this._overlay){document.body.removeChild(this._overlay[a])}this._overlay=null;this.client.forceRedraw()},_openMenu:function(f){if(this.isOpen(f)){return}var b=new Extras.Sync.Menu.RenderedMenu(this,f);b.create();var c=null;for(var d=0;d<this._openMenuPath.length;++d){if(this._openMenuPath[d].menuModel==f.parent){c=this._openMenuPath[d];break}}if(c==null){c=this}else{this.closeDescendants(c)}var a=c.getSubMenuPosition(f);var e=new Core.Web.Measure.Bounds(document.body);if(a.x+b.width>e.width){a.x=e.width-b.width;if(a.x<0){a.x=0}}if(a.y+b.height>e.height){a.y=e.height-b.height;if(a.y<0){a.y=0}}b.open(a.x,a.y);this.addMenu(b)},_processMaskClick:function(a){this.deactivate();return true},removeMask:function(){if(!this.maskDeployed){return}this._overlayRemove();this.maskDeployed=false;Core.Web.Event.remove(document.body,"click",this._processMaskClickRef,false);Core.Web.Event.remove(document.body,"contextmenu",this._processMaskClickRef,false)},renderAdd:function(b,a){this.menuModel=this.component.get("model");this.stateModel=this.component.get("stateModel");this.element=this.renderMain(b);this.element.tabIndex="-1";this.element.style.outlineStyle="none";a.appendChild(this.element)},renderDispose:function(a){this.deactivate();this.element=null},renderFocus:function(){Core.Web.DOM.focusElement(this.element)},renderHide:function(){this.deactivate()},renderUpdate:function(c){if(c.isUpdatedPropertySetIn({modal:true})){return}var a=this.element;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b);return false}});Extras.Sync.Menu.RenderedMenu=Core.extend({$static:{DEFAULTS:{iconTextMargin:5,menuInsets:"2px",menuItemInsets:"1px 12px"},FadeAnimation:Core.extend(Extras.Sync.Animation,{_element:null,$construct:function(b,a){this._element=b;this.runTime=a},init:function(){},step:function(a){this._element.style.opacity=a},complete:function(a){this._element.style.opacity=1}})},menuSync:null,component:null,client:null,element:null,itemElements:null,menuModel:null,width:null,height:null,_activeItem:null,stateModel:null,$construct:function(b,a){this.menuSync=b;this.menuModel=a;this.component=this.menuSync.component;this.client=this.menuSync.client;this.stateModel=this.menuSync.stateModel;this.itemElements={}},close:function(){Core.Web.Event.removeAll(this.element);document.body.removeChild(this.element);this.client.forceRedraw();this.element=null;this.itemElements=null;this._activeItem=null},create:function(){var v,A,D,w,s,B;this.element=document.createElement("div");this.element.style.position="absolute";this.element.style.zIndex=30050;var c=(Core.Web.Env.NOT_SUPPORTED_CSS_OPACITY?100:this.component.render("menuOpacity",100))/100;var k=document.createElement("div");k.style.cssText="position:relative;z-index:10;";this.element.appendChild(k);Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),k);Echo.Sync.Insets.render(Extras.Sync.Menu.RenderedMenu.DEFAULTS.menuInsets,k,"padding");Echo.Sync.Border.render(this.component.render("menuBorder",Extras.Sync.Menu.DEFAULTS.border),k);var a;var f=this.component.render("menuForeground");if(f){a=f}else{a=this.component.render("foreground",Extras.Sync.Menu.DEFAULTS.foreground)}Echo.Sync.Color.render(a,k,"color");Echo.Sync.Extent.render(this.component.render("menuWidth"),k,"width",true,false);var m=this.component.render("menuFont");if(!m){m=this.component.render("font")}if(m){Echo.Sync.Font.render(m,k)}var t;if(c<1){t=document.createElement("div");t.style.cssText="position:absolute;z-index:1;width:100%;height:100%;top:0;bottom:0;";t.style.opacity=c;this.element.appendChild(t)}else{t=this.element}var x;var o=this.component.render("menuBackground");if(o){x=o}else{x=this.component.render("background",Extras.Sync.Menu.DEFAULTS.background)}Echo.Sync.Color.render(x,t,"backgroundColor");var b;var r=this.component.render("menuBackgroundImage");if(r){b=r}else{if(o==null){b=this.component.render("backgroundImage")}}if(b){Echo.Sync.FillImage.render(b,t,null)}var d=document.createElement("table");d.style.borderCollapse="collapse";d.style.width="100%";k.appendChild(d);var h=document.createElement("tbody");d.appendChild(h);var n=this.menuModel.items;var j=false;for(v=0;v<n.length;++v){A=n[v];if(A.icon||A instanceof Extras.ToggleOptionModel){j=true;break}}var u,p;if(j){var y=Echo.Sync.Insets.toPixels(Extras.Sync.Menu.RenderedMenu.DEFAULTS.menuItemInsets);p="0px 0px 0px "+y.left+"px";u=y.top+"px "+y.right+"px "+y.bottom+"px "+y.left+"px"}else{u=Extras.Sync.Menu.RenderedMenu.DEFAULTS.menuItemInsets}for(v=0;v<n.length;++v){A=n[v];if(A instanceof Extras.OptionModel||A instanceof Extras.MenuModel){B=document.createElement("tr");this.itemElements[A.id]=B;B.style.cursor="pointer";h.appendChild(B);if(j){s=document.createElement("td");Echo.Sync.Insets.render(p,s,"padding");Echo.Sync.Extent.render("0px",s,"width",true,false);if(A instanceof Extras.ToggleOptionModel){var l;var q=this.stateModel&&this.stateModel.isSelected(A.modelId);if(A instanceof Extras.RadioOptionModel){l=q?"image/menu/RadioOn.gif":"image/menu/RadioOff.gif"}else{l=q?"image/menu/ToggleOn.gif":"image/menu/ToggleOff.gif"}D=document.createElement("img");D.src=this.client.getResourceUrl("Extras",l);s.appendChild(D)}else{if(A.icon){D=document.createElement("img");Echo.Sync.ImageReference.renderImg(A.icon,D);s.appendChild(D)}}B.appendChild(s)}w=document.createElement("td");Echo.Sync.Insets.render(u,w,"padding");w.style.whiteSpace="nowrap";if(this.stateModel&&!this.stateModel.isEnabled(A.modelId)){Echo.Sync.Color.render(this.component.render("disabledForeground",Extras.Sync.Menu.DEFAULTS.disabledForeground),w,"color")}w.appendChild(document.createTextNode(A.text));B.appendChild(w);if(A instanceof Extras.MenuModel){var g=document.createElement("td");g.style.textAlign="right";D=document.createElement("img");var z=this.component.render("menuExpandIcon",this.client.getResourceUrl("Extras","image/menu/ArrowRight.gif"));D.setAttribute("src",z.url?z.url:z);D.setAttribute("alt","");g.appendChild(D);B.appendChild(g)}else{w.colSpan=2}}else{if(A instanceof Extras.SeparatorModel){if(v===0||v===n.length-1||n[v-1] instanceof Extras.SeparatorModel||n[v+1] instanceof Extras.SeparatorModel){continue}B=document.createElement("tr");h.appendChild(B);w=document.createElement("td");w.colSpan=j?3:2;w.style.padding="3px 0px";var C=document.createElement("div");C.style.cssText="border-top:1px solid #a7a7a7;height:0;font-size:1px;line-height:0";w.appendChild(C);B.appendChild(w)}}}var e=new Core.Web.Measure.Bounds(this.element);this.width=e.width;this.height=e.height},_getItemElement:function(a){if(a==null){return null}while(a.nodeName.toLowerCase()!="tr"){if(a==this.element){return null}a=a.parentNode}return a},_getItemModel:function(c){var b=null;c=this._getItemElement(c);if(c==null){return null}for(var a in this.itemElements){if(this.itemElements[a]==c){b=a;break}}if(b==null){return null}else{return this.menuModel.findItem(b)}},getSubMenuPosition:function(c){var d=this.itemElements[c.id];var b=new Core.Web.Measure.Bounds(d);var a=new Core.Web.Measure.Bounds(this.element);return{x:a.left+a.width,y:b.top}},open:function(a,d){this.element.style.left=a+"px";this.element.style.top=d+"px";var c=this.component.render("animationTime",0);if(c&&!Core.Web.Env.NOT_SUPPORTED_CSS_OPACITY){this.element.style.opacity=0;var b=new Extras.Sync.Menu.RenderedMenu.FadeAnimation(this.element,c);b.start()}document.body.appendChild(this.element);this.client.forceRedraw();Core.Web.Event.add(this.element,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(this.element,"mouseover",Core.method(this,this._processItemEnter),false);Core.Web.Event.add(this.element,"mouseout",Core.method(this,this._processItemExit),false);Core.Web.Event.Selection.disable(this.element)},_processClick:function(b){Core.Web.DOM.preventEventDefault(b);var a=this._getItemModel(Core.Web.DOM.getEventTarget(b));if(a){this._setActiveItem(a,true)}},_processItemEnter:function(a){this._processRollover(a,true)},_processItemExit:function(a){this._processRollover(a,false)},_processRollover:function(d,c){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return true}var a=this._getItemElement(Core.Web.DOM.getEventTarget(d));if(!a){return}var b=this._getItemModel(a);if(!b){return}if(this.stateModel&&!this.stateModel.isEnabled(b.modelId)){return}if(c){this._setActiveItem(b,false)}},_setActiveItem:function(a,b){if(this._activeItem){this._setItemHighlight(this._activeItem,false);this._activeItem=null}if(a instanceof Extras.MenuModel){this.menuSync.activateItem(a)}else{if(b){this.menuSync.activateItem(a);return}else{this.menuSync.closeDescendants(this)}}if(a){this._activeItem=a;this._setItemHighlight(this._activeItem,true)}},_setItemHighlight:function(b,c){var a=this.itemElements[b.id];if(c){Echo.Sync.FillImage.render(this.component.render("selectionBackgroundImage"),a);Echo.Sync.Color.render(this.component.render("selectionBackground",Extras.Sync.Menu.DEFAULTS.selectionBackground),a,"backgroundColor");Echo.Sync.Color.render(this.component.render("selectionForeground",Extras.Sync.Menu.DEFAULTS.selectionForeground),a,"color")}else{a.style.backgroundImage="";a.style.backgroundColor="";a.style.color=""}}});Extras.Sync.ContextMenu=Core.extend(Extras.Sync.Menu,{$load:function(){Echo.Render.registerPeer("Extras.ContextMenu",this)},_mouseX:null,_mouseY:null,getSubMenuPosition:function(a){return{x:this._mouseX,y:this._mouseY}},_processContextClick:function(a){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return true}Core.Web.DOM.preventEventDefault(a);this._mouseX=a.pageX||(a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft));this._mouseY=a.pageY||(a.clientY+(document.documentElement.scrollTop||document.body.scrollTop));this.activate();this.activateItem(this.menuModel)},renderDispose:function(a){Core.Web.Event.removeAll(this.element);Extras.Sync.Menu.prototype.renderDispose.call(this,a)},renderMain:function(d){var c=document.createElement("div");c.id=this.component.renderId;var a=this.component.render("activationMode",Extras.ContextMenu.ACTIVATION_MODE_CONTEXT_CLICK);if(a&Extras.ContextMenu.ACTIVATION_MODE_CLICK){Core.Web.Event.add(c,"click",Core.method(this,this._processContextClick),false)}if(a&Extras.ContextMenu.ACTIVATION_MODE_CONTEXT_CLICK){Core.Web.Event.add(c,"contextmenu",Core.method(this,this._processContextClick),false)}var b=this.component.getComponentCount();if(b>0){Echo.Render.renderComponentAdd(d,this.component.getComponent(0),c)}return c},renderUpdate:function(f){if(f.isUpdatedPropertySetIn({modal:true,stateModel:true,model:true})){var b=f.getRemovedChildren();if(b){Core.Web.DOM.removeNode(this.element.firstChild)}var e=f.getAddedChildren();if(e){Echo.Render.renderComponentAdd(f,e[0],this.element)}var a=f.getUpdatedProperty("model");var c=f.getUpdatedProperty("stateModel");var d=this.maskDeployed&&(a||c);if(d){this.deactivate()}if(a){this.menuModel=a.newValue}if(c){this.stateModel=c.newValue}if(d){this.activate();this.activateItem(this.menuModel)}return false}Extras.Sync.Menu.prototype.renderUpdate.call(this,f);return true}});Extras.Sync.DropDownMenu=Core.extend(Extras.Sync.Menu,{$load:function(){Echo.Render.registerPeer("Extras.DropDownMenu",this)},_contentDiv:null,_selectedItem:null,_createSelectionContent:function(c){var a;if(c.icon){if(c.text){var d=document.createElement("table");d.style.cssText="border-collapse:collapse;padding:0;";var b=document.createElement("tbody");var e=document.createElement("tr");var g=document.createElement("td");g.style.cssText="padding:0vertical-align:top;";a=document.createElement("img");Echo.Sync.ImageReference.renderImg(c.icon,a);g.appendChild(a);e.appendChild(g);g=document.createElement("td");g.style.cssText="padding:width:3px;";var f=document.createElement("div");f.style.cssText="width:3px";g.appendChild(f);e.appendChild(g);g=document.createElement("td");g.style.cssText="padding:0vertical-align:top;";g.appendChild(document.createTextNode(c.text));e.appendChild(g);b.appendChild(e);d.appendChild(b);return d}else{a=document.createElement("img");Echo.Sync.ImageReference.renderImg(c.icon,a);return a}}else{return document.createTextNode(c.text?c.text:"\u00a0")}},getSubMenuPosition:function(a){var b=new Core.Web.Measure.Bounds(this.element);return{x:b.left,y:b.top+b.height}},processAction:function(a){if(this.component.render("selectionEnabled")){this._setSelection(a)}var b=a.getItemPositionPath().join(".");this.component.set("selection",b);Extras.Sync.Menu.prototype.processAction.call(this,a)},_processClick:function(a){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return true}Core.Web.DOM.preventEventDefault(a);this.activate();this.activateItem(this.menuModel)},renderDispose:function(a){Core.Web.Event.removeAll(this.element);this._contentDiv=null;Extras.Sync.Menu.prototype.renderDispose.call(this,a)},renderMain:function(){var e=document.createElement("div");e.id=this.component.renderId;e.style.cssText="overflow:hidden;cursor:pointer;";Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),e);Echo.Sync.Color.render(this.component.render("foreground",Extras.Sync.Menu.DEFAULTS.foreground),e,"color");Echo.Sync.Color.render(this.component.render("background",Extras.Sync.Menu.DEFAULTS.background),e,"backgroundColor");Echo.Sync.FillImage.render(this.component.render("backgroundImage"),e);Echo.Sync.Border.render(this.component.render("border",Extras.Sync.Menu.DEFAULTS.border),e);Echo.Sync.Extent.render(this.component.render("width"),e,"width",true,true);Echo.Sync.Extent.render(this.component.render("height"),e,"height",false,true);var f=document.createElement("div");f.style.cssText="float:right;position:relative;";e.appendChild(f);var c=document.createElement("div");c.style.cssText="position:absolute;top:2px;right:2px;";var b=this.component.render("expandIcon",this.client.getResourceUrl("Extras","image/menu/ArrowDown.gif"));var d=document.createElement("img");Echo.Sync.ImageReference.renderImg(b,d);c.appendChild(d);f.appendChild(c);this._contentDiv=document.createElement("div");this._contentDiv.style.cssText="float:left;";if(!this.component.render("lineWrap")){this._contentDiv.style.whiteSpace="nowrap"}Echo.Sync.Insets.render(this.component.render("insets","2px 5px"),this._contentDiv,"padding");Echo.Sync.Font.render(this.component.render("font"),this._contentDiv);e.appendChild(this._contentDiv);var g=document.createElement("div");g.style.cssText="clear:both;";e.appendChild(g);Core.Web.Event.add(e,"click",Core.method(this,this._processClick),false);Core.Web.Event.Selection.disable(e);if(this.component.render("selectionEnabled")){var h=this.component.render("selection");if(h){this._selectedItem=this.menuModel.getItemModelFromPositions(h.split("."))}}else{this._selectedItem=null}if(this._selectedItem){this._contentDiv.appendChild(this._createSelectionContent(this._selectedItem))}else{var a=this.component.render("selectionText");this._contentDiv.appendChild(document.createTextNode(a?a:"\u00a0"))}if(!this.component.render("height")){var i=new Core.Web.Measure.Bounds(this._contentDiv);f.style.height=i.height+"px"}return e},_setSelection:function(b){this._selectedItem=b;for(var a=this._contentDiv.childNodes.length-1;a>=0;--a){this._contentDiv.removeChild(this._contentDiv.childNodes[a])}this._contentDiv.appendChild(this._createSelectionContent(b))}});Extras.Sync.MenuBarPane=Core.extend(Extras.Sync.Menu,{$static:{DEFAULTS:{itemInsets:"0px 12px",insets:"3px 0px"}},$load:function(){Echo.Render.registerPeer("Extras.MenuBarPane",this)},_activeItem:null,_menuBarTable:null,_menuBarBorderHeight:null,itemElements:null,$construct:function(){Extras.Sync.Menu.call(this);this.itemElements={}},activate:function(){if(Extras.Sync.Menu.prototype.activate.call(this)){this.addMenu(this)}},close:function(){if(this._activeItem){this._setItemHighlight(this._activeItem,false);this._activeItem=null}},_getItemElement:function(a){if(a==null){return null}while(a.nodeName.toLowerCase()!="td"){if(a==this.element){return null}a=a.parentNode}return a},_getItemModel:function(c){var b=null;c=this._getItemElement(c);if(c==null){return null}for(var a in this.itemElements){if(this.itemElements[a]==c){b=a;break}}if(b==null){return null}else{return this.menuModel.findItem(b)}},getPreferredSize:function(){this._menuBarTable.style.height="";var a=Echo.Sync.Insets.toPixels(this.component.render("insets",Extras.Sync.MenuBarPane.DEFAULTS.insets));return{height:new Core.Web.Measure.Bounds(this.element).height+a.top+a.bottom}},getSubMenuPosition:function(d){var b=this.itemElements[d.id];if(!b){throw new Error("Invalid menu: "+d)}var a=new Core.Web.Measure.Bounds(this.element);var c=new Core.Web.Measure.Bounds(b);return{x:c.left,y:a.top+a.height}},_processClick:function(b){if(!this.client||!this.client.verifyInput(this.component)){return true}Core.Web.DOM.preventEventDefault(b);var a=this._getItemModel(Core.Web.DOM.getEventTarget(b));if(a){if(a instanceof Extras.OptionModel){this.deactivate();this.processAction(a)}else{this.activate();this._setActiveItem(a,true)}}else{this.deactivate()}},_processItemEnter:function(a){this._processRollover(a,true)},_processItemExit:function(a){this._processRollover(a,false)},_processRollover:function(d,c){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return true}var a=this._getItemElement(Core.Web.DOM.getEventTarget(d));if(!a){return}var b=this._getItemModel(a);if(this.stateModel&&!this.stateModel.isEnabled(b.modelId)){return}if(this.active){if(c){this._setActiveItem(b,b instanceof Extras.MenuModel)}}else{this._setItemHighlight(b,c)}},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this.element);var b=new Core.Web.Measure.Bounds(this.element.parentNode);var a=b.height-this._menuBarBorderHeight;this._menuBarTable.style.height=a<=0?"":a+"px"},renderDispose:function(a){this._menuBarTable=null;Core.Web.Event.removeAll(this.element);Extras.Sync.Menu.prototype.renderDispose.call(this,a)},renderMain:function(d){var b=document.createElement("div");b.id=this.component.renderId;b.style.cssText="overflow:hidden;";Echo.Sync.renderComponentDefaults(this.component,b);var c=this.component.render("border",Extras.Sync.Menu.DEFAULTS.border);var k=Echo.Sync.Border.isMultisided(c);this._menuBarBorderHeight=Echo.Sync.Border.getPixelSize(c,"top")+Echo.Sync.Border.getPixelSize(c,"bottom");Echo.Sync.Border.render(k?c.top:c,b,"borderTop");Echo.Sync.Border.render(k?c.bottom:c,b,"borderBottom");Echo.Sync.FillImage.render(this.component.render("backgroundImage"),b);this._menuBarTable=document.createElement("table");this._menuBarTable.style.borderCollapse="collapse";b.appendChild(this._menuBarTable);var g=document.createElement("tbody");this._menuBarTable.appendChild(g);var a=document.createElement("tr");g.appendChild(a);if(this.menuModel==null||this.menuModel.items.length===0){a.appendChild(this._createMenuBarItem("\u00a0",null))}else{var f=this.menuModel.items;for(var e=0;e<f.length;++e){var j=f[e];if(j instanceof Extras.OptionModel||j instanceof Extras.MenuModel){var h=this._createMenuBarItem(j.text,j.icon);a.appendChild(h);this.itemElements[j.id]=h}}Core.Web.Event.add(b,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(b,"mouseover",Core.method(this,this._processItemEnter),false);Core.Web.Event.add(b,"mouseout",Core.method(this,this._processItemExit),false)}Core.Web.Event.Selection.disable(b);return b},_createMenuBarItem:function(d,b){var f=document.createElement("td");f.style.padding="0px";f.style.cursor="pointer";var e=document.createElement("div");e.style.whiteSpace="nowrap";Echo.Sync.Insets.render(Extras.Sync.MenuBarPane.DEFAULTS.itemInsets,e,"padding");f.appendChild(e);if(b){var a=document.createElement("img");a.style.verticalAlign="middle";a.src=b;e.appendChild(a);if(d){a.style.paddingRight="1ex"}}if(d){var c=document.createElement("span");c.style.verticalAlign="middle";c.appendChild(document.createTextNode(d));e.appendChild(c)}return f},_setActiveItem:function(a,b){if(this._activeItem==a){return}if(this._activeItem){this._setItemHighlight(this._activeItem,false);this._activeItem=null}if(b){this.activateItem(a)}if(a){this._activeItem=a;this._setItemHighlight(this._activeItem,true)}},_setItemHighlight:function(b,c){var a=this.itemElements[b.id];if(c){Echo.Sync.FillImage.render(this.component.render("selectionBackgroundImage"),a);Echo.Sync.Color.render(this.component.render("selectionBackground",Extras.Sync.Menu.DEFAULTS.selectionBackground),a,"backgroundColor");Echo.Sync.Color.render(this.component.render("selectionForeground",Extras.Sync.Menu.DEFAULTS.selectionForeground),a,"color")}else{a.style.backgroundImage="";a.style.backgroundColor="";a.style.color=""}}});Extras.Reorder.Sync=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.Reorder",this)},_div:null,_mouseUpRef:null,_mouseMoveRef:null,_movingDiv:null,_dragDiv:null,_overlayDiv:null,_order:null,_sourceIndex:null,_targetIndex:null,_childBounds:null,$construct:function(){this._mouseUpRef=Core.method(this,this._mouseUp);this._mouseMoveRef=Core.method(this,this._mouseMove)},_dragStart:function(){this._dragStop();this._overlayDiv=document.createElement("div");this._overlayDiv.style.cssText="position:absolute;z-index:30000;width:100%;height:100%;cursor:pointer;";Echo.Sync.FillImage.render(this.client.getResourceUrl("Echo","resource/Transparent.gif"),this._overlayDiv);document.body.appendChild(this._overlayDiv);Core.Web.Event.add(document.body,"mousemove",this._mouseMoveRef,true);Core.Web.Event.add(document.body,"mouseup",this._mouseUpRef,true)},_dragStop:function(){Core.Web.Event.remove(document.body,"mousemove",this._mouseMoveRef,true);Core.Web.Event.remove(document.body,"mouseup",this._mouseUpRef,true);if(this._overlayDiv){document.body.removeChild(this._overlayDiv);this._overlayDiv=null}},_getIndex:function(b){if(!this._childBounds){this._childBounds=[];var a=this._div.firstChild;while(a){this._childBounds.push(new Core.Web.Measure.Bounds(a));a=a.nextSibling}}if(b<this._childBounds[0].top){return 0}for(var c=0;c<this._childBounds.length;++c){if(b>=this._childBounds[c].top&&b<=this._childBounds[c].top+this._childBounds[c].height){return c}}return this._childBounds.length-1},_mouseDown:function(d){var c=null,a,b=d.target;while(b!=null&&b!=this._div){if(b.__REORDER_HANDLE){c=b;break}b=b.parentNode}if(!c){return}Core.Web.dragInProgress=true;Core.Web.DOM.preventEventDefault(d);while(b.parentNode!=this._div){b=b.parentNode}this._movingDiv=b;b=this._div.firstChild;a=0;while(b!=this._movingDiv){b=b.nextSibling;++a}this._sourceIndex=a;this._targetIndex=a;this._dragStart();this._movingDivBounds=new Core.Web.Measure.Bounds(this._movingDiv);this._dragOffsetY=d.clientY-this._movingDivBounds.top;this._dragDiv=this._movingDiv.cloneNode(true);this._dragDiv.style.opacity=0.8;this._dragDiv.style.position="absolute";this._dragDiv.style.zIndex=1000;this._dragDiv.style.left=this._movingDivBounds.left+"px";this._dragDiv.style.top=this._movingDivBounds.top+"px";this._dragDiv.style.width=this._movingDivBounds.width+"px";this._dragDiv.style.height=this._movingDivBounds.height+"px";document.body.appendChild(this._dragDiv);this._movingDiv.style.visibility="hidden"},_mouseMove:function(b){this._dragDiv.style.top=(b.clientY-this._dragOffsetY)+"px";var a=this._getIndex(b.clientY);if(a!=this._targetIndex){this._div.removeChild(this._movingDiv);if(a<this._div.childNodes.length){this._div.insertBefore(this._movingDiv,this._div.childNodes[a])}else{this._div.appendChild(this._movingDiv)}this._childBounds=null;this._targetIndex=a}},_mouseUp:function(a){Core.Web.dragInProgress=false;document.body.removeChild(this._dragDiv);this._dragDiv=null;this._dragStop();this._movingDiv.style.visibility="visible";this._movingDiv=null;this.component.reorder(this._sourceIndex,this._targetIndex)},renderAdd:function(e,d){this._div=document.createElement("div");this._div.id=this.component.renderId;this._div.style.cssText="";var b=this.component.getOrder();for(var c=0;c<b.length;++c){var a=document.createElement("div");Echo.Render.renderComponentAdd(e,this.component.children[b[c]],a);this._div.appendChild(a)}Core.Web.Event.add(this._div,"mousedown",Core.method(this,this._mouseDown));d.appendChild(this._div)},renderDispose:function(a){Core.Web.Event.removeAll(this._div);this._div=null},renderUpdate:function(c){var a=this._div;var b=a.parentNode;this.renderDispose(c);b.removeChild(a);this.renderAdd(c,b);return true}});Extras.Reorder.Handle.Sync=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.Reorder.Handle",this)},_span:null,_img:null,renderAdd:function(b,a){this._span=document.createElement("span");this._span.__REORDER_HANDLE=true;this._span.id=this.component.renderId;this._span.style.cssText="cursor:pointer;";this._img=document.createElement("img");this._img.src=this.component.render("icon",this.client.getResourceUrl("Extras","image/reorder/Icon32Move.png"));this._span.appendChild(this._img);a.appendChild(this._span)},renderDispose:function(a){Core.Web.Event.removeAll(this._span);this._span=null;this._img=null},renderUpdate:function(c){var a=this._span;var b=a.parentNode;this.renderDispose(c);b.removeChild(a);this.renderAdd(c,b);return false}});Extras.Sync.RichTextArea=Core.extend(Echo.Arc.ComponentSync,{$static:{DEFAULTS:{controlPaneStyle:{separatorColor:"#dfdfef",separatorHeight:1,autoPositioned:true},controlPaneRowStyle:{insets:"2px 10px",cellSpacing:3,layoutData:{overflow:Echo.SplitPane.OVERFLOW_HIDDEN,background:"#cfcfdf"}},controlPaneButtonStyle:{insets:"0px 8px",lineWrap:false,foreground:"#000000",rolloverEnabled:true,rolloverForeground:"#6f0f0f"},features:{menu:true,toolbar:true,undo:true,clipboard:true,alignment:true,foreground:true,background:true,list:true,table:true,image:true,horizontalRule:true,hyperlink:true,subscript:true,bold:true,italic:true,underline:true,strikethrough:true,paragraphStyle:true,indent:true}},resource:new Core.ResourceBundle({"ColorDialog.Title.Foreground":"Text Color","ColorDialog.Title.Background":"Highlight Color","ColorDialog.PromptForeground":"Foreground:","ColorDialog.PromptBackground":"Background:","Error.ClipboardAccessDisabled":"This browser has clipboard access disabled. Use keyboard shortcuts or change your security settings.","Generic.Cancel":"Cancel","Generic.Error":"Error","Generic.Ok":"Ok","HyperlinkDialog.Title":"Insert Hyperlink","HyperlinkDialog.PromptURL":"URL:","HyperlinkDialog.PromptDescription":"Description Text:","HyperlinkDialog.ErrorDialogTitle":"Cannot Insert Hyperlink","HyperlinkDialog.ErrorDialog.URL":"The URL entered is not valid.","ImageDialog.Title":"Insert Image","ImageDialog.PromptURL":"URL:","ImageDialog.ErrorDialogTitle":"Cannot Insert Image","ImageDialog.ErrorDialog.URL":"The URL entered is not valid.","Menu.Edit":"Edit","Menu.Undo":"Undo","Menu.Redo":"Redo","Menu.Cut":"Cut","Menu.Copy":"Copy","Menu.Paste":"Paste","Menu.Delete":"Delete","Menu.SelectAll":"Select All","Menu.Insert":"Insert","Menu.InsertImage":"Image...","Menu.InsertHyperlink":"Hyperlink...","Menu.InsertHorizontalRule":"Horizontal Rule","Menu.Table":"Table","Menu.Table.New":"New Table...","Menu.Table.DeleteRow":"Delete Row","Menu.Table.DeleteColumn":"Delete Column","Menu.Table.InsertRow":"Insert Row","Menu.Table.InsertColumn":"Insert Column","Menu.BulletedList":"Bulleted List","Menu.NumberedList":"Numbered List","Menu.Format":"Format","Menu.Bold":"Bold","Menu.Italic":"Italic","Menu.Underline":"Underline","Menu.Strikethrough":"Strikethrough","Menu.Superscript":"Superscript","Menu.Subscript":"Subscript","Menu.PlainText":"Plain Text","Menu.TextStyle":"Text Style","Menu.ParagraphStyle":"Paragraph Style","Menu.Alignment":"Alignment","Menu.Left":"Left","Menu.Right":"Right","Menu.Center":"Center","Menu.Justified":"Justified","Menu.Indent":"Indent","Menu.Outdent":"Outdent","Menu.SetForeground":"Set Text Color...","Menu.SetBackground":"Set Highlight Color...","Menu.Heading1":"Heading 1","Menu.Heading2":"Heading 2","Menu.Heading3":"Heading 3","Menu.Heading4":"Heading 4","Menu.Heading5":"Heading 5","Menu.Heading6":"Heading 6","Menu.Normal":"Normal","Menu.Preformatted":"Preformatted","TableDialog.Title":"Insert Table","TableDialog.PromptRows":"Rows:","TableDialog.PromptColumns":"Columns:","TableDialog.ErrorDialogTitle":"Cannot Insert Table","TableDialog.ErrorDialog.Columns":"The entered columns value is not valid.  Please specify a number between 1 and 50.","TableDialog.ErrorDialog.Rows":"The entered rows value is not valid.  Please specify a number between 1 and 50."})},_processDialogCloseRef:null,_execCommandListener:null,$load:function(){Echo.Render.registerPeer("Extras.RichTextArea",this)},$virtual:{getIcons:function(){var c=this._getDefaultIcons();var b=this.component.get("icons");if(b){for(var a in b){c[a]=b[a]}}return c},processInsertHyperlink:function(b){var a=new Extras.Sync.RichTextArea.HyperlinkDialog(this.component);a.addListener("insertHyperlink",Core.method(this,function(c){this._richTextInput.insertHtml('<a href="'+c.data.url+'">'+(c.data.description?c.data.description:c.data.url)+"</a>");this.focusDocument()}));this._openDialog(a)},processInsertImage:function(b){var a=new Extras.Sync.RichTextArea.ImageDialog(this.component);a.addListener("insertImage",Core.method(this,function(c){this._richTextInput.insertHtml('<img src="'+c.data.url+'">');this.focusDocument()}));this._openDialog(a)},processInsertTable:function(b){var a=new Extras.Sync.RichTextArea.TableDialog(this.component);a.addListener("insertTable",Core.method(this,function(c){this.newTable(c.data.columns,c.data.rows);this.focusDocument()}));this._openDialog(a)},processSetBackground:function(b){var a=new Extras.Sync.RichTextArea.ColorDialog(this.component,true,this._toolbarButtons.background.get("color"));a.addListener("colorSelect",Core.method(this,function(c){this.execCommand("background",c.data);this._toolbarButtons.background.set("color",c.data);this.focusDocument()}));this._openDialog(a)},processSetForeground:function(b){var a=new Extras.Sync.RichTextArea.ColorDialog(this.component,false,this._toolbarButtons.foreground.get("color"));a.addListener("colorSelect",Core.method(this,function(c){this.execCommand("foreground",c.data);this._toolbarButtons.foreground.set("color",c.data);this.focusDocument()}));this._openDialog(a)}},msg:null,icons:null,_paneRender:false,_toolbarButtons:null,_styleSelect:null,_richTextInput:null,_mainDiv:null,$construct:function(){this._execCommandListener=Core.method(this,function(a){this.execCommand(a.commandName,a.value)});this._processDialogCloseRef=Core.method(this,this._processDialogClose);this._toolbarButtons={}},_addComponentListeners:function(){this.component.addListener("execCommand",this._execCommandListener)},createComponent:function(){var c=this.component.render("features",Extras.Sync.RichTextArea.DEFAULTS.features);var b=new Echo.ContentPane();var e=b;if(c.menu){var d=new Echo.SplitPane({orientation:Echo.SplitPane.ORIENTATION_VERTICAL_TOP_BOTTOM,autoPositioned:true,children:[this._createMenu()]});e.add(d);e=d}if(c.toolbar){var a=new Echo.SplitPane({orientation:Echo.SplitPane.ORIENTATION_VERTICAL_TOP_BOTTOM,autoPositioned:true,children:[this._createToolbar()]});e.add(a);e=a}this._richTextInput=new Extras.RichTextInput({layoutData:{overflow:Echo.SplitPane.OVERFLOW_HIDDEN},background:this.component.render("background"),backgroundImage:this.component.render("backgroundImage"),border:this.component.render("border"),foreground:this.component.render("foreground"),text:this.component.get("text"),events:{action:Core.method(this,function(f){this.component.doAction()}),cursorStyleChange:Core.method(this,this._processCursorStyleChange),property:Core.method(this,function(f){if(f.propertyName=="text"){this._processTextUpdate(f)}})}});e.add(this._richTextInput);return b},_createMainMenuBarModel:function(){var c=this.component.render("features",Extras.Sync.RichTextArea.DEFAULTS.features);var g=new Extras.MenuModel(null,null,null);if(c.undo||c.clipboard){var e=new Extras.MenuModel(null,this.msg["Menu.Edit"],null);if(c.undo){e.addItem(new Extras.OptionModel("/undo",this.msg["Menu.Undo"],this.icons.undo));e.addItem(new Extras.OptionModel("/redo",this.msg["Menu.Redo"],this.icons.redo))}if(c.undo&&c.clipboard){e.addItem(new Extras.SeparatorModel())}if(c.clipboard){e.addItem(new Extras.OptionModel("cut",this.msg["Menu.Cut"],this.icons.cut));e.addItem(new Extras.OptionModel("copy",this.msg["Menu.Copy"],this.icons.copy));e.addItem(new Extras.OptionModel("paste",this.msg["Menu.Paste"],this.icons.paste));e.addItem(new Extras.OptionModel("delete",this.msg["Menu.Delete"],this.icons["delete"]));e.addItem(new Extras.SeparatorModel());e.addItem(new Extras.OptionModel("/selectall",this.msg["Menu.SelectAll"],this.icons.selectAll))}g.addItem(e)}if(c.list||c.horizontalRule||c.image||c.hyperlink){var d=new Extras.MenuModel(null,this.msg["Menu.Insert"],null);if(c.list||c.unorderedList){d.addItem(new Extras.OptionModel("/insertunorderedlist",this.msg["Menu.BulletedList"],this.icons.bulletedList))}if(c.list||c.orderedList){d.addItem(new Extras.OptionModel("/insertorderedlist",this.msg["Menu.NumberedList"],this.icons.numberedList))}d.addItem(new Extras.SeparatorModel());if(c.horizontalRule){d.addItem(new Extras.OptionModel("/inserthorizontalrule",this.msg["Menu.InsertHorizontalRule"],this.icons.horizontalRule))}if(c.image){d.addItem(new Extras.OptionModel("insertimage",this.msg["Menu.InsertImage"],this.icons.image))}if(c.hyperlink){d.addItem(new Extras.OptionModel("inserthyperlink",this.msg["Menu.InsertHyperlink"],this.icons.hyperlink))}g.addItem(d)}if(c.bold||c.italic||c.underline||c.strikeThrough||c.subscript||c.paragraphStyle||c.alignment||c.indent||c.foreground||c.background){var a=new Extras.MenuModel(null,this.msg["Menu.Format"],null);if(c.bold||c.italic||c.underline||c.strikeThrough||c.subscript){}if(c.paragraphStyle){a.addItem(new Extras.MenuModel(null,this.msg["Menu.ParagraphStyle"],this.icons.paragraphStyle,[new Extras.OptionModel("/formatblock/<p>",this.msg["Menu.Normal"],this.icons.styleNormal),new Extras.OptionModel("/formatblock/<pre>",this.msg["Menu.Preformatted"],this.icons.stylePreformatted),new Extras.OptionModel("/formatblock/<h1>",this.msg["Menu.Heading1"],this.icons.styleH1),new Extras.OptionModel("/formatblock/<h2>",this.msg["Menu.Heading2"],this.icons.styleH2),new Extras.OptionModel("/formatblock/<h3>",this.msg["Menu.Heading3"],this.icons.styleH3),new Extras.OptionModel("/formatblock/<h4>",this.msg["Menu.Heading4"],this.icons.styleH4),new Extras.OptionModel("/formatblock/<h5>",this.msg["Menu.Heading5"],this.icons.styleH5),new Extras.OptionModel("/formatblock/<h6>",this.msg["Menu.Heading6"],this.icons.styleH6)]))}if(c.bold||c.italic||c.underline||c.strikeThrough||c.subscript){var b=new Extras.MenuModel(null,this.msg["Menu.TextStyle"],this.icons.textStyle);b.addItem(new Extras.OptionModel("/removeformat",this.msg["Menu.PlainText"],this.icons.plainText));b.addItem(new Extras.SeparatorModel());if(c.bold){b.addItem(new Extras.OptionModel("/bold",this.msg["Menu.Bold"],this.icons.bold))}if(c.italic){b.addItem(new Extras.OptionModel("/italic",this.msg["Menu.Italic"],this.icons.italic))}if(c.underline){b.addItem(new Extras.OptionModel("/underline",this.msg["Menu.Underline"],this.icons.underline))}if(c.strikethrough){b.addItem(new Extras.OptionModel("/strikethrough",this.msg["Menu.Strikethrough"],this.icons.strikethrough))}b.addItem(new Extras.SeparatorModel());if(c.subscript){b.addItem(new Extras.OptionModel("/superscript",this.msg["Menu.Superscript"],this.icons.superscript));b.addItem(new Extras.OptionModel("/subscript",this.msg["Menu.Subscript"],this.icons.subscript))}a.addItem(b)}if(c.alignment){a.addItem(new Extras.MenuModel(null,this.msg["Menu.Alignment"],this.icons.alignment,[new Extras.OptionModel("/justifyleft",this.msg["Menu.Left"],this.icons.alignmentLeft),new Extras.OptionModel("/justifycenter",this.msg["Menu.Center"],this.icons.alignmentCenter),new Extras.OptionModel("/justifyright",this.msg["Menu.Right"],this.icons.alignmentRight),new Extras.OptionModel("/justifyfull",this.msg["Menu.Justified"],this.icons.alignmentJustify)]))}a.addItem(new Extras.SeparatorModel());if(c.indent){a.addItem(new Extras.OptionModel("/indent",this.msg["Menu.Indent"],this.icons.indent));a.addItem(new Extras.OptionModel("/outdent",this.msg["Menu.Outdent"],this.icons.outdent))}a.addItem(new Extras.SeparatorModel());if(c.foreground||c.background){if(c.foreground){a.addItem(new Extras.OptionModel("foreground",this.msg["Menu.SetForeground"],this.icons.foreground))}if(c.background){a.addItem(new Extras.OptionModel("background",this.msg["Menu.SetBackground"],this.icons.background))}}g.addItem(a)}if(c.table){var f=new Extras.MenuModel(null,this.msg["Menu.Table"],null);f.addItem(new Extras.OptionModel("tableNew",this.msg["Menu.Table.New"],this.icons.table));f.addItem(new Extras.SeparatorModel());f.addItem(new Extras.OptionModel("/tableInsertRow",this.msg["Menu.Table.InsertRow"],this.icons.tableInsertRow));f.addItem(new Extras.OptionModel("/tableInsertColumn",this.msg["Menu.Table.InsertColumn"],this.icons.tableInsertColumn));f.addItem(new Extras.SeparatorModel());f.addItem(new Extras.OptionModel("/tableDeleteRow",this.msg["Menu.Table.DeleteRow"],this.icons.tableDeleteRow));f.addItem(new Extras.OptionModel("/tableDeleteColumn",this.msg["Menu.Table.DeleteColumn"],this.icons.tableDeleteColumn));g.addItem(f)}return g},_createMenu:function(){return new Extras.MenuBarPane({styleName:this.component.render("menuStyleName"),model:this._createMainMenuBarModel(),events:{action:Core.method(this,this._processMenuAction)}})},_createToolbar:function(){var f,b;var c=this.component.render("features",Extras.Sync.RichTextArea.DEFAULTS.features);var e;var a=new Echo.Panel({styleName:this.component.render("toolbarPanelStyleName"),layoutData:{overflow:Echo.SplitPane.OVERFLOW_HIDDEN},insets:2,children:[e=new Echo.Row({styleName:this.component.render("toolbarRowStyleName"),cellSpacing:10})]});if(c.paragraphStyle){var d=Core.method(this,function(h){var g=this._styleSelect.get("selectedId");this._richTextInput.execCommand("formatblock","<"+g+">")});this._styleSelect=new Echo.SelectField({items:[{id:"p",text:this.msg["Menu.Normal"]},{id:"pre",text:this.msg["Menu.Preformatted"]},{id:"h1",text:this.msg["Menu.Heading1"]},{id:"h2",text:this.msg["Menu.Heading2"]},{id:"h3",text:this.msg["Menu.Heading3"]},{id:"h4",text:this.msg["Menu.Heading4"]},{id:"h5",text:this.msg["Menu.Heading5"]},{id:"h6",text:this.msg["Menu.Heading6"]}],events:{action:d}});e.add(this._styleSelect)}if(c.undo){e.add(new Echo.Row({children:[this._createToolbarButton("<<<",this.icons.undo,this.msg["Menu.Undo"],this._processCommand,"undo"),this._createToolbarButton(">>>",this.icons.redo,this.msg["Menu.Redo"],this._processCommand,"redo")]}))}if(c.bold||c.italic||c.underline){f=new Echo.Row();if(c.bold){b=this._createToolbarButton("B",this.icons.bold,this.msg["Menu.Bold"],this._processCommand,"bold");b.set("toggle",true);f.add(b)}if(c.italic){b=this._createToolbarButton("I",this.icons.italic,this.msg["Menu.Italic"],this._processCommand,"italic");b.set("toggle",true);f.add(b)}if(c.underline){b=this._createToolbarButton("U",this.icons.underline,this.msg["Menu.Underline"],this._processCommand,"underline");b.set("toggle",true);f.add(b)}e.add(f)}if(c.subscript){e.add(new Echo.Row({children:[this._createToolbarButton("^",this.icons.superscript,this.msg["Menu.Superscript"],this._processCommand,"superscript"),this._createToolbarButton("v",this.icons.subscript,this.msg["Menu.Subscript"],this._processCommand,"subscript")]}))}if(c.alignment){e.add(new Echo.Row({children:[this._createToolbarButton("<-",this.icons.alignmentLeft,this.msg["Menu.Left"],this._processCommand,"justifyleft"),this._createToolbarButton("-|-",this.icons.alignmentCenter,this.msg["Menu.Center"],this._processCommand,"justifycenter"),this._createToolbarButton("->",this.icons.alignmentRight,this.msg["Menu.Right"],this._processCommand,"justifyright"),this._createToolbarButton("||",this.icons.alignmentJustify,this.msg["Menu.Justified"],this._processCommand,"justifyfull")]}))}if(c.foreground||c.background){f=new Echo.Row();if(c.foreground){f.add(this._createToolbarButton("FG",this.icons.foreground,this.msg["Menu.SetForeground"],this.processSetForeground,"foreground"))}if(c.background){f.add(this._createToolbarButton("BG",this.icons.background,this.msg["Menu.SetBackground"],this.processSetBackground,"background"))}e.add(f)}if(c.list||c.horizontalRule||c.image||c.hyperlink||c.table){f=new Echo.Row();if(c.list||c.unorderedList){f.add(this._createToolbarButton("Bulleted List",this.icons.bulletedList,this.msg["Menu.BulletedList"],this._processCommand,"insertunorderedlist"))}if(c.list||c.orderedList){f.add(this._createToolbarButton("Numbered List",this.icons.numberedList,this.msg["Menu.NumberedList"],this._processCommand,"insertorderedlist"))}if(c.horizontalRule){f.add(this._createToolbarButton("Horizontal Rule",this.icons.horizontalRule,this.msg["Menu.InsertHorizontalRule"],this._processCommand,"inserthorizontalrule"))}if(c.image){f.add(this._createToolbarButton("Image",this.icons.image,this.msg["Menu.InsertImage"],this.processInsertImage))}if(c.hyperlink){f.add(this._createToolbarButton("Hyperlink",this.icons.hyperlink,this.msg["Menu.InsertHyperlink"],this.processInsertHyperlink))}if(c.table){f.add(this._createToolbarButton("Table",this.icons.table,this.msg["Menu.NewTable"],this.processInsertTable))}e.add(f)}return a},_createToolbarButton:function(f,c,d,e,a){var b=new Extras.Sync.RichTextArea.ToolbarButton({actionCommand:a,styleName:this.component.render("toolbarButtonStyleName"),text:c?null:f,icon:c,toolTipText:d});if(e){b.addListener("action",Core.method(this,e))}this._toolbarButtons[a]=b;return b},execCommand:function(a,b){this._richTextInput.execCommand(a,b)},focusDocument:function(){this.arcApplication.setFocusedComponent(this._richTextInput)},getDomainElement:function(){return this._mainDiv},_getDefaultIcons:function(){var a={"16":["alignment","alignmentCenter","alignmentJustify","alignmentLeft","alignmentRight","background","bold","bulletedList","cancel","copy","cut","delete","foreground","horizontalRule","hyperlink","image","indent","italic","numberedList","ok","outdent","paragraphStyle","paste","plainText","redo","selectAll","strikethrough","subscript","superscript","table","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn","textStyle","underline","undo"],"24":["ok","cancel"]};var e={};for(var c in a){for(var b=0;b<a[c].length;++b){var d=a[c][b].charAt(0).toUpperCase()+a[c][b].substring(1);e[a[c][b]]=this.client.getResourceUrl("Extras","image/richtext/Icon"+c+d+".png")}}return e},insertImage:function(a){this._richTextInput.insertHtml('<img src="'+a+'">')},newTable:function(e,f){var d="",c,b=Core.Web.Env.ENGINE_MSHTML?"":"<br/>";for(c=0;c<e;++c){d+="<td>"+b+"</td>"}d="<tr>"+d+"</tr>";var a='<table width="100%" border="1" cellspacing="0" cellpadding="1"><tbody>';for(c=0;c<f;++c){a+=d}a+="</tbody></table>";this._richTextInput.insertHtml(a)},_openDialog:function(b){var a;if(this._overlayPane==null){this._overlayPane=new Extras.Sync.RichTextArea.OverlayPane();this._overlayPane.rta=this.component;a=new Echo.ContentPane();this._overlayPane.add(a);this.baseComponent.add(this._overlayPane)}else{a=this._overlayPane.children[0]}a.add(b);b.addListener("parent",this._processDialogCloseRef)},_processCommand:function(a){this.execCommand(a.actionCommand);this.focusDocument()},_processCursorStyleChange:function(a){if(this._toolbarButtons.bold){this._toolbarButtons.bold.set("pressed",a.style.bold)}if(this._toolbarButtons.italic){this._toolbarButtons.italic.set("pressed",a.style.italic)}if(this._toolbarButtons.underline){this._toolbarButtons.underline.set("pressed",a.style.underline)}if(this._toolbarButtons.foreground){this._toolbarButtons.foreground.set("color",a.style.foreground||"#000000")}if(this._toolbarButtons.background){this._toolbarButtons.background.set("color",a.style.background||"#ffffff")}if(this._styleSelect){this._styleSelect.set("selectedId",a.style.paragraphStyle)}},_processDialogClose:function(a){if(a.newValue!=null){return}if(this._overlayPane.children[0].children.length===0){this.baseComponent.remove(this._overlayPane);this._overlayPane=null}a.source.removeListener("parent",this._processDialogCloseRef)},_processMenuAction:function(b){if(b.modelId.charAt(0)=="/"){var c=b.modelId.indexOf("/",1);if(c==-1){this._richTextInput.execCommand(b.modelId.substring(1))}else{this._richTextInput.execCommand(b.modelId.substring(1,c),b.modelId.substring(c+1))}}else{switch(b.modelId){case"foreground":this.processSetForeground();break;case"background":this.processSetBackground();break;case"tableNew":this.processInsertTable();break;case"inserthyperlink":this.processInsertHyperlink();break;case"insertimage":this.processInsertImage();break;case"cut":case"copy":case"paste":case"delete":try{this._richTextInput.execCommand(b.modelId)}catch(a){this._openDialog(new Extras.Sync.RichTextArea.MessageDialog(this.component,this.msg["Generic.Error"],this.msg["Error.ClipboardAccessDisabled"]))}}}},_processTextUpdate:function(a){this.component.set("text",a.newValue)},_removeComponentListeners:function(){this.component.removeListener("execCommand",this._execCommandListener)},renderAdd:function(b,a){this._addComponentListeners();this.msg=Extras.Sync.RichTextArea.resource.get(this.component.getRenderLocale());this.icons=this.getIcons();if(!this.icons){this.icons={}}this._paneRender=this.component.parent.pane;this._mainDiv=document.createElement("div");this._mainDiv.id=this.component.renderId;if(this._paneRender){this._mainDiv.style.cssText="position:absolute;top:0px;left:0px;right:0px;bottom:0px;"}else{this._mainDiv.style.position="relative";this._mainDiv.style.height="300px"}a.appendChild(this._mainDiv)},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this._mainDiv);Echo.Arc.ComponentSync.prototype.renderDisplay.call(this)},renderDispose:function(a){this._removeComponentListeners();Echo.Arc.ComponentSync.prototype.renderDispose.call(this,a);this._mainDiv=null},renderFocus:function(){this.arcApplication.setFocusedComponent(this._richTextInput)},renderUpdate:function(c){if(c.isUpdatedPropertySetIn({text:true})){if(this._richTextInput){this._richTextInput.set("text",this.component.get("text"))}c.renderContext.displayRequired=[];return}var a=this._mainDiv;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b)}});Extras.Sync.RichTextArea.AbstractDialog=Core.extend(Echo.WindowPane,{$static:{TYPE_OK:0,TYPE_OK_CANCEL:1},$abstract:true,rta:null,$construct:function(g,d,c,f){this.rta=g;var b=g.render("controlPaneSplitPaneStyleName");var e=g.render("controlPaneRowStyleName");var h=g.render("controlPaneButtonStyleName");Echo.WindowPane.call(this,{styleName:g.render("windowPaneStyleName"),contentWidth:"25em",modal:true,resizable:false,events:{close:Core.method(this,this.processCancel)},children:[new Echo.SplitPane({orientation:Echo.SplitPane.ORIENTATION_VERTICAL_BOTTOM_TOP,autoPositioned:true,styleName:b,style:b?null:Extras.Sync.RichTextArea.DEFAULTS.controlPaneStyle,children:[this.controlsRow=new Echo.Row({styleName:e,style:e?null:Extras.Sync.RichTextArea.DEFAULTS.controlPaneRowStyle}),f]})]});this.controlsRow.add(new Echo.Button({styleName:h,style:h?null:Extras.Sync.RichTextArea.DEFAULTS.controlPaneButtonStyle,text:g.peer.msg["Generic.Ok"],icon:g.peer.icons.ok,events:{action:Core.method(this,this.processOk)}}));if(d==Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK_CANCEL){this.controlsRow.add(new Echo.Button({styleName:h,style:h?null:Extras.Sync.RichTextArea.DEFAULTS.controlPaneButtonStyle,text:g.peer.msg["Generic.Cancel"],icon:g.peer.icons.cancel,events:{action:Core.method(this,this.processCancel)}}))}for(var a in c){this.set(a,c[a])}},$virtual:{processCancel:function(a){this.parent.remove(this)},processOk:function(a){this.parent.remove(this)}}});Extras.Sync.RichTextArea.ColorDialog=Core.extend(Extras.Sync.RichTextArea.AbstractDialog,{$static:{COLORS:["#fce94f","#edd400","#c4a000","#fcaf3e","#f57900","#e8b86e","#e9b96e","#c17d11","#8f5902","#8ae234","#73d216","#4e9a06","#729fcf","#3465a4","#204a87","#ad7fa8","#75507b","#5c3566","#ef2929","#cc0000","#a40000","#eeeeec","#d3d7cf","#babdb6","#888a85","#555753","#2e3436","#ffffff","#7f7f7f","#000000"]},$construct:function(c,a,b){Extras.Sync.RichTextArea.AbstractDialog.call(this,c,Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK_CANCEL,{title:c.peer.msg[a?"ColorDialog.Title.Background":"ColorDialog.Title.Foreground"],icon:a?c.peer.icons.background:c.peer.icons.foreground,contentWidth:"32em"},new Echo.Row({cellSpacing:"1em",insets:"1em",children:[new Echo.Column({children:[new Echo.Label({text:c.peer.msg[a?"ColorDialog.PromptBackground":"ColorDialog.PromptForeground"]}),this._colorSelect=new Extras.ColorSelect({color:b,displayValue:true})]}),new Echo.Grid({insets:2,size:3,children:this._createSwatches()})]}))},_createSwatches:function(){var b=[];var d=Extras.Sync.RichTextArea.ColorDialog.COLORS;var c=Core.method(this,function(f){this._colorSelect.set("color",f.actionCommand)});for(var a=0;a<d.length;++a){b.push(new Echo.Button({height:"1em",width:"3em",background:d[a],border:"1px outset "+d[a],actionCommand:d[a],events:{action:c}}))}return b},processOk:function(b){var a=this._colorSelect.get("color");this.parent.remove(this);this.fireEvent({type:"colorSelect",source:this,data:a})}});Extras.Sync.RichTextArea.HyperlinkDialog=Core.extend(Extras.Sync.RichTextArea.AbstractDialog,{$construct:function(a){Extras.Sync.RichTextArea.AbstractDialog.call(this,a,Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK_CANCEL,{title:a.peer.msg["HyperlinkDialog.Title"],icon:a.peer.icons.hyperlink},new Echo.Column({insets:10,children:[new Echo.Label({text:a.peer.msg["HyperlinkDialog.PromptURL"]}),this._urlField=new Echo.TextField({width:"100%"}),new Echo.Label({text:a.peer.msg["HyperlinkDialog.PromptDescription"]}),this._descriptionField=new Echo.TextField({width:"100%"})]}))},processOk:function(b){var a={url:this._urlField.get("text"),description:this._descriptionField.get("text")};if(!a.url){this.parent.add(new Extras.Sync.RichTextArea.MessageDialog(this.rta,this.rta.peer.msg["HyperlinkDialog.ErrorDialogTitle"],this.rta.peer.msg["HyperlinkDialog.ErrorDialog.URL"]));return}this.parent.remove(this);this.fireEvent({type:"insertHyperlink",source:this,data:a})}});Extras.Sync.RichTextArea.ImageDialog=Core.extend(Extras.Sync.RichTextArea.AbstractDialog,{$construct:function(a){Extras.Sync.RichTextArea.AbstractDialog.call(this,a,Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK_CANCEL,{title:a.peer.msg["ImageDialog.Title"],icon:a.peer.icons.image},new Echo.Column({insets:10,children:[new Echo.Label({text:a.peer.msg["ImageDialog.PromptURL"]}),this._urlField=new Echo.TextField({width:"100%"})]}))},processOk:function(b){var a={url:this._urlField.get("text")};if(!a.url){this.parent.add(new Extras.Sync.RichTextArea.MessageDialog(this.rta,this.rta.peer.msg["ImageDialog.ErrorDialogTitle"],this.rta.peer.msg["ImageDialog.ErrorDialog.URL"]));return}this.parent.remove(this);this.fireEvent({type:"insertImage",source:this,data:a})}});Extras.Sync.RichTextArea.OverlayPane=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.RichTextOverlayPane",this)},rta:null,componentType:"Extras.RichTextOverlayPane",floatingPane:true,pane:true});Extras.Sync.RichTextArea.OverlayPanePeer=Core.extend(Echo.Render.ComponentSync,{_div:null,$load:function(){Echo.Render.registerPeer("Extras.RichTextOverlayPane",this)},renderAdd:function(b,a){this._div=document.createElement("div");this.client.addElement(this._div);this._div.style.cssText="position:absolute;top:0;right:0;bottom:0;left:0;z-index:20000;";if(this.component.children.length==1){Echo.Render.renderComponentAdd(b,this.component.children[0],this._div)}else{if(this.component.children.length>1){throw new Error("Too many children added to OverlayPane.")}}document.body.appendChild(this._div)},renderDisplay:function(a){if(this._div.style.display!="block"){this._div.style.display="block";this.client.forceRedraw()}Core.Web.VirtualPosition.redraw(this._div)},renderDispose:function(a){if(!this._div){return}this.client.removeElement(this._div);if(this._div.parentNode){this._div.parentNode.removeChild(this._div)}this._div=null},renderHide:function(){this._div.style.display="none"},renderUpdate:function(c){var a=this._div;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b);return true}});Extras.Sync.RichTextArea.MessageDialog=Core.extend(Extras.Sync.RichTextArea.AbstractDialog,{$construct:function(b,c,a){Extras.Sync.RichTextArea.AbstractDialog.call(this,b,Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK,{title:c},new Echo.Label({text:a,layoutData:{insets:30}}))}});Extras.Sync.RichTextArea.TableDialog=Core.extend(Extras.Sync.RichTextArea.AbstractDialog,{$construct:function(a){Extras.Sync.RichTextArea.AbstractDialog.call(this,a,Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK_CANCEL,{title:a.peer.msg["TableDialog.Title"],icon:a.peer.icons.table,contentWidth:"35em"},new Echo.Row({insets:"1em",cellSpacing:"1em",children:[this._sizeSelector=new Extras.Sync.RichTextArea.TableSizeSelector({rows:2,columns:3,events:{property:Core.method(this,this._processSelectorUpdate)}}),new Echo.Grid({width:"100%",insets:3,children:[new Echo.Label({text:a.peer.msg["TableDialog.PromptRows"],layoutData:{alignment:"trailing"}}),this._rowsField=new Echo.TextField({text:"2",alignment:"center",width:"5em",events:{property:Core.method(this,this._processTextUpdate)}}),new Echo.Label({text:a.peer.msg["TableDialog.PromptColumns"],layoutData:{alignment:"trailing"}}),this._columnsField=new Echo.TextField({text:"3",alignment:"center",width:"5em",events:{property:Core.method(this,this._processTextUpdate)}})]})]}))},processOk:function(b){var a={rows:parseInt(this._rowsField.get("text"),10),columns:parseInt(this._columnsField.get("text"),10)};if(isNaN(a.rows)||a.rows<1||a.rows>50){this.parent.add(new Extras.Sync.RichTextArea.MessageDialog(this.rta,this.rta.peer.msg["TableDialog.ErrorDialogTitle"],this.rta.peer.msg["TableDialog.ErrorDialog.Rows"]));return}if(isNaN(a.columns)||a.columns<1||a.columns>50){this.parent.add(new Extras.Sync.RichTextArea.MessageDialog(this.rta,this.rta.peer.msg["TableDialog.ErrorDialogTitle"],this.rta.peer.msg["TableDialog.ErrorDialog.Columns"]));return}this.parent.remove(this);this.fireEvent({type:"insertTable",source:this,data:a})},_processSelectorUpdate:function(c){var a=parseInt(this._sizeSelector.get("columns"),10),b=parseInt(this._sizeSelector.get("rows"),10);this._columnsField.set("text",a);this._rowsField.set("text",b)},_processTextUpdate:function(c){var a=parseInt(this._columnsField.get("text"),10),b=parseInt(this._rowsField.get("text"),10);if(!isNaN(a)){this._sizeSelector.set("columns",a)}if(!isNaN(b)){this._sizeSelector.set("rows",b)}return true}});Extras.Sync.RichTextArea.TableSizeSelector=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.RichTextTableSizeSelector",this)},componentType:"Extras.RichTextTableSizeSelector"});Extras.Sync.RichTextArea.TableSizeSelectorPeer=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.RichTextTableSizeSelector",this)},_div:null,_table:null,_dragInProgress:false,_drawSelection:function(){var i=parseInt(this.component.render("rows",0),10),c=parseInt(this.component.render("columns",0),10),f=this._table.firstChild.firstChild,g=0,b,h,e,d,a;while(f){b=f.firstChild;h=0;while(b){e=h<c&&g<i;a=e?this._selectedBackground:null;d=e?this._selectedBorder:this._border;Echo.Sync.Color.renderClear(a,b,"backgroundColor");Echo.Sync.Border.renderClear(d,b);b=b.nextSibling;++h}f=f.nextSibling;++g}},_processMouseDown:function(a){this._dragInProgress=true;this._processMouseSelection(a);return true},_processMouseMove:function(a){if(this._dragInProgress){this._processMouseSelection(a)}return true},_processMouseSelection:function(c){var a=0,d=0,b=c.target;if(!b.nodeName||b.nodeName.toLowerCase()!="td"){return}while(b.previousSibling){++a;b=b.previousSibling}b=b.parentNode;while(b.previousSibling){++d;b=b.previousSibling}this.component.set("columns",a+1);this.component.set("rows",d+1)},_processMouseUp:function(a){this._dragInProgress=false;return true},renderAdd:function(h,b){var c,g,d,f,e,a;this._rowSize=this.component.render("rowSize",10);this._columnSize=this.component.render("columnSize",15);this._border=this.component.render("border","1px outset #dfdfdf");this._selectedBorder=this.component.render("selectedBorder","1px outset #4f4f5f");this._selectedBackground=this.component.render("selectedBackground","#4f4f5f");this._div=document.createElement("div");this._div.id=this.component.renderId;this._table=document.createElement("table");this._table.cellPadding=0;this._table.cellSpacing=0;this._table.style.cssText="padding:0;border:none;font-size:1px;";this._table.style.width=(this._columnSize*18)+"px";Echo.Sync.Color.render(this.component.render("background","#dfdfdf"),this._table,"backgroundColor");c=document.createElement("tbody");this._table.appendChild(c);g=document.createElement("tr");for(a=0;a<this._columnSize;++a){f=document.createElement("td");f.style.cssText="padding:0;width:16px;height:16px;";f.appendChild(document.createTextNode("\u00a0"));Echo.Sync.Border.render(this._border,f);g.appendChild(f)}for(e=0;e<this._rowSize;++e){c.appendChild(g.cloneNode(true))}this._div.appendChild(this._table);Core.Web.Event.Selection.disable(this._div);Core.Web.Event.add(this._div,"mousedown",Core.method(this,this._processMouseDown),false);Core.Web.Event.add(this._div,"mousemove",Core.method(this,this._processMouseMove),false);Core.Web.Event.add(this._div,"mouseup",Core.method(this,this._processMouseUp),false);b.appendChild(this._div);this._drawSelection()},renderDispose:function(a){Core.Web.Event.removeAll(this._div);this._table=null;this._div=null},renderUpdate:function(c){if(c.isUpdatedPropertySetIn({columns:true,rows:true})){this._drawSelection();return}var a=this._div;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b);return true}});Extras.Sync.RichTextArea.ToolbarButton=Core.extend(Echo.Button,{$load:function(){Echo.ComponentFactory.registerType("Extras.RichTextToolbarButton",this)},componentType:"Extras.RichTextToolbarButton",doAction:function(){if(this.render("toggle")){this.set("pressed",!this.get("pressed"))}this.fireEvent({source:this,type:"action",actionCommand:this.render("actionCommand")})}});Extras.Sync.RichTextArea.ToolbarButtonPeer=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.RichTextToolbarButton",this)},_div:null,_processClick:function(a){if(!this.client||!this.client.verifyInput(this.component)){return true}this.client.application.setFocusedComponent(this.component);this.component.doAction()},_processRolloverEnter:function(a){if(!this.client||!this.client.verifyInput(this.component)){return true}this._renderButtonState(true)},_processRolloverExit:function(a){this._renderButtonState(false)},renderAdd:function(d,a){var b=this.component.render("icon");this._div=document.createElement("div");this._div.style.cssText="position:relative;";this._renderButtonState(false);if(this.component.render("color")){this._renderColor()}Echo.Sync.Insets.render(this.component.render("insets"),this._div,"padding");if(b){var c=document.createElement("img");Echo.Sync.ImageReference.renderImg(b,c);this._div.appendChild(c)}Core.Web.Event.add(this._div,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(this._div,"mouseover",Core.method(this,this._processRolloverEnter),false);Core.Web.Event.add(this._div,"mouseout",Core.method(this,this._processRolloverExit),false);a.appendChild(this._div)},_renderButtonState:function(a){var d=this.component.render("foreground");var c=this.component.render("background");var b=this.component.render("border");var e=this.component.render("backgroundImage");if(this.component.render("pressed")){d=this.component.render("pressedForeground",d);c=this.component.render("presssedBackground",c);b=this.component.render("pressedBorder",b);e=this.component.render("pressedBackgroundImage",e)}if(a){d=this.component.render("rolloverForeground",d);c=this.component.render("rolloverBackground",c);e=this.component.render("rolloverBackgroundImage",e)}Echo.Sync.Color.renderClear(d,this._div,"color");Echo.Sync.Color.renderClear(c,this._div,"backgroundColor");Echo.Sync.Border.renderClear(b,this._div);Echo.Sync.FillImage.renderClear(e,this._div)},_renderColor:function(){var a=this.component.render("color");if(!this._colorDiv){this._colorDiv=document.createElement("div");this._colorDiv.style.cssText="position:absolute;bottom:0;left:0;right:0;height:5px;line-height:0px;font-size:1px;";if(Core.Web.Env.BROWSER_INTERNET_EXPLORER&&Core.Web.Env.BROWSER_VERSION_MAJOR===6){this._colorDiv.style.width="16px"}this._colorDiv.style.backgroundColor=a||"#ffffff";this._div.appendChild(this._colorDiv)}},renderDispose:function(a){Core.Web.Event.removeAll(this._div);this._div=null;this._colorDiv=null},renderFocus:function(){},renderUpdate:function(c){var a=this._div;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b);return true}});Extras.Sync.RichTextInput=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.RichTextInput",this)},$static:{DEFAULTS:{border:"1px inset #7f7f7f"},BLOCK_NODES:{p:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,pre:true,li:true},EditedHtml:Core.extend({_peer:null,className:"Extras.RichTextInput.EditedHtml",$construct:function(a){this._peer=a},toString:function(){return this._peer._getProcessedHtml()}}),Html:{_LEADING_WHITESPACE:/^(\s|<br\/?>|&nbsp;)+/i,_TRAILING_WHITESPACE:/(\s|<br\/?>|&nbsp;)+$/i,_MSIE_INVALID_FONT_COLOR_REPL:/(<font .*?color\=)(#[0-9a-fA-F]{3,6})(.*?>)/ig,_MSIE_INVALID_FONT_BACKGROUND_REPL:/(<font .*?)(background-color)/ig,_CSS_BOLD:/font-weight\:\s*bold/i,_CSS_FOREGROUND_TEST:/^-?color\:/i,_CSS_FOREGROUND_RGB:/^-?color\:\s*rgb\s*\(\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/i,_CSS_BACKGROUND_TEST:/background-color\:/i,_CSS_BACKGROUND_RGB:/background-color\:\s*rgb\s*\(\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/i,_CSS_ITALIC:/font-style\:\s*italic/i,_CSS_UNDERLINE:/text-decoration\:\s*underline/i,StyleData:Core.extend({bold:false,italic:false,underline:false,paragraphStyle:null,foreground:null,background:null,$construct:function(c){var a;while(c){if(c.nodeType==1){switch(c.nodeName.toLowerCase()){case"b":case"strong":this.bold=true;break;case"i":case"em":this.italic=true;break;case"u":this.underline=true;break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"p":case"pre":if(!this.paragraphStyle){this.paragraphStyle=c.nodeName.toLowerCase()}break}var b=c.style.cssText;this.bold|=Extras.Sync.RichTextInput.Html._CSS_BOLD.test(b);this.italic|=Extras.Sync.RichTextInput.Html._CSS_ITALIC.test(b);this.underline|=Extras.Sync.RichTextInput.Html._CSS_UNDERLINE.test(b);if(!this.foreground&&Extras.Sync.RichTextInput.Html._CSS_FOREGROUND_TEST.test(b)){a=Extras.Sync.RichTextInput.Html._CSS_FOREGROUND_RGB.exec(b);if(a){this.foreground=Echo.Sync.Color.toHex(parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],10))}}if(!this.background&&Extras.Sync.RichTextInput.Html._CSS_BACKGROUND_TEST.test(b)){a=Extras.Sync.RichTextInput.Html._CSS_BACKGROUND_RGB.exec(b);if(a){this.background=Echo.Sync.Color.toHex(parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],10))}}}c=c.parentNode}}}),clean:function(a){a=a||"<p></p>";a=a.replace(Extras.Sync.RichTextInput.Html._LEADING_WHITESPACE,"");a=a.replace(Extras.Sync.RichTextInput.Html._TRAILING_WHITESPACE,"");if(Core.Web.Env.ENGINE_MSHTML){a=a.replace(Extras.Sync.RichTextInput.Html._MSIE_INVALID_FONT_COLOR_REPL,'$1"$2"$3');a=a.replace(Extras.Sync.RichTextInput.Html._MSIE_INVALID_FONT_BACKGROUND_REPL,"$1background-color")}return a}},Range:Core.extend({ieRange:null,domRange:null,window:null,$construct:function(a){this.window=a;if(Core.Web.Env.ENGINE_MSHTML){this.ieRange=a.document.selection.createRange();if(this.ieRange.parentElement().ownerDocument!=a.document){a.focus();this.ieRange=a.document.selection.createRange();if(this.ieRange.parentElement().ownerDocument!=a.document){this.ieRange=null}}}else{this.domRange=a.getSelection().getRangeAt(0)}},activate:function(){if(this.domRange){var a=this.window.getSelection();if(!a){return}a.removeAllRanges();a.addRange(this.domRange)}else{if(this.ieRange){this.ieRange.select()}}},dispose:function(){this.domRange=null;this.ieRange=null;this.window=null},getContainingNode:function(a){var b;if(this.domRange){b=this.domRange.commonAncestorContainer}else{if(this.ieRange){b=this.ieRange.parentElement()}}if(a){while(b!=null){if(b.nodeType==1&&b.nodeName.toLowerCase()==a){return b}b=b.parentNode}}return b}}),_NAVIGATION_KEY_CODES:{38:1,40:1,37:1,39:1,33:1,34:1,36:1,35:1,8:1,46:1}},_cursorStyleUpdateRequired:false,_fireAction:false,_renderedHtml:null,_propertyListener:null,_execCommandListener:null,_div:null,_iframe:null,_document:null,_temporaryCssStyleEnabled:false,$construct:function(){this._propertyListener=Core.method(this,function(a){if(a.propertyName=="text"){this._loadData()}});this._execCommandListener=Core.method(this,function(a){this._execCommand(a.commandName,a.value)})},_addComponentListeners:function(){this.component.addListener("execCommand",this._execCommandListener);this.component.addListener("property",this._propertyListener)},_deleteTableColumn:function(){var a=Core.method(this,function(b){b.parentNode.removeChild(b)});this._updateSelectedTableColumn(a)},_deleteTableRow:function(){var a=this._selectionRange.getContainingNode("tr");if(!a){return}a.parentNode.removeChild(a)},_disposeRange:function(){if(this._selectionRange){this._selectionRange.dispose()}},_execCommand:function(a,b){if(this._temporaryCssStyleEnabled){this._document.execCommand("styleWithCSS",false,false);this._temporaryCssStyleEnabled=false}if(this._selectionRange){this._loadRange()}else{this._storeRange()}switch(a){case"tableDeleteColumn":this._deleteTableColumn();break;case"tableDeleteRow":this._deleteTableRow();break;case"tableInsertColumn":this._insertTableColumn();break;case"tableInsertRow":this._insertTableRow();break;case"foreground":this._document.execCommand("forecolor",false,b);break;case"background":if(Core.Web.Env.ENGINE_GECKO){this._document.execCommand("styleWithCSS",false,true);this._document.execCommand("hilitecolor",false,b);this._temporaryCssStyleEnabled=true}else{this._document.execCommand(Core.Web.Env.ENGINE_MSHTML?"backcolor":"hilitecolor",false,b)}break;case"insertHtml":if(Core.Web.Env.ENGINE_MSHTML){if(!this._selectionRange){this._storeRange()}this._selectionRange.ieRange.pasteHTML(b)}else{this._document.execCommand("inserthtml",false,b)}this._storeRange();break;default:this._document.execCommand(a,false,b);break}this._storeData();this.client.forceRedraw();this._cursorStyleUpdateRequired=true},focusDocument:function(){this.client.application.setFocusedComponent(this.component);this.client.forceRedraw()},_getProcessedHtml:function(){if(this._renderedHtml==null){this._renderedHtml=this._document.body.innerHTML}return Extras.Sync.RichTextInput.Html.clean(this._renderedHtml)},_getTableColumnIndex:function(e){var c=e.parentNode;if(c.nodeName.toLowerCase()!="tr"){return -1}var a=0;var b=c.firstChild;while(b&&b!=e){var d=b.nodeName.toLowerCase();if(d=="td"||d=="th"){++a}b=b.nextSibling}if(!b){return -1}return a},_insertTableColumn:function(){var a=Core.method(this,function(c){var b=this._document.createElement("td");if(!Core.Web.Env.ENGINE_MSHTML){b.appendChild(this._document.createElement("br"))}c.parentNode.insertBefore(b,c)});this._updateSelectedTableColumn(a)},_insertTableRow:function(){var e=this._selectionRange.getContainingNode("tr");var d=this._selectionRange.getContainingNode("table");if(!e||!d){return}var a=this._document.createElement("tr");var c=e.firstChild;while(c){if(c.nodeType==1&&(c.nodeName.toLowerCase()=="td"||c.nodeName.toLowerCase()=="th")){var b=this._document.createElement("td");if(!Core.Web.Env.ENGINE_MSHTML){b.appendChild(this._document.createElement("br"))}a.appendChild(b)}c=c.nextSibling}e.parentNode.insertBefore(a,e)},_loadData:function(){var a=this.component.get("text")||(Core.Web.Env.ENGINE_GECKO?"<p><br/></p>":"<p></p>");if(a instanceof Extras.Sync.RichTextInput.EditedHtml){return}if(this._renderedHtml==null){this._renderedHtml=this._document.body.innerHTML}if(a==this._renderedHtml){return}this._renderedHtml=a;this._document.body.innerHTML=a;if(this._selectionRange){this.component.doCursorStyleChange(new Extras.Sync.RichTextInput.Html.StyleData(this._selectionRange.getContainingNode()))}},_loadRange:function(){if(this._selectionRange){this._selectionRange.activate();if(Core.Web.Env.ENGINE_MSHTML&&this.component.application.getFocusedComponent()!=this.component){this._iframe.contentWindow.blur()}}},_notifyCursorStyleChange:function(){this._cursorStyleUpdateRequired=false;Core.Web.Scheduler.run(Core.method(this,function(){this.component.doCursorStyleChange(new Extras.Sync.RichTextInput.Html.StyleData(this._selectionRange.getContainingNode()))}))},_processFocus:function(a){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(a);return}this.client.application.setFocusedComponent(this.component)},_processKeyDown:function(a){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(a);return}if(a.keyCode==13){this._processNewLine();this._fireAction=true}},_processKeyPress:function(a){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(a);return}},_processKeyUp:function(a){if(!this.client||!this.client.verifyInput(this.component)){return}this._storeData();this._storeRange();if(this._cursorStyleUpdateRequired||Extras.Sync.RichTextInput._NAVIGATION_KEY_CODES[a.keyCode]){this._notifyCursorStyleChange()}if(this._fireAction){this._fireAction=false;this.component.doAction()}},_processMouseDown:function(a){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(a);return}this.client.application.setFocusedComponent(this.component)},_processMouseUp:function(a){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(a);return}this._storeRange();this._notifyCursorStyleChange()},_processNewLine:function(){var b,a;if(!Core.Web.Env.ENGINE_GECKO&&!Core.Web.Env.ENGINE_WEBKIT){return}this._storeRange();b=this._selectionRange.domRange.endContainer;a=false;while(b.nodeType!=1||b.nodeName.toLowerCase()!="body"){if(b.nodeType==1&&Extras.Sync.RichTextInput.BLOCK_NODES[b.nodeName.toLowerCase()]){a=true;break}b=b.parentNode}if(a){return}this._document.execCommand("formatblock",null,"<p>")},_removeComponentListeners:function(){this.component.removeListener("execCommand",this._execCommandListener);this.component.removeListener("property",this._propertyListener)},renderAdd:function(b,a){this._addComponentListeners();this._div=document.createElement("div");Echo.Sync.Border.render(this.component.render("border",Extras.Sync.RichTextInput.DEFAULTS.border),this._div);this._iframe=document.createElement("iframe");this._iframe.style.width=this.width?this.width:"100%";if(!this.component.get("paneRender")){this._iframe.style.height=this.height?this.height:"200px"}this._iframe.style.border="0px none";this._iframe.frameBorder="0";this._div.appendChild(this._iframe);a.appendChild(this._div)},_renderDocument:function(){var f=this._iframe;while(f!=document.body){if(f==null){return}if(f.nodeType==1&&f.style.display=="none"){return}f=f.parentNode}var a="height:100%;width:100%;margin:0px;padding:0px;";var g=this.component.render("foreground");if(g){a+="color:"+g+";"}var b=this.component.render("background");if(b){a+="background-color:"+b+";"}var h=this.component.render("backgroundImage");if(h){a+="background-attachment: fixed;";a+="background-image:url("+Echo.Sync.FillImage.getUrl(h)+");";var e=Echo.Sync.FillImage.getRepeat(h);if(e){a+="background-repeat:"+e+";"}var c=Echo.Sync.FillImage.getPosition(h);if(c){a+="background-position:"+c+";"}}var i=this.component.get("text");this._document=this._iframe.contentWindow.document;this._document.open();this._document.write('<html><body tabindex="0" width="100%" height="100%"'+(a?(' style="'+a+'"'):"")+">"+(i||"")+"</body></html>");this._document.close();if(Core.Web.Env.BROWSER_MOZILLA&&!Core.Web.Env.BROWSER_FIREFOX){var d=function(){this._document.designMode="on"};setTimeout(d,0)}else{this._document.designMode="on";if(Core.Web.Env.ENGINE_GECKO||Core.Web.Env.ENGINE_WEBKIT){this._document.execCommand("insertbronreturn",false,false);this._document.execCommand("stylewithcss",false,false);this._document.execCommand("enableObjectResizing",false,false);this._document.execCommand("enableInlineTableEditing",false,false)}}Core.Web.Event.add(this._document,"focus",Core.method(this,this._processFocus),false);Core.Web.Event.add(this._document,"keydown",Core.method(this,this._processKeyDown),false);Core.Web.Event.add(this._document,"keypress",Core.method(this,this._processKeyPress),false);Core.Web.Event.add(this._document,"keyup",Core.method(this,this._processKeyUp),false);Core.Web.Event.add(this._document,"mousedown",Core.method(this,this._processMouseDown),false);Core.Web.Event.add(this._document,"mouseup",Core.method(this,this._processMouseUp),false);this._documentRendered=true},_renderDocumentRemove:function(){Core.Web.Event.removeAll(this._document);while(this._document.body.firstChild){this._document.body.removeChild(this._document.body.firstChild)}this._documentRendered=false},renderDispose:function(a){this._removeComponentListeners();Core.Web.Event.removeAll(this._document);this._div=null;this._iframe=null;this._document=null;this._documentRendered=false;this._selectionRange=null},renderDisplay:function(){if(!this._documentRendered){this._renderDocument()}this.client.forceRedraw();var d=new Core.Web.Measure.Bounds(this._div.parentNode);if(d.height){var a=this.component.render("border",Extras.Sync.RichTextInput.DEFAULTS.border);var b=Echo.Sync.Border.getPixelSize(a,"top")+Echo.Sync.Border.getPixelSize(a,"bottom");var c=(d.height<100?100:d.height-b)+"px";if(this._iframe.style.height!=c){this._iframe.style.height=c}}},renderFocus:function(){if(Core.Web.Env.BROWSER_SAFARI){window.focus()}Core.Web.DOM.focusElement(this._iframe.contentWindow);this.client.forceRedraw()},renderHide:function(){this._disposeRange();this._renderedHtml=this._document.body.innerHTML;this._renderDocumentRemove()},renderUpdate:function(c){if(c.isUpdatedPropertySetIn({text:true})){this._loadData();c.renderContext.displayRequired=[];return}var a=this._div;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b)},_storeData:function(){this._renderedHtml=null;this.component.set("text",new Extras.Sync.RichTextInput.EditedHtml(this),true)},_storeRange:function(){this._disposeRange();this._selectionRange=new Extras.Sync.RichTextInput.Range(this._iframe.contentWindow)},_updateSelectedTableColumn:function(c){var d=this._selectionRange.getContainingNode("td");if(!d){return}var a=this._getTableColumnIndex(d);if(a===-1){return}var b=this._selectionRange.getContainingNode("table");this._updateTableColumnFromTbody(b,a,c)},_updateTableColumnFromTbody:function(b,a,d){var c=b.firstChild;while(c){if(c.nodeType==1){var e=c.nodeName.toLowerCase();if(e=="tbody"){this._updateTableColumnFromTbody(c,a,d)}else{if(e=="tr"){this._updateTableColumnFromTr(c,a,d)}}}c=c.nextSibling}},_updateTableColumnFromTr:function(e,a,d){var b=-1;var c=e.firstChild;while(c){if(c.nodeType==1){var f=c.nodeName.toLowerCase();if(f=="td"||f=="th"){++b;if(b==a){d(c);return}}}c=c.nextSibling}}});Extras.Sync.TabPane=Core.extend(Echo.Render.ComponentSync,{$static:{_TABLE:null,_createTable:function(){if(!this._TABLE){this._TABLE=document.createElement("table");this._TABLE.style.cssText="border-collapse:collapse;padding:0;";var a=document.createElement("tbody");this._TABLE.appendChild(a);var b=document.createElement("tr");a.appendChild(b)}return this._TABLE.cloneNode(true)},_supportedPartialProperties:["activeTabId","activeTabIndex"],_DEFAULTS:{borderType:Extras.TabPane.BORDER_TYPE_ADJACENT_TO_TABS,foreground:"#000000",insets:2,tabActiveBorder:"1px solid #00004f",tabActiveHeightIncrease:2,tabAlignment:"top",tabCloseIconTextMargin:5,tabContentInsets:0,tabIconTextMargin:5,tabInactiveBorder:"1px solid #7f7f7f",tabInset:10,tabInsets:"1px 8px",tabPosition:Extras.TabPane.TAB_POSITION_TOP,tabSpacing:0},ScrollRunnable:Core.extend(Core.Web.Scheduler.Runnable,{repeat:true,timeInterval:20,reverse:false,distance:0,clickDistance:50,pixelsPerSecond:400,initialPosition:null,disposed:false,peer:null,lastInvokeTime:null,$construct:function(b,a){this.peer=b;this.reverse=a;this.initialPosition=b.scrollPosition;this.lastInvokeTime=new Date().getTime()},dispose:function(){if(!this.disposed){Core.Web.Scheduler.remove(this)}this.disposed=true},finish:function(){if(this.distance<this.clickDistance){this.distance=this.clickDistance;this.updatePosition()}this.peer.renderDisplay();this.dispose()},run:function(){var a=new Date().getTime();this.distance+=Math.ceil(this.pixelsPerSecond*(a-this.lastInvokeTime)/1000);this.lastInvokeTime=a;this.updatePosition()},updatePosition:function(){var a=this.initialPosition+((this.reverse?-1:1)*this.distance);if(!this.peer.setScrollPosition(a)){this.dispose()}}})},$load:function(){Echo.Render.registerPeer("Extras.TabPane",this)},_icons:null,_div:null,_contentContainerDiv:null,_headerContainerBoundsDiv:null,_headerContainerDiv:null,_activeTabId:null,_displayedTabId:null,_previousControlDiv:null,_nextControlDiv:null,_pendingRollover:null,_rolloverTabId:null,_rolloverTabCloseState:false,_rolloverRunnable:null,_tabs:null,_totalTabWidth:0,_headerHeight:null,_layoutRequired:false,_headerImageLoadingComplete:false,_headerUpdateRequired:false,_tabSelectListenerRef:null,_scrollRunnable:null,scrollPosition:0,_rtl:false,_focusAnchor:null,_focusAnchorDiv:null,$construct:function(){this._tabs=[];this._tabSelectListenerRef=Core.method(this,this._tabSelectListener)},_addTab:function(c,b,a){if(a==null||a==this._tabs.length){this._tabs.push(b);b._renderAdd(c);this._headerContainerDiv.appendChild(b._headerDiv);this._contentContainerDiv.appendChild(b._contentDiv)}else{this._tabs.splice(a,0,b);b._renderAdd(c);this._headerContainerDiv.insertBefore(b._headerDiv,this._headerContainerDiv.childNodes[a]);this._contentContainerDiv.insertBefore(b._contentDiv,this._contentContainerDiv.childNodes[a])}},_renderLayout:function(){if(!this._layoutRequired){return}this._renderHeaderPositions();if(this._headerHeight===0){return}this._layoutRequired=false;if(this._borderDiv){this._borderDiv.style[this._tabSide]=(this._headerHeight-this._ibContentInsetsPx[this._tabSide])+"px"}var b=this._borderType==Extras.TabPane.BORDER_TYPE_NONE?0:Echo.Sync.Border.getPixelSize(this._border);this._headerContainerBoundsDiv.style.height=this._headerHeight+"px";this._contentContainerDiv.style.left=this._contentContainerDiv.style.right=this._contentContainerDiv.style[this._oppositeSide]=0;this._contentContainerDiv.style[this._tabSide]=(this._headerHeight-b)+"px";Core.Web.VirtualPosition.redraw(this._contentContainerDiv);Core.Web.VirtualPosition.redraw(this._headerContainerDiv);Core.Web.VirtualPosition.redraw(this._headerContainerBoundsDiv);for(var a=0;a<this._tabs.length;++a){this._tabs[a]._renderDisplay()}if(!this._headerImageLoadingComplete){this._headerImageLoadingComplete=true;var c=Core.method(this,function(){if(this.component){this._layoutRequired=true;this._renderLayout()}});c.id="TabPane:"+this.component.renderId;Core.Web.Image.monitor(this._headerContainerDiv,c)}},_renderHeaderPositions:function(){var c=0,l=0,a,k,d,j=this._tabHeight?(this._tabHeight+"px"):"";this._totalTabWidth=0;this._headerHeight=0;var b=this.component.render("tabWidth")?null:this.component.render("tabMaximumWidth");var g;if(b){if(Echo.Sync.Extent.isPercent(b)){var h=parseInt(b,10);g=Math.floor(this._tabContainerWidth*h/100)}else{g=Echo.Sync.Extent.toPixels(b)}}for(d=0;d<this._tabs.length;++d){this._tabs[d]._heightTd.style.height=j;if(g){this._tabs[d]._textDiv.style.width="";var f=new Core.Web.Measure.Bounds(this._tabs[d]._textDiv,{flags:Core.Web.Measure.Bounds.FLAG_MEASURE_DIMENSION});if(f.width>g){this._tabs[d]._textDiv.style.width=g+"px"}}var e=new Core.Web.Measure.Bounds(this._tabs[d]._headerDiv,{flags:Core.Web.Measure.Bounds.FLAG_MEASURE_DIMENSION});var m=this._tabActiveHeightIncreasePx+this._tabInactivePositionAdjustPx+this._tabs[d]._activeSurroundHeight-this._tabs[d]._inactiveSurroundHeight;if(this._tabs[d]._active){a=e.height;k=e.height-m}else{k=e.height;a=e.height+m}l=k>l?k:l;c=a>c?a:c;this._tabs[d]._headerDiv.style.left=this._totalTabWidth+"px";this._tabs[d]._headerDiv.style.zIndex=(this._rolloverTabId===this._tabs[d].id)?(this._tabs.length):(this._tabs[d]._active?this._tabs.length+1:d);this._totalTabWidth+=e.width;if(d<this._tabs.length-1){this._totalTabWidth+=this._tabSpacingPx}}for(d=0;d<this._tabs.length;++d){if(this._tabs[d]._active){this._tabs[d]._heightTd.style.height=(c-(this._tabs[d]._activeSurroundHeight+this._tabInactivePositionAdjustPx+this._tabActiveHeightIncreasePx))+"px"}else{this._tabs[d]._heightTd.style.height=(l-this._tabs[d]._inactiveSurroundHeight)+"px"}}this._headerHeight=c>l?c:l;if(Core.Web.VirtualPosition.enabled){for(d=0;d<this._tabs.length;++d){if(this._tabs[d]._fibContainer){Echo.Sync.FillImageBorder.renderContainerDisplay(this._tabs[d]._fibContainer);Core.Web.VirtualPosition.redraw(this._tabs[d]._backgroundDiv)}}}},_getActiveTabId:function(){var a=this.component.get("activeTabId");if(!a){var b=this.component.get("activeTabIndex");if(b!=null&&b<this.component.children.length){a=this.component.children[b].renderId}}return a},_getSeparatorHeight:function(){if(this._borderType==Extras.TabPane.BORDER_TYPE_NONE){return 0}if(this._imageBorder){return 0}return Echo.Sync.Border.getPixelSize(this._border,this._tabSide)},_getTabById:function(a){for(var b=0;b<this._tabs.length;++b){var c=this._tabs[b];if(c.id==a){return c}}return null},isChildVisible:function(a){return a.renderId==this._activeTabId},_processScrollRollover:function(c){if(!this.client||!this.client.verifyInput(this.component)){return}var b=c.registeredTarget===this._previousControlDiv;var d=c.type=="mouseover";var a;if(d){a=b?this._icons.rolloverScrollLeftIcon:this._icons.rolloverScrollRightIcon;if(!a&&!(b?this._icons.scrollLeftIcon:this._icons.scrollRightIcon)){a=this.client.getResourceUrl("Extras",b?"image/tabpane/PreviousRollover.png":"image/tabpane/NextRollover.png")}}else{a=b?this._icons.scrollLeftIcon:this._icons.scrollRightIcon;if(!a){a=this.client.getResourceUrl("Extras",b?"image/tabpane/Previous.png":"image/tabpane/Next.png")}}if(a){c.registeredTarget.firstChild.src=Echo.Sync.ImageReference.getUrl(a)}},_processScrollStart:function(a){if(!this.client||!this.client.verifyInput(this.component)){return}this._scrollRunnable=new Extras.Sync.TabPane.ScrollRunnable(this,a.registeredTarget===this._previousControlDiv);Core.Web.Scheduler.add(this._scrollRunnable)},_processScrollStop:function(a){if(!this._scrollRunnable){return}this._scrollRunnable.finish();this._scrollRunnable=null},_removeTab:function(b){var a=Core.Arrays.indexOf(this._tabs,b);if(a==-1){return}if(b.id==this._activeTabId){this._activeTabId=null}this._tabs.splice(a,1);Core.Web.DOM.removeNode(b._headerDiv);Core.Web.DOM.removeNode(b._contentDiv);b._renderDispose()},renderAdd:function(g,a){this._headerImageLoadingComplete=false;this.component.addListener("tabSelect",this._tabSelectListenerRef);this._icons={scrollLeftIcon:this.component.render("scrollLeftIcon"),scrollRightIcon:this.component.render("scrollRightIcon"),rolloverScrollLeftIcon:this.component.render("rolloverScrollLeftIcon"),rolloverScrollRightIcon:this.component.render("rolloverScrollRightIcon")};this._rtl=!this.component.getRenderLayoutDirection().isLeftToRight();this._activeTabId=this._getActiveTabId();this._tabRolloverEnabled=this.component.render("tabRolloverEnabled");this._insets=this.component.render("insets",Extras.Sync.TabPane._DEFAULTS.insets);this._tabActiveBorder=this.component.render("tabActiveBorder",Extras.Sync.TabPane._DEFAULTS.tabActiveBorder);this._imageBorder=this.component.render("imageBorder");this._border=this._imageBorder?null:this._border=this.component.render("border",this._tabActiveBorder);this._borderType=this.component.render("borderType",Extras.Sync.TabPane._DEFAULTS.borderType);this._tabInactiveBorder=this.component.render("tabInactiveBorder",Extras.Sync.TabPane._DEFAULTS.tabInactiveBorder);this._tabInsetPx=Echo.Sync.Extent.toPixels(this.component.render("tabInset",Extras.Sync.TabPane._DEFAULTS.tabInset));this._tabPositionBottom=this.component.render("tabPosition",Extras.Sync.TabPane._DEFAULTS.tabPosition)==Extras.TabPane.TAB_POSITION_BOTTOM;this._tabSide=this._tabPositionBottom?"bottom":"top";this._oppositeSide=this._tabPositionBottom?"top":"bottom";this._tabSpacingPx=Echo.Sync.Extent.toPixels(this.component.render("tabSpacing",Extras.Sync.TabPane._DEFAULTS.tabSpacing));this._tabActiveHeightIncreasePx=Echo.Sync.Extent.toPixels(this.component.render("tabActiveHeightIncrease",Extras.Sync.TabPane._DEFAULTS.tabActiveHeightIncrease));this._tabInactivePositionAdjustPx=this._getSeparatorHeight();this._tabCloseEnabled=this.component.render("tabCloseEnabled",false);if(this._tabCloseEnabled){this._icons.defaultIcon=this.component.render("tabCloseIcon");this._icons.disabledIcon=this.component.render("tabDisabledCloseIcon");this._icons.rolloverIcon=this.component.render("tabRolloverCloseIcon")}this._tabActiveInsets=Echo.Sync.Insets.toPixels(this.component.render("tabActiveInsets"));this._tabInactiveInsets=Echo.Sync.Insets.toPixels(this.component.render("tabInactiveInsets"));this._tabHeight=Echo.Sync.Extent.toPixels(this.component.render("tabHeight"),false)||0;var e=Echo.Sync.Insets.toPixels(this._insets);if(this._imageBorder){this._ibBorderInsetsPx=Echo.Sync.Insets.toPixels(this._imageBorder.borderInsets);this._ibContentInsetsPx=Echo.Sync.Insets.toPixels(this._imageBorder.contentInsets)}if(this._borderType==Extras.TabPane.BORDER_TYPE_SURROUND){if(this._imageBorder){e[this._oppositeSide]+=this._ibContentInsetsPx[this._oppositeSide];e.left+=this._ibContentInsetsPx.left;e.right+=this._ibContentInsetsPx.right}}else{if(this._borderType==Extras.TabPane.BORDER_TYPE_PARALLEL_TO_TABS){if(this._imageBorder){this._imageBorder={color:this._imageBorder.color,borderInsets:this._ibBorderInsetsPx.top+"px 0 "+this._ibBorderInsetsPx.bottom+"px",contentInsets:this._ibContentInsetsPx.top+"px 0 "+this._ibContentInsetsPx.bottom+"px",top:this._imageBorder.top,bottom:this._imageBorder.bottom};e[this._oppositeSide]+=this._ibContentInsetsPx[this._oppositeSide]}e.left=e.right=0}else{if(this._imageBorder){var f=this._tabPositionBottom?"0 0 ":"";var c=this._tabPositionBottom?"":" 0 0";this._imageBorder={color:this._imageBorder.color,borderInsets:f+this._ibBorderInsetsPx[this._tabSide]+"px"+c,contentInsets:f+this._ibContentInsetsPx[this._tabSide]+"px"+c,top:this._imageBorder.top}}e.left=e.right=e[this._oppositeSide]=0}}this._div=document.createElement("div");this._div.id=this.component.renderId;this._div.style.cssText="position:absolute;top:"+e.top+"px;right:"+e.right+"px;bottom:"+e.bottom+"px;left:"+e.left+"px;";this._headerContainerBoundsDiv=document.createElement("div");this._headerContainerBoundsDiv.style.cssText="position:absolute;overflow:hidden;z-index:1;"+(this._tabPositionBottom?"bottom":"top")+":0;left:"+this._tabInsetPx+"px;right:"+this._tabInsetPx+"px;";this._div.appendChild(this._headerContainerBoundsDiv);this._headerContainerDiv=document.createElement("div");if(this._focusAnchor==null){this._focusAnchorDiv=document.createElement("div");this._focusAnchorDiv.style.cssText="width:0;height:0;overflow:hidden;";this._focusAnchor=document.createElement("input");this._focusAnchorDiv.appendChild(this._focusAnchor);this._headerContainerDiv.appendChild(this._focusAnchorDiv);this._addEventHandlers()}this._headerContainerDiv.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;";Echo.Sync.Font.render(this.component.render("font"),this._headerContainerDiv);Echo.Sync.FillImage.render(this.component.render("tabBackgroundImage"),this._headerContainerDiv);this._headerContainerBoundsDiv.appendChild(this._headerContainerDiv);if(this._imageBorder){this._borderDiv=Echo.Sync.FillImageBorder.renderContainer(this._imageBorder,{absolute:true});if(this._tabPositionBottom){this._borderDiv.style.top=(0-this._ibContentInsetsPx.top)+"px";this._borderDiv.style.bottom=0}else{this._borderDiv.style.top=0;this._borderDiv.style.bottom=(0-this._ibContentInsetsPx.bottom)+"px"}this._borderDiv.style.left=(0-this._ibContentInsetsPx.left)+"px";this._borderDiv.style.right=(0-this._ibContentInsetsPx.right)+"px";this._div.appendChild(this._borderDiv)}this._contentContainerDiv=document.createElement("div");this._contentContainerDiv.style.cssText="position:absolute;overflow:hidden;";Echo.Sync.renderComponentDefaults(this.component,this._contentContainerDiv);if(this._border){if(this._borderType==Extras.TabPane.BORDER_TYPE_NONE){this._contentContainerDiv.style.border="0 none"}else{if(this._borderType==Extras.TabPane.BORDER_TYPE_SURROUND){Echo.Sync.Border.render(this._border,this._contentContainerDiv)}else{if(this._borderType==Extras.TabPane.BORDER_TYPE_PARALLEL_TO_TABS){Echo.Sync.Border.render(this._border,this._contentContainerDiv,"borderTop");Echo.Sync.Border.render(this._border,this._contentContainerDiv,"borderBottom")}else{if(this._tabPositionBottom){Echo.Sync.Border.render(this._border,this._contentContainerDiv,"borderBottom")}else{Echo.Sync.Border.render(this._border,this._contentContainerDiv,"borderTop")}}}}}this._div.appendChild(this._contentContainerDiv);this._verifyActiveTabAvailable();for(var b=0;b<this.component.children.length;++b){var d=new Extras.Sync.TabPane.Tab(this.component.children[b],this);this._addTab(g,d)}this._layoutRequired=true;a.appendChild(this._div)},renderDisplay:function(){var a,b;Core.Web.VirtualPosition.redraw(this._div);this._tabContainerWidth=new Core.Web.Measure.Bounds(this._div,{flags:Core.Web.Measure.Bounds.FLAG_MEASURE_DIMENSION}).width-(2*this._tabInsetPx);this._renderHeaderUpdate();this._renderLayout();if(this._displayedTabId!=this._activeTabId){if(this._displayedTabId!=null){b=this._getTabById(this._displayedTabId);if(b!=null){b._renderState(false)}}if(this._activeTabId!=null){b=this._getTabById(this._activeTabId);b._renderState(true)}this._displayedTabId=this._activeTabId}this._renderHeaderPositions();if(this._borderDiv){Core.Web.VirtualPosition.redraw(this._borderDiv);Echo.Sync.FillImageBorder.renderContainerDisplay(this._borderDiv)}Core.Web.VirtualPosition.redraw(this._contentContainerDiv);Core.Web.VirtualPosition.redraw(this._headerContainerDiv);for(a=0;a<this._tabs.length;++a){this._tabs[a]._renderDisplay()}this.setScrollPosition(this.scrollPosition)},renderDispose:function(b){this.component.removeListener("tabSelect",this._tabSelectListenerRef);this._activeTabId=null;for(var a=0;a<this._tabs.length;a++){this._tabs[a]._renderDispose()}this._tabs=[];this._div=null;this._borderDiv=null;this._headerContainerBoundsDiv=null;this._headerContainerDiv=null;this._focusAnchor=null;this._focusAnchorDiv=null;this._contentContainerDiv=null;if(this._previousControlDiv){Core.Web.Event.removeAll(this._previousControlDiv);this._previousControlDiv=null}if(this._nextControlDiv){Core.Web.Event.removeAll(this._nextControlDiv);this._nextControlDiv=null}},_renderHeaderUpdate:function(){if(!this._headerUpdateRequired){return}this._headerUpdateRequired=false;for(var a=0;a<this._tabs.length;++a){this._tabs[a]._loadProperties();this._tabs[a]._renderHeaderState(this._tabs[a].id===this._activeTabId,false,true)}},renderUpdate:function(e){var k=false,d,f;this._headerImageLoadingComplete=false;if(e.hasUpdatedLayoutDataChildren()){this._headerUpdateRequired=true}if(!k){if(!Core.Arrays.containsAll(Extras.Sync.TabPane._supportedPartialProperties,e.getUpdatedPropertyNames(),true)){k=true}}if(!k){var c=false;var h=e.getRemovedChildren();if(h){for(f=0;f<h.length;++f){d=this._getTabById(h[f].renderId);if(!d){continue}if(h[f].renderId==this._displayedTabId){this._displayedTabId=null}this._removeTab(d)}}var a=e.getAddedChildren();if(a){for(f=0;f<a.length;++f){d=new Extras.Sync.TabPane.Tab(a[f],this);this._addTab(e,d,this.component.indexOf(a[f]))}}if(e.hasUpdatedProperties()){if(e.getUpdatedProperty("activeTabId")){this._activeTabId=e.getUpdatedProperty("activeTabId").newValue}else{if(e.getUpdatedProperty("activeTabIndex")){var g=e.getUpdatedProperty("activeTabIndex").newValue;if(g>=0&&g<this.component.children.length){this._activeTabId=this.component.children[g].renderId}}}}this._verifyActiveTabAvailable();this._layoutRequired=true}if(k){var b=this._div;var j=b.parentNode;Echo.Render.renderComponentDispose(e,e.parent);j.removeChild(b);this.renderAdd(e,j)}return k},_setOversizeEnabled:function(e,c){var a=e?this._previousControlDiv:this._nextControlDiv,b;if(c){if(a){a.style.display="block"}else{a=document.createElement("div");a.style.cssText="position:absolute;z-index:2;cursor:pointer;";a.style[e?"left":"right"]="2px";b=document.createElement("img");a.appendChild(b);Core.Web.Event.add(a,"mousedown",Core.method(this,this._processScrollStart));Core.Web.Event.add(a,"mouseup",Core.method(this,this._processScrollStop));Core.Web.Event.add(a,"mouseover",Core.method(this,this._processScrollRollover));Core.Web.Event.add(a,"mouseout",Core.method(this,this._processScrollRollover));Core.Web.Event.Selection.disable(a);if(e){b.src=this._icons.scrollLeftIcon?Echo.Sync.ImageReference.getUrl(this._icons.scrollLeftIcon):this.client.getResourceUrl("Extras","image/tabpane/Previous.png");this._previousControlDiv=a}else{b.src=this._icons.scrollRightIcon?Echo.Sync.ImageReference.getUrl(this._icons.scrollRightIcon):this.client.getResourceUrl("Extras","image/tabpane/Next.png");this._nextControlDiv=a}this._div.appendChild(a);var f=new Core.Web.Measure.Bounds(this._headerContainerDiv,{flags:Core.Web.Measure.Bounds.FLAG_MEASURE_DIMENSION}).height;var d=Core.method(this,function(){if(b.height&&!isNaN(b.height)){var g=Math.floor((f-b.height)/2);if(g>0){a.style[this._tabPositionBottom?"bottom":"top"]=g+"px"}}});Core.Web.Image.monitor(a,d);d()}}else{if(a){a.style.display="none"}}},_setRolloverTab:function(a,b){this._pendingRollover={tabId:a,state:b};if(!this._rolloverRunnable){this._rolloverRunnable=new Core.Web.Scheduler.MethodRunnable(Core.method(this,function(){this._setRolloverTabImpl(this._pendingRollover.tabId,this._pendingRollover.state)}))}Core.Web.Scheduler.add(this._rolloverRunnable)},_setRolloverTabImpl:function(a,d){var b=this._rolloverTabId&&this._getTabById(this._rolloverTabId);var c=this._getTabById(a);if(d){if(this._rolloverTabId!=a){if(b){b.setRollover(false,false)}this._rolloverTabId=a;c.setRollover(true)}}else{if(this._rolloverTabId==a){this._rolloverTabId=null;if(b){b.setRollover(false,false)}}else{}}},setScrollPosition:function(b){var a=false,c=this._totalTabWidth>this._tabContainerWidth;b=c?b:0;if(b<0){b=0;a=true}else{if(b>0&&b>this._totalTabWidth-this._tabContainerWidth){b=this._totalTabWidth-this._tabContainerWidth;a=true}}this.scrollPosition=b;this._headerContainerDiv.style.left=(0-b)+"px";if(c){this._setOversizeEnabled(true,b>0);this._setOversizeEnabled(false,b<this._totalTabWidth-this._tabContainerWidth)}else{this._setOversizeEnabled(true,false);this._setOversizeEnabled(false,false)}return !a},_tabSelectListener:function(a){this._activeTabId=a.tab.renderId;Echo.Render.renderComponentDisplay(this.component)},_verifyActiveTabAvailable:function(){for(var a=0;a<this.component.children.length;++a){if(this.component.children[a].renderId==this._activeTabId){return}}this._activeTabId=this.component.children.length===0?null:this.component.children[0].renderId},_processKeyDown:function(c){var a=-1;for(var b=0;b<this._tabs.length;b++){if(this._tabs[b].id==this._activeTabId){a=b}}if(c.keyCode==37){if(a!=-1){if(a===0){this.component.doTabSelect(this._tabs[this._tabs.length-1].id)}else{this.component.doTabSelect(this._tabs[a-1].id)}}}else{if(c.keyCode==39){if(a!=-1){this.component.doTabSelect(this._tabs[(a+1)%this._tabs.length].id)}}}return true},_addEventHandlers:function(){Core.Web.Event.add(this._focusAnchor,"keydown",Core.method(this,this._processKeyDown),false);Core.Web.Event.add(this._focusAnchor,"focus",Core.method(this,this.processFocus),false);Core.Web.Event.add(this._focusAnchor,"blur",Core.method(this,this.processBlur),false)},processBlur:function(a){this._focused=false;this.renderDisplay();return true},processFocus:function(a){this._focused=true;this._headerUpdateRequired=true;this.renderDisplay();return false},renderFocus:function(){if(this._focused){return}this._focused=true;this._headerUpdateRequired=true;this.renderDisplay();Core.Web.DOM.focusElement(this._focusAnchor)}});Extras.Sync.TabPane.Tab=Core.extend({_active:null,_childComponent:null,_fibContainer:null,_parent:null,_headerDiv:null,_contentDiv:null,_closeIconTd:null,_tabCloseEnabled:false,_defaultZIndex:0,_activeSurroundHeight:null,_inactiveSurroundHeight:null,_labelDiv:null,_textDiv:null,id:null,$construct:function(a,b){this.id=a.renderId;this._childComponent=a;this._parent=b},_getCloseImage:function(c){var a=this._parent._icons;var b;if(this._tabCloseEnabled){if(c&&this._parent.component.render("tabCloseIconRolloverEnabled")){b=a.rolloverIcon}}else{b=a.disabledIcon}return b?b:a.defaultIcon||this._parent.client.getResourceUrl("Extras","image/tabpane/Close.gif")},_getContentInsets:function(){if(this._childComponent.pane){return 0}else{return this._parent.component.render("defaultContentInsets",Extras.Sync.TabPane._DEFAULTS.tabContentInsets)}},_getProperty:function(b,e,c,a){var d=this._layoutData[(e?"active":"inactive")+b]||this._parent.component.render((e?"tabActive":"tabInactive")+b);if(!e&&c){d=this._layoutData["rollover"+b]||this._parent.component.render("tabRollover"+b)||d}if(e&&a){d=this._layoutData["focused"+b]||this._parent.component.render("tabFocused"+b)||d}return d},_getSurroundHeight:function(f){var b,d,c,e;var a=this._parent._focused;b=Echo.Sync.Insets.toPixels(this._getProperty("Insets",f,false,a)||Extras.Sync.TabPane._DEFAULTS.tabInsets);e=b.top+b.bottom;if(this._useImageBorder){d=this._getProperty("ImageBorder",f,false,a);b=Echo.Sync.Insets.toPixels(d.contentInsets);return e+b.top+b.bottom}else{c=this._getProperty("Border",f,false,a)||(f?this._parent._tabActiveBorder:this._parent._tabInactiveBorder);return e+Echo.Sync.Border.getPixelSize(c,this._parent._tabSide)}},_loadProperties:function(){this._layoutData=this._childComponent.render("layoutData")||{};this._useImageBorder=this._getProperty("ImageBorder",false,false,false);this._tabCloseEnabled=this._parent._tabCloseEnabled&&this._layoutData.closeEnabled;this._activeSurroundHeight=this._getSurroundHeight(true);this._inactiveSurroundHeight=this._getSurroundHeight(false)},_processClick:function(a){if(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component)){return true}if(this._closeIconTd&&Core.Web.DOM.isAncestorOf(this._closeIconTd,a.target)){if(!this._tabCloseEnabled){return}this._parent.component.doTabClose(this.id)}else{this._parent.component.doTabSelect(this.id,this._parent._activeTabId==this.id)}},_processCloseRollover:function(a){var b=a.type=="mouseover"||a.type=="mouseenter";if(b&&(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component))){return true}this._closeIconTd.firstChild.src=Echo.Sync.ImageReference.getUrl(this._getCloseImage(b));return true},_processRollover:function(a){var b=a.type=="mouseover"||a.type=="mouseenter";if(b&&(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component))){return true}this._parent._setRolloverTab(this.id,b)},_renderAdd:function(a){this._loadProperties();this._headerDiv=document.createElement("div");this._headerDiv.style.cssText="position:absolute;";this._contentDiv=document.createElement("div");this._contentDiv.style.cssText="position:absolute;top:0;left:0;overflow:auto;";if(Core.Web.Env.BROWSER_MOZILLA&&!Core.Web.Env.BROWSER_FIREFOX){this._contentDiv.style.right="100%";this._contentDiv.style.bottom="100%"}else{this._contentDiv.style.display="none";this._contentDiv.style.right="0";this._contentDiv.style.bottom="0"}Echo.Sync.Insets.render(this._getContentInsets(),this._contentDiv,"padding");Echo.Render.renderComponentAdd(a,this._childComponent,this._contentDiv);this._renderState(this.id==this._parent._activeTabId)},_renderDisplay:function(){if(this._fibContainer){Echo.Sync.FillImageBorder.renderContainerDisplay(this._fibContainer);Core.Web.VirtualPosition.redraw(this._backgroundDiv)}Core.Web.VirtualPosition.redraw(this._contentDiv)},_renderDispose:function(){Core.Web.Event.removeAll(this._headerDiv);if(this._rolloverRunnable){Core.Web.Scheduler.remove(this._rolloverRunnable)}this._fibContainer=null;this._parent=null;this._childComponent=null;this._headerDiv=null;this._contentDiv=null;this._closeIconTd=null;this._iconImg=null;this._textDiv=null;this._closeImg=null;this._heightTd=null;this._labelDiv=null;this._backgroundDiv=null},_renderHeader:function(d){var l=this._parent.component,g,n,i,c;var o=this._parent._focused;Core.Web.Event.removeAll(this._headerDiv);Core.Web.DOM.removeAllChildren(this._headerDiv);this._headerDiv.style[this._parent._tabPositionBottom?"top":"bottom"]=d?0:(this._parent._tabInactivePositionAdjustPx+"px");if(this._layoutData.toolTipText){this._headerDiv.title=this._layoutData.toolTipText}this._labelDiv=document.createElement("div");this._labelDiv.style.cssText="position:relative;white-space:nowrap;overflow:hidden;";Echo.Sync.Extent.render(this._parent.component.render("tabWidth"),this._labelDiv,"width",true,false);var e=this._labelDiv;if(this._useImageBorder){var m=this._getProperty("ImageBorder",d,false,o);var h=this._getProperty("BackgroundInsets",d,false,o);this._fibContainer=e=Echo.Sync.FillImageBorder.renderContainer(m,{child:this._labelDiv});var a=Echo.Sync.FillImageBorder.getContainerContent(this._fibContainer);a.style.zIndex=2;this._backgroundDiv=document.createElement("div");this._backgroundDiv.style.cssText="position:absolute;z-index:1;";Echo.Sync.Insets.renderPosition(h||m.borderInsets,this._backgroundDiv);this._fibContainer.appendChild(this._backgroundDiv);if(Core.Web.Env.BROWSER_INTERNET_EXPLORER&&Core.Web.Env.BROWSER_VERSION_MAJOR===6){e=Extras.Sync.TabPane._createTable();c=document.createElement("td");c.style.cssText="padding:0;";c.appendChild(this._fibContainer);e.firstChild.firstChild.appendChild(c)}}else{var f=this._getProperty("Border",d,false,o)||(d?this._parent._tabActiveBorder:this._parent._tabInactiveBorder);this._backgroundDiv=null;this._fibContainer=null;Echo.Sync.Border.render(f,this._labelDiv,this._parent._tabPositionBottom?"borderBottom":"borderTop");Echo.Sync.Border.render(f,this._labelDiv,"borderLeft");Echo.Sync.Border.render(f,this._labelDiv,"borderRight")}var j=this._layoutData&&this._layoutData.icon;var k=(this._layoutData?this._layoutData.title:null)||"*";var b=this._parent._tabCloseEnabled&&(this._tabCloseEnabled||this._parent._icons.disabledIcon);n=Extras.Sync.TabPane._createTable();i=n.firstChild.firstChild;if(j){c=document.createElement("td");c.style.cssText="padding:0;";Echo.Sync.Alignment.render(this._parent.component.render("tabAlignment",Extras.Sync.TabPane._DEFAULTS.tabAlignment),c,true,this._parent.component);this._iconImg=document.createElement("img");this._iconImg.style.marginRight=Echo.Sync.Extent.toCssValue(this._parent.component.render("tabIconTextMargin",Extras.Sync.TabPane._DEFAULTS.tabIconTextMargin),true,false);c.appendChild(this._iconImg);i.appendChild(c)}this._heightTd=document.createElement("td");this._heightTd.style.cssText="padding:0px;width:0px;";i.appendChild(this._heightTd);c=document.createElement("td");c.style.cssText="padding:0;";Echo.Sync.Alignment.render(l.render("tabAlignment",Extras.Sync.TabPane._DEFAULTS.tabAlignment),c,true,l);this._textDiv=document.createElement("div");this._textDiv.style.cssText="overflow:hidden;white-space:nowrap;";this._textDiv.appendChild(document.createTextNode(k));c.appendChild(this._textDiv);i.appendChild(c);if(b){this._closeIconTd=document.createElement("td");this._closeIconTd.style.cssText="padding:0;";Echo.Sync.Alignment.render(this._parent.component.render("tabAlignment",Extras.Sync.TabPane._DEFAULTS.tabAlignment),this._closeIconTd,true,this._parent.component);this._closeIconTd.style.padding="0 0 0 "+Echo.Sync.Extent.toCssValue(this._parent.component.render("tabCloseIconTextMargin",Extras.Sync.TabPane._DEFAULTS.tabCloseIconTextMargin),true,false);this._closeIconTd.style.cursor="pointer";this._closeImg=document.createElement("img");Echo.Sync.ImageReference.renderImg(this._getCloseImage(false),this._closeImg);this._closeIconTd.appendChild(this._closeImg);i.appendChild(this._closeIconTd)}this._labelDiv.appendChild(n);Core.Web.Event.Selection.disable(this._headerDiv);Core.Web.Event.add(this._headerDiv,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(this._headerDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseenter":"mouseover",Core.method(this,this._processRollover),false);Core.Web.Event.add(this._headerDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseleave":"mouseout",Core.method(this,this._processRollover),false);if(this._tabCloseEnabled){Core.Web.Event.add(this._closeIconTd,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseenter":"mouseover",Core.method(this,this._processCloseRollover),false);Core.Web.Event.add(this._closeIconTd,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseleave":"mouseout",Core.method(this,this._processCloseRollover),false)}this._headerDiv.appendChild(e)},_renderHeaderState:function(c,l,a){var k=!this._labelDiv||a;if(k){this._renderHeader(c)}var m=this._parent._focused;if(!a&&this._active==c&&(c||!this._parent._tabRolloverEnabled||this._rolloverState==l)){return}if(l){this._defaultZIndex=this._headerDiv.style.zIndex;this._headerDiv.style.zIndex=this._parent.component.children.length}else{this._headerDiv.style.zIndex=this._defaultZIndex}this._rolloverState=l;var h=this._parent.component,e,j,g,b;Echo.Sync.Color.renderClear(this._getProperty("Foreground",c,l,m),this._labelDiv,"color");Echo.Sync.Font.renderClear(this._getProperty("Font",c,l,m),this._labelDiv);this._labelDiv.style.cursor=c?"default":"pointer";Echo.Sync.Insets.render(this._getProperty("Insets",c,false,m)||Extras.Sync.TabPane._DEFAULTS.tabInsets,this._labelDiv,"padding");this._headerDiv.style[this._parent._tabPositionBottom?"top":"bottom"]=c?0:(this._parent._tabInactivePositionAdjustPx+"px");if(c){this._labelDiv.style[this._parent._tabPositionBottom?"paddingTop":"paddingBottom"]=(parseInt(this._labelDiv.style[this._parent._tabPositionBottom?"paddingTop":"paddingBottom"],10)+(this._parent._tabActiveHeightIncreasePx+this._parent._tabInactivePositionAdjustPx))+"px"}if(!k){if(this._useImageBorder){var i=this._getProperty("ImageBorder",c,l,m);var f=this._getProperty("BackgroundInsets",c,l,m);Echo.Sync.FillImageBorder.renderContainer(i,{update:this._fibContainer});Echo.Sync.Insets.renderPosition(f||i.borderInsets,this._backgroundDiv)}else{var d=this._getProperty("Border",c,l,m)||(c?this._parent._tabActiveBorder:this._parent._tabInactiveBorder);Echo.Sync.Border.render(d,this._labelDiv,this._parent._tabPositionBottom?"borderBottom":"borderTop");Echo.Sync.Border.render(d,this._labelDiv,"borderLeft");Echo.Sync.Border.render(d,this._labelDiv,"borderRight")}}Echo.Sync.Color.renderClear(this._getProperty("Background",c,l,m),this._backgroundDiv||this._labelDiv,"backgroundColor");Echo.Sync.FillImage.renderClear(this._getProperty("BackgroundImage",c,l,m),this._backgroundDiv||this._labelDiv,null);if(this._layoutData&&this._layoutData.icon){Echo.Sync.ImageReference.renderImg((c&&this._layoutData.activeIcon)||(l&&this._layoutData.rolloverIcon)||this._layoutData.icon,this._iconImg)}},_renderState:function(a){if(this._active===a){return}this._renderHeaderState(a);if(this._active!==null&&!a){Echo.Render.renderComponentHide(this._childComponent)}if(Core.Web.Env.BROWSER_MOZILLA&&!Core.Web.Env.BROWSER_FIREFOX){this._contentDiv.style.right=a?"0":"100%";this._contentDiv.style.bottom=a?"0":"100%"}else{this._contentDiv.style.display=a?"block":"none"}this._active=a},setRollover:function(a){this._renderHeaderState(this._active,a);this._parent._renderHeaderPositions()}});Extras.Sync.ToolTipContainer=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.ToolTipContainer",this)},_div:null,_applyDiv:null,_toolTipDiv:null,_positionToolTip:function(h){this._toolTipDiv.style.height="";var b=(h.pageX||(h.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)));var a=(h.pageY||(h.clientY+(document.documentElement.scrollTop||document.body.scrollTop)));var f=new Core.Web.Measure.Bounds(document.body);var c=new Core.Web.Measure.Bounds(this._toolTipDiv.firstChild);var g=b+10;var d=a+10;if(d+c.height>f.height){d=f.height-c.height;if(d<0){d=0}}if(a<d&&(g+c.width>f.width)){g=f.width-c.width;if(g<0){g=0}}this._toolTipDiv.style.left=g+"px";this._toolTipDiv.style.top=d+"px";Core.Web.VirtualPosition.redraw(this._toolTipDiv)},_processMove:function(a){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return}this._positionToolTip(a);return true},_processRolloverEnter:function(a){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return}if(this._toolTipDiv.parentNode!==document.body){document.body.appendChild(this._toolTipDiv);this._positionToolTip(a)}return true},_processRolloverExit:function(a){if(!this.client||!this.client.verifyInput(this.component)){return}if(this._toolTipDiv.parentNode===document.body){document.body.removeChild(this._toolTipDiv)}return true},renderAdd:function(d,a){this._div=document.createElement("div");this._div.id=this.component.renderId;if(this.component.children.length>0){this._applyDiv=document.createElement("div");this._applyDiv.style.cursor="default";Echo.Render.renderComponentAdd(d,this.component.children[0],this._applyDiv);this._div.appendChild(this._applyDiv);if(this.component.children.length>1){Core.Web.Event.add(this._applyDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseenter":"mouseover",Core.method(this,this._processRolloverEnter),true);Core.Web.Event.add(this._applyDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseleave":"mouseout",Core.method(this,this._processRolloverExit),true);Core.Web.Event.add(this._applyDiv,"mousemove",Core.method(this,this._processMove),true);this._toolTipDiv=document.createElement("div");this._toolTipDiv.style.cssText="position:absolute;z-index:30000;overflow:hidden;right:0;bottom:0;";var c=document.createElement("div");c.style.cssText="position:absolute;";var b=this.component.render("width");if(b){c.style.width=Echo.Sync.Extent.toCssValue(b)}Echo.Render.renderComponentAdd(d,this.component.children[1],c);this._toolTipDiv.appendChild(c)}}a.appendChild(this._div)},renderDispose:function(a){if(this._applyDiv){Core.Web.Event.removeAll(this._applyDiv)}if(this._toolTipDiv&&this._toolTipDiv.parentNode===document.body){document.body.removeChild(this._toolTipDiv)}this._div=null;this._applyDiv=null;this._toolTipDiv=null},renderUpdate:function(c){var a=this._div;var b=a.parentNode;Echo.Render.renderComponentDispose(c,c.parent);b.removeChild(a);this.renderAdd(c,b);return true}});Extras.Sync.TransitionPane=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.TransitionPane",this)},_containerDiv:null,contentDiv:null,type:null,_transition:null,_transitionClass:null,oldChildDiv:null,childDiv:null,_initialContentLoaded:false,doImmediateTransition:function(){this.removeOldContent();if(this.childDiv){this.showContent()}},_loadTransition:function(){this.type=this.component.render("type");switch(this.type){case Extras.TransitionPane.TYPE_FADE:this._transitionClass=Extras.Sync.TransitionPane.FadeOpacityTransition;break;case Extras.TransitionPane.TYPE_FADE_TO_BLACK:case Extras.TransitionPane.TYPE_FADE_TO_WHITE:this._transitionClass=Extras.Sync.TransitionPane.FadeOpacityColorTransition;break;case Extras.TransitionPane.TYPE_CAMERA_PAN_DOWN:case Extras.TransitionPane.TYPE_CAMERA_PAN_LEFT:case Extras.TransitionPane.TYPE_CAMERA_PAN_RIGHT:case Extras.TransitionPane.TYPE_CAMERA_PAN_UP:this._transitionClass=Extras.Sync.TransitionPane.CameraPanTransition;break;case Extras.TransitionPane.TYPE_BLIND_BLACK_IN:case Extras.TransitionPane.TYPE_BLIND_BLACK_OUT:this._transitionClass=Extras.Sync.TransitionPane.BlindTransition;break;default:this._transitionClass=null}},removeOldContent:function(){if(this.oldChildDiv){this.contentDiv.removeChild(this.oldChildDiv);this.oldChildDiv=null}},showContent:function(){if(this.childDiv){this.childDiv.style.visibility="visible"}},renderAdd:function(b,a){this._containerDiv=document.createElement("div");this._containerDiv.id=this.component.renderId;this._containerDiv.style.cssText="position:absolute;overflow:auto;top:0;left:0;width:100%;height:100%;";this.contentDiv=document.createElement("div");this.contentDiv.style.cssText="position:absolute;overflow:hidden;top:0;left:0;width:100%;height:100%;";this._containerDiv.appendChild(this.contentDiv);a.appendChild(this._containerDiv);if(this.component.children.length>0){this._renderAddChild(b)}},_renderAddChild:function(a){this._loadTransition();this.childDiv=document.createElement("div");this.childDiv.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;";Echo.Render.renderComponentAdd(a,this.component.children[0],this.childDiv);if(this._initialContentLoaded){this.childDiv.style.visibility="hidden";if(this._transitionClass){this._transitionStart()}else{this.doImmediateTransition()}}else{this._initialContentLoaded=true}this.contentDiv.appendChild(this.childDiv)},renderDispose:function(a){this._initialContentLoaded=false;if(this._transition){this._transition.abort()}this.childDiv=null;this.contentDiv=null;this._containerDiv=null},renderUpdate:function(g){var d=false;if(g.hasUpdatedLayoutDataChildren()){d=true}else{if(g.hasUpdatedProperties()){var b=g.getUpdatedPropertyNames();if(!(b.length==1&&b[0]=="type")){d=true}}}if(d){var c=this._containerDiv;var f=c.parentNode;Echo.Render.renderComponentDispose(g,g.parent);f.removeChild(c);this.renderAdd(g,f)}else{if(this._transition){this._transition.abort()}var a=g.getRemovedChildren();if(a){this.oldChildDiv=this.childDiv;this.childDiv=null}var e=g.getAddedChildren();if(g.parent.children>1){throw new Error("Cannot render more than one child in a TransitionPane.")}if(e){this._renderAddChild(g)}}return d},_transitionStart:function(){this._transition=new this._transitionClass(this);this._transition.runTime=this.component.render("duration",this._transition.runTime);this._transition.start(Core.method(this,this._transitionFinish))},_transitionFinish:function(b){if(this._transition){this._transition=null;this.showContent()}this.removeOldContent();if(this.component&&this.component.application){var a=this.component.application.getFocusedComponent();if(a!=null&&this.component.isAncestorOf(a)){Echo.Render.updateFocus(this.client)}}}});Extras.Sync.TransitionPane.Transition=Core.extend(Extras.Sync.Animation,{transitionPane:null,runTime:350,sleepInterval:10,$abstract:true,$construct:function(a){this.transitionPane=a}});Extras.Sync.TransitionPane.BlindTransition=Core.extend(Extras.Sync.TransitionPane.Transition,{runTime:700,_maskDiv:null,_stepCount:14,_swapStep:null,_reverse:false,complete:function(a){this._maskDiv.parentNode.removeChild(this._maskDiv)},init:function(){this._swapStep=Math.floor(this._stepCount)/2+1;this._reverse=this.transitionPane.type===Extras.TransitionPane.TYPE_BLIND_BLACK_OUT;this._maskDiv=document.createElement("div");this._maskDiv.style.cssText="position:absolute;width:100%;height:100%;z-index:30000;";this.transitionPane.contentDiv.appendChild(this._maskDiv)},step:function(b){var c=Math.ceil(b*this._stepCount);if(c===0){c=1}if(c===this._renderedStep){return}var a=this.transitionPane.client.getResourceUrl("Extras","image/transitionpane/blindblack/Frame"+c+".gif");this._maskDiv.style.backgroundImage="url("+a+")";if(c<this._swapStep){if(this.transitionPane.oldChildDiv){if(this._reverse){this.transitionPane.oldChildDiv.style.top=c+"px"}else{this.transitionPane.oldChildDiv.style.top=(0-c)+"px"}}}else{if(this._renderedStep<this._swapStep){this.transitionPane.showContent();this.transitionPane.removeOldContent()}if(this.transitionPane.childDiv){if(this._reverse){this.transitionPane.childDiv.style.top=(c-this._stepCount)+"px"}else{this.transitionPane.childDiv.style.top=(this._stepCount-c)+"px"}}}this._renderedStep=c}});Extras.Sync.TransitionPane.CameraPanTransition=Core.extend(Extras.Sync.TransitionPane.Transition,{_newChildOnScreen:false,_travel:null,complete:function(a){if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.zIndex=0;this.transitionPane.childDiv.style.top="0px";this.transitionPane.childDiv.style.left="0px"}},init:function(){var a=new Core.Web.Measure.Bounds(this.transitionPane.contentDiv);this._travel=(this.transitionPane.type==Extras.TransitionPane.TYPE_CAMERA_PAN_DOWN||this.transitionPane.type==Extras.TransitionPane.TYPE_CAMERA_PAN_UP)?a.height:a.width;if(this.transitionPane.oldChildDiv){this.transitionPane.oldChildDiv.style.zIndex=1}},step:function(a){switch(this.transitionPane.type){case Extras.TransitionPane.TYPE_CAMERA_PAN_DOWN:if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.top=((1-a)*this._travel)+"px"}if(this.transitionPane.oldChildDiv){this.transitionPane.oldChildDiv.style.top=(0-(a*this._travel))+"px"}break;case Extras.TransitionPane.TYPE_CAMERA_PAN_UP:if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.top=(0-((1-a)*this._travel))+"px"}if(this.transitionPane.oldChildDiv){this.transitionPane.oldChildDiv.style.top=(a*this._travel)+"px"}break;case Extras.TransitionPane.TYPE_CAMERA_PAN_RIGHT:if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.left=((1-a)*this._travel)+"px"}if(this.transitionPane.oldChildDiv){this.transitionPane.oldChildDiv.style.left=(0-(a*this._travel))+"px"}break;default:if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.left=(0-((1-a)*this._travel))+"px"}if(this.transitionPane.oldChildDiv){this.transitionPane.oldChildDiv.style.left=(a*this._travel)+"px"}break}if(!this._newChildOnScreen&&this.transitionPane.childDiv){this.transitionPane.showContent();this.transitionPane.childDiv.style.zIndex=2;this._newChildOnScreen=true}}});Extras.Sync.TransitionPane.FadeOpacityTransition=Core.extend(Extras.Sync.TransitionPane.Transition,{runTime:1000,complete:function(a){if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.zIndex=0;if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){this.transitionPane.childDiv.style.filter=""}else{this.transitionPane.childDiv.style.opacity=1}}},init:function(){if(this.transitionPane.childDiv){if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){this.transitionPane.childDiv.style.filter="alpha(opacity=0)"}else{this.transitionPane.childDiv.style.opacity=0}}this.transitionPane.showContent()},step:function(a){var b;if(this.transitionPane.childDiv){if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){b=Math.floor(a*100);this.transitionPane.childDiv.style.filter="alpha(opacity="+b+")"}else{this.transitionPane.childDiv.style.opacity=a}}else{if(this.transitionPane.oldChildDiv){if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){b=Math.floor((1-a)*100);this.transitionPane.oldChildDiv.style.filter="alpha(opacity="+b+")"}else{this.transitionPane.oldChildDiv.style.opacity=1-a}}}}});Extras.Sync.TransitionPane.FadeOpacityColorTransition=Core.extend(Extras.Sync.TransitionPane.Transition,{runTime:1000,_maskDiv:null,_swapped:false,complete:function(a){this._maskDiv.parentNode.removeChild(this._maskDiv)},init:function(){this._maskDiv=document.createElement("div");this._maskDiv.style.cssText="position:absolute;width:100%;height:100%;z-index:30000;";if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){this._maskDiv.style.filter="alpha(opacity=0)"}else{this._maskDiv.style.opacity=0}if(this.transitionPane.type===Extras.TransitionPane.TYPE_FADE_TO_WHITE){this._maskDiv.style.backgroundColor="#ffffff"}else{this._maskDiv.style.backgroundColor="#000000"}this.transitionPane.contentDiv.appendChild(this._maskDiv)},step:function(b){var a=1-Math.abs(b*2-1);if(b>0.5&&!this._swapped){this.transitionPane.showContent();this.transitionPane.removeOldContent();this._swapped=true}if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){var c=Math.floor(a*100);this._maskDiv.style.filter="alpha(opacity="+c+")"}else{this._maskDiv.style.opacity=a}}});Extras.Sync.Viewer={};Extras.Sync.Viewer.ScrollContainer=Core.extend({_accumulator:0,_rowHeight:null,_scrollPosition:0,_barPosition:0,onScroll:null,gain:0.2,$construct:function(a,b,d,c){this.client=a;this.component=b;this._rowHeight=c;this.rootElement=document.createElement("div");this.rootElement.style.cssText="position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;";this._barDiv=document.createElement("div");this._barDiv.style.cssText="position:absolute;top:0;bottom:0;right:0;overflow:scroll;";this._barDiv.style.width=(1+Core.Web.Measure.SCROLL_WIDTH)+"px";this._vScrollContent=document.createElement("div");this._vScrollContent.style.cssText="width:1px;";this._barDiv.appendChild(this._vScrollContent);this.rootElement.appendChild(this._barDiv);this.contentElement=document.createElement("div");this.contentElement.style.cssText="position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;background:white;";this.rootElement.appendChild(this.contentElement);Core.Web.Event.add(this._barDiv,"scroll",Core.method(this,this._processScroll),true);Core.Web.Event.add(this.rootElement,Core.Web.Env.BROWSER_MOZILLA?"DOMMouseScroll":"mousewheel",Core.method(this,this._processWheel),true);this.setRows(d);this._accumulatorRunnable=new Core.Web.Scheduler.MethodRunnable(Core.method(this,this._accumulatedScroll),10)},_accumulatedScroll:function(){if(this._accumulator){var a=this._accumulator;this._adjustScrollPosition(this.gain*this._accumulator);this._accumulator=0}},dispose:function(){Core.Web.Event.removeAll(this._barDiv);Core.Web.Event.removeAll(this.rootElement);this.rootElement=null;this.contentElement=null;this._barDiv=null},_adjustScrollPosition:function(a){this._scrollPosition+=this._height*a;this._scrollPosition=Math.max(0,Math.min(this._scrollPosition,this._maxScrollPosition));this._barPosition=Math.floor(this._scrollPosition*this._barFactor);this._rowPosition=this._scrollPosition/this._rowHeight;this._barDiv.scrollTop=this._barPosition;if(this.onScroll){this.onScroll({source:this,type:"scroll",row:this._rowPosition})}},_processScroll:function(a){if(!this.client||!this.client.verifyInput(this.component)){this._barDiv.scrollTop=this._barPosition;return}if(this._barDiv.scrollTop!==this._barPosition){this._barPosition=this._barDiv.scrollTop;this._scrollPosition=this._barPosition/this._barFactor;this._rowPosition=this._scrollPosition/this._rowHeight;if(this.onScroll){this.onScroll({source:this,type:"scroll",row:this._rowPosition})}}},_processWheel:function(b){if(!this.client||!this.client.verifyInput(this.component)){return}var a;if(b.wheelDelta){a=b.wheelDelta/-120}else{if(b.detail){a=b.detail/3}else{return}}if(this._accumulator===0){Core.Web.Scheduler.add(this._accumulatorRunnable)}this._accumulator+=a;Core.Web.DOM.preventEventDefault(b);return true},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this.rootElement);Core.Web.VirtualPosition.redraw(this.contentElement);Core.Web.VirtualPosition.redraw(this._barDiv);this._height=this._barDiv.offsetHeight;this._vScrollContent.style.height=Math.min(this._height*50,this._totalRowHeight)+"px";this._scrollHeight=this._barDiv.scrollHeight;this._barRange=this._scrollHeight-this._height;this._updateSizes()},_updateSizes:function(){this._maxScrollPosition=Math.max(0,this._totalRowHeight-this._height);this._barFactor=this._barRange/this._maxScrollPosition},setActive:function(a){if(a){this.contentElement.style.right=Core.Web.Measure.SCROLL_WIDTH+"px"}else{this.contentElement.style.right=0}},setRows:function(a){this._totalRowHeight=a*this._rowHeight;this._updateSizes();this.renderDisplay()}});Extras.Sync.CalendarSelect.resource.set("bg",{"DayOfWeek.0":"\u041d\u0435\u0434\u0435\u043b\u044f","DayOfWeek.1":"\u041f\u043e\u043d\u0435\u0434\u0435\u043b\u043d\u0438\u043a","DayOfWeek.2":"\u0412\u0442\u043e\u0440\u043d\u0438\u043a","DayOfWeek.3":"\u0421\u0440\u044f\u0434\u0430","DayOfWeek.4":"\u0427\u0435\u0442\u0432\u044a\u0440\u0442\u044a\u043a","DayOfWeek.5":"\u041f\u0435\u0442\u044a\u043a","DayOfWeek.6":"\u0421\u044a\u0431\u043e\u0442\u0430","Month.0":"\u042f\u043d\u0443\u0430\u0440\u0438","Month.1":"\u0424\u0435\u0432\u0440\u0443\u0430\u0440\u0438","Month.2":"\u041c\u0430\u0440\u0442","Month.3":"\u0410\u043f\u0440\u0438\u043b","Month.4":"\u041c\u0430\u0439","Month.5":"\u042e\u043d\u0438","Month.6":"\u042e\u043b\u0438","Month.7":"\u0410\u0432\u0433\u0443\u0441\u0442","Month.8":"\u0421\u0435\u043f\u0442\u0435\u043c\u0432\u0440\u0438","Month.9":"\u041e\u043a\u0442\u043e\u043c\u0432\u0440\u0438","Month.10":"\u041d\u043e\u0435\u043c\u0432\u0440\u0438","Month.11":"\u0414\u0435\u043a\u0435\u043c\u0432\u0440\u0438",FirstDayOfWeek:"1"});Extras.Sync.CalendarSelect.resource.set("de",{"DayOfWeek.0":"Sonntag","DayOfWeek.1":"Montag","DayOfWeek.2":"Dienstag","DayOfWeek.3":"Mittwoch","DayOfWeek.4":"Donnerstag","DayOfWeek.5":"Freitag","DayOfWeek.6":"Samstag","Month.0":"Januar","Month.1":"Februar","Month.2":"M\u00e4rz","Month.3":"April","Month.4":"Mai","Month.5":"Juni","Month.6":"Juli","Month.7":"August","Month.8":"September","Month.9":"Oktober","Month.10":"November","Month.11":"Dezember",FirstDayOfWeek:"1"});Extras.Sync.RichTextArea.resource.set("de",{"ColorDialog.Title.Foreground":"Textfarbe","ColorDialog.Title.Background":"Hintergrundfarbe","ColorDialog.PromptForeground":"Textfarbe:","ColorDialog.PromptBackground":"Hintergrundfarbe:","Error.ClipboardAccessDisabled":"Der Zugriff auf die Zwischenablage ist in diesem Browser deaktiviert. Bitte benutzen Sie die entsprechenden Tastenkombinationen oder \u00e4ndern Sie die Sicherheitseinstellungen des Browsers.","Generic.Cancel":"Abbrechen","Generic.Error":"Fehler","Generic.Ok":"Ok","HyperlinkDialog.Title":"Hyperlink einf\u00fcgen","HyperlinkDialog.PromptURL":"URL:","HyperlinkDialog.PromptDescription":"Beschreibung:","HyperlinkDialog.ErrorDialogTitle":"Hyperlink konnte nicht eingef\u00fcgt werden","HyperlinkDialog.ErrorDialog.URL":"Die eingegebene URL ist nicht g\u00fcltig.","ImageDialog.Title":"Bild einf\u00fcgen","ImageDialog.PromptURL":"URL:","ImageDialog.ErrorDialogTitle":"Bild konnte nicht eingef\u00fcgt werden","ImageDialog.ErrorDialog.URL":"Die eingegebene URL ist nicht g\u00fcltig.","Menu.Edit":"Bearbeiten","Menu.Undo":"R\u00fcckg\u00e4ngig","Menu.Redo":"Wiederherstellen","Menu.Cut":"Ausschneiden","Menu.Copy":"Kopie","Menu.Paste":"Einf\u00fcgen","Menu.Delete":"L\u00f6schen","Menu.SelectAll":"Alles ausw\u00e4hlen","Menu.Insert":"Einf\u00fcgen","Menu.InsertImage":"Bild...","Menu.InsertHyperlink":"Hyperlink...","Menu.InsertHorizontalRule":"Trennstrich","Menu.InsertTable":"Tabelle...","Menu.BulletedList":"Aufz\u00e4hlung (symbolisch)","Menu.NumberedList":"Aufz\u00e4hlung (numeriert)","Menu.Format":"Format","Menu.Bold":"Fett","Menu.Italic":"Kursiv","Menu.Underline":"Unterstrichen","Menu.Strikethrough":"Durchgestrichen","Menu.Superscript":"Hochgestellt","Menu.Subscript":"Tiefgestellt","Menu.PlainText":"Einfacher Text","Menu.TextStyle":"Textstil","Menu.ParagraphStyle":"Absatzstil","Menu.Alignment":"Ausrichtung","Menu.Left":"Linksb\u00fcndig","Menu.Right":"Rechtsb\u00fcndig","Menu.Center":"Zentriert","Menu.Justified":"Blocksatz","Menu.Indent":"Einr\u00fccken","Menu.Outdent":"Ausr\u00fccken","Menu.SetForeground":"Textfarbe setzen...","Menu.SetBackground":"Hintergrundfarbe setzen...","Menu.Heading1":"\u00dcberschrift 1","Menu.Heading2":"\u00dcberschrift 2","Menu.Heading3":"\u00dcberschrift 3","Menu.Heading4":"\u00dcberschrift 4","Menu.Heading5":"\u00dcberschrift 5","Menu.Heading6":"\u00dcberschrift 6","Menu.Normal":"Normal","Menu.Preformatted":"Formatiert","TableDialog.Title":"Tabelle einf\u00fcgen","TableDialog.PromptRows":"Zeilen:","TableDialog.PromptColumns":"Spalten:","TableDialog.ErrorDialogTitle":"Tabelle konnte nicht eingef\u00fcgt werden","TableDialog.ErrorDialog.Columns":"Die Anzahl der Spalten ist nicht g\u00fcltig. Bitte geben Sie eine Zahl zwischen 1 und 50 ein.","TableDialog.ErrorDialog.Rows":"Die Anzahl der Zeilen ist nicht g\u00fcltig. Bitte geben Sie eine Zahl zwischen 1 und 50 ein."});